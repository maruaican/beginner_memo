
---
Y     ←  ( X )
従属側　　決定側
　　　　　主キー
ｘが決まるとＹも決まる。


## データベース設計における矢印（→）の2つの意味：E-R図と正規化

データベース設計において、矢印（→）は文脈によって全く異なる2つの意味を持ちます。この2つを混同すると設計上の誤りを引き起こすため、正確な区別が不可欠です。

*   **E-R図の矢印**: **異なる**エンティティ（テーブル）間の関係性、特に**カーディナリティ（多重度）**を示します。
*   **正規化の矢印**: **同一**テーブル内における項目間の関係性、すなわち**「関数従属性」**を示します。

このドキュメントでは、それぞれの矢印の意味、使われ方、そして試験で問われるポイントについて体系的に解説します。

## 1. E-R図における矢印：カーディナリティ（多重度）

E-R図で用いられる矢印は、エンティティ（テーブル）間の関係における「行数の対応関係」を表します。

### 1.1. 矢印の意味とルール
*   **意味**: エンティティ間の**カーディナリティ（多重度）**を表します。
*   **読み方**: 「1つの○○に対して、複数の△△が対応する」と読み解きます。
*   **試験ルール**: 応用情報技術者試験の凡例では、矢印は必ず「**1→多**」の関係で描かれます。
    *   `主キーを持つエンティティ（1側） → 外部キーを持つエンティティ（多側）`
    *   図中では、主キー側が**実線**、外部キー側が**点線**で表現されることがあります。

### 1.2. 「1対多」関係の具体例
E-R図の「1対多」とは、具体的には「片方のテーブルの**1つの行**に対して、もう一方のテーブルの**何行が対応するか**」という行数の関係を指します。これをIPAの用語では**カーディナリティ（多重度）**と呼びます。

#### 例1：部署と従業員 (`部署 → 従業員`)
1つの部署に対して、複数の従業員が所属する関係です。
部署テーブルの「部署ID=10」の**1行**に対して、従業員テーブルでは同じ部署IDを持つ従業員「佐藤」「鈴木」の**2行が対応**しています。これが「1対多」という行数関係の実体です。

**部署テーブル**
| 部署ID | 部署名 |
|:------:|:------:|
| **10** | 総務     |
| 20     | 開発     |

**従業員テーブル**
| 従業員ID | 氏名 | 部署ID |
|:--------:|:----:|:------:|
| 101      | 佐藤   | **10** |
| 102      | 鈴木   | **10** |
| 201      | 田中   | 20     |

#### 例2：注文と注文明細 (`注文 → 注文明細`)
1つの注文に対して、複数の注文明細が存在する関係です。
注文テーブルの1行（例：注文ID=500）に対して、注文明細テーブルではその注文に含まれる商品ごとに複数行（例：商品Aが2行、商品Bが1行）が対応します。

### 1.3. 試験での着眼点：矢印の方向を特定する方法

矢印の方向を決定するためのアプローチは以下の通りです。

#### 方法1：主キーと外部キーの関係を確認する
*   矢印は `主キー（1側）` から `外部キー（多側）` へと向かいます。
*   一意な値を持つ方が「1」、複数のレコードで同じ値を取りうる方が「多」です。
*   **覚え方**: 実線は漢数字の「一」、点線は雨のようにたくさん（多い）ので、傘の役割をする外部キー側が「多」とイメージできます。（※ただし、試験では必ずしもこの凡例とは限らないため注意が必要です。）

#### 方法2：一般常識で考える
*   どちらのエンティティのレコード数が多くなるかを常識的に判断します。
    *   日付、時間、注文といったデータは、日々大量に発生するため「多」側になりやすいです。
    *   `注文`（1） < `注文明細`（多）
    *   `商品分類コード`（1） < `商品コード`（多）
    *   `ID、番号、コード`（1側） → `日付、年月`（多側）

#### 方法3：問題文の記述から根拠を探す
*   「**○○ごとに**△△が複数ある」といった記述は、`○○` が「1」、`△△` が「多」であることを示す強力なヒントです。
    *   例：「部署**ごとに**従業員を管理する」 → `部署`(1) → `従業員`(多)
    *   **イメージ**: 「リンゴの大きさ**ごとに**箱を分ける」場合、箱（1）に対してリンゴ（多）が入ると考えられます。

*   **注意点：キー定義よりも問題文の要件が優先される**
    以下のテーブル定義だけを見ると、`従業員表` が `部署番号` を外部キーとして持っているため、`部署表` → `従業員表` の関係に見えます。

    **従業員表**
    | フィールド名 |
    | :--- |
    | 会社番号 |PK
    | 従業員番号 |PK
    | 従業員氏名 |
    | **部署番号** |**FK**
    | 入社年月日 |
    | 退職年月日 |

    **部署表**
    | フィールド名 |
    | :--- |
    | 会社番号 |PK
    | **部署番号** |**PK**
    | 部署名 |
    | 管理者番号 |FK

    しかし、もし問題文に「**一人の従業員が複数の部署を管理する場合がある**」という記述があれば、それは「管理者」という役割において `従業員`(1) → `部署`(多) という関係が存在することを示唆します。
    このように、表面的なキー構造だけでなく、**問題文の記述（＝業務要件）を重視する**ことが正解への鍵となります。

## 2. 正規化における矢印：関数従属性

正規化の文脈で使われる矢印は、**同一テーブル内**の項目（属性）間の「決定関係」を表します。

### 2.1. 矢印の意味とルール
*   **意味**: 同一テーブル内における**「関数従属性」**を表します。
*   **書き方**: `主キー（決定項目） → 非キー項目（従属項目）`
*   **読み方**:
    *   「（左辺の項目が）**決まると**、（右辺の項目が）一意に決まる」
    *   「（右辺の項目は）、（左辺の項目に）**従属している**」
*   **注意**: E-R図のカーディナリティとは**全く無関係**です。

### 2.2. 具体例
*   **社員ID → 社員名, 部署ID, 給与**
    *   **意味**: 社員IDという値が1つ決まれば、その社員の氏名、所属部署ID、給与もただ1つに決まる、という関係を示します。

### 2.3. 関数従属性と候補キーの概念
関数従属性の理解は、データベースの正規化と、その核となる**候補キー**を特定するために不可欠です。

#### 2.3.1. なぜこの技術が必要か？
関数従属や候補キーの概念は、以下の課題を解決するために必要です。
*   データベース設計における**データの冗長性を排除**する。
*   **更新異常**（データの不整合を引き起こす更新・挿入・削除の問題）を防ぐ。
*   データベースをどのレベルまで**正規化**すべきか（第1～第3正規形など）を正確に判断する。

#### 2.3.2. 用語の定義（IPA準拠）
| 概念 | 定義 | 例 (`A→B`の場合) |
|:---|:---|:---|
| **関数従属 (FD)** | 属性Xの値が決まると、属性Yの値が一意に決まる関係 (X→Y)。数学の関数 `f(x)=y` に似ていることから "Functional Dependency"（関数的に依存する）と呼ばれます。 | `A→B` |
| **決定属性** | 他の属性を決定する側の属性。 | `A` |
| **従属属性** | 他の属性によって一意に決まる側の属性。 | `B` |
| **超キー (Super Key)** | テーブル内の全属性を一意に決定できる属性の集合。（最小である必要はない） | `{A,C}` や `{A,C,D}` など |
| **候補キー (Candidate Key)** | 全属性を決定できる**最小の**属性集合。超キーの一種。 | `{A,C}` |
| **主キー (Primary Key)** | 複数の候補キーの中から、主として使用するために選ばれた1つのキー。 | `{A,C}` を主キーとして採用 |
| **属性閉包 (X+)** | 属性集合Xから、関数従属性をたどって導き出せるすべての属性の集合。 | `{A}+` = `{A,B}` |

### 2.4. 演習：関数従属性を用いた候補キーの特定
関数従属性を用いて候補キーを特定するプロセスを見ていきましょう。

**問題**:
関係 `R(A, B, C, D, E, F)` において、関数従属 `A→B`, `C→D`, `C→E`, `{A, C}→F` が成立するとき、関係Rの候補キーはどれか。

**全体像**:

関係 R(A, B, C, D, E, F)
   │
   ├─ A → B
   ├─ C → D, E
   └─ {A, C} → F


**特定プロセス**:
候補キーは「全属性を決定できる」「最小の」属性集合です。これを**属性閉包**を計算して確認します。

1.  **各属性集合の属性閉包を計算する**
    *   `{A}+` = `{A, B}`  
        (AからBが決まるが、他は決まらない)
    *   `{C}+` = `{C, D, E}`  
        (CからDとEが決まるが、他は決まらない)
    *   `{A, C}+` = `{A, C, B, D, E, F}`  
        (AからB、CからD,E、{A,C}からFが決まるため、**全属性が決定可能**。よって`{A, C}`は**超キー**である。)

2.  **最小性を確認する**
    *   超キー `{A, C}` からいずれかの属性を除いた場合（`{A}` または `{C}`）、全属性を決定できなくなるかを確認します。
    *   `{A}+` は全属性を含まず、`{C}+` も全属性を含みません。
    *   したがって、`{A, C}` は全属性を決定できる**最小の集合**です。

**結論**:
この関係Rの**候補キー**は **`{A, C}`** です。

#### 誤答例の解説
*   `A` や `C` 単独：全属性を決定できないため、候補キーではない。
*   `{A, C, D}`：全属性を決定できるため**超キー**ではあるが、Dが無くても `{A, C}` だけで決定できるため**最小ではない**。よって候補キーではない。

### 2.5. 試験での着眼点
*   **関数従属性の読み取り**: `左辺 → 右辺` の決定関係を正しく理解する。
*   **候補キーの判定**: 「**全属性を決定できるか**」「**その集合は最小か**」の2ステップで判断する。
*   **属性閉包の計算**: 候補キーを特定する上で頻出の計算手法。
*   **出題者の狙い**: 受験者が部分的な関数従属だけを見てキーを誤判断したり、超キーと候補キーを混同したりすることを狙った問題が多い。
*   **混同注意**: 「外部キーの参照」と「関数従属性」を混同しないように注意する。

## 3. 総括：2つの矢印の比較

### 3.1. 体系マップ（比較表）
| 項目 | E-R図における矢印 | 正規化における矢印 |
|:---|:---|:---|
| **矢印の意味** | **カーディナリティ（1対多）** | **関数従属性** |
| **対象** | **エンティティ間**（テーブル間） | **同一テーブル内の項目**（属性間） |
| **示す関係** | 表の**行数**どうしの対応関係 | 同じ表内の項目どうしの**決定**関係 |
| **典型例** | `部署` → `従業員` | `社員ID` → `社員名` |
| **試験での狙い** | 問題文から関係性を読み解き、矢印の方向を推定させる | 「決定項目」と「従属項目」の関係を誤解させ、候補キーを誤判断させる |

### 3.2. 代表的な正答例・誤答例
| 文脈 | 正答例 ✅ | 誤答例 ❌ |
|:---|:---|:---|
| **E-R図** | `部署` → `従業員` <br> (1つの部署に複数の従業員が所属する) | `従業員` → `部署` <br> (1人の従業員が複数の部署に所属する、という関係は一般的ではない) |
| **正規化** | `社員ID` → `社員名` <br> (社員IDが決まれば、氏名が一意に決まる) | `社員名` → `社員ID` <br> (同姓同名の社員がいる場合、氏名からIDは一意に決まらない) |

### 3.3. よくある誤解と正しい知識
*   **誤解 ❌**: 「E-R図の1→多は、関数従属性の1→多と同じ意味だ」
    *   **正しい知識 ✅**: 全くの別物。前者は**エンティティ間の行数関係**、後者は**同一テーブル内の決定関係**である。
*   **誤解 ❌**: 「外部キーがあるから、必ず1対多の関係になる」
    *   **正しい知識 ✅**: 外部キーはあくまで参照関係を示すもの。リレーションシップの定義によっては1対1の関係になることもあり得る。
*   **誤解 ❌**: 「関数従属の左辺にある属性がキーだ」
    *   **正しい知識 ✅**: 候補キーは**全属性を決定できる**、かつ**最小の**集合である必要がある。左辺にあるだけではキーとは限らない。

## 4. 知識の定着：一問一答

#### E-R図に関する問題
**Q1. E-R図で「部署 → 従業員」と表される関係の意味は？**
**A1.** 1つの部署に複数の従業員が所属することを示します。これは「1対多」のカーディナリティです。

**Q2. 「注文 → 注文明細」の関係は、どのように読み取りますか？**
**A2.** 1つの注文に対して、複数の注文明細が存在すると読み取ります。

#### 正規化・関数従属性に関する問題
**Q3. 正規化における「社員ID → 社員名」の意味は？**
**A3.** 社員IDの値が1つ決まれば、社員名が一意に定まるという**関数従属性**を表します。

**Q4. 「社員名 → 社員ID」という関数従属性は一般的に正しいですか？**
**A4.** 誤りです。同姓同名の社員がいる可能性があるため、社員名から社員IDは一意に決まりません。

**Q5. 関係 R(A,B,C) で `A→B`, `B→C` が成立する場合、`{A}+`（Aの属性閉包）は何ですか？**
**A5.** `{A, B, C}` です。AからBが、そのBからCが推移的に決まるためです。

**Q6. 関係 R(X,Y,Z) で `{X,Y}→Z` が成立する場合、`{X,Y}` は候補キーですか？**
**A6.** はい、候補キーです。`{X,Y}+` は `{X,Y,Z}` となり全属性を決定でき、`X`単独でも`Y`単独でも全属性は決定できないため、最小性も満たします。

#### 総合問題
**Q7. E-R図の矢印と正規化の矢印は同じ意味ですか？**
**A7.** 違います。E-R図の矢印はエンティティ間の**件数関係（カーディナリティ）**、正規化の矢印は同一テーブル内の**関数従属性**を表す、全く別の概念です。試験では両者の混同を狙う問題が出題されるため、この区別は必須です。