## SQLにおいて「項目名（カラム名）」を参照できる対象の体系的まとめ

### １．目的

SQL文において「項目名（カラム名）」を参照できる対象（FROM句等で使用可能な“表形式のデータ”）を体系的に整理し、試験・実務の両面で混乱しやすい点を明確化する。

------------------------------------------------------------------------

### ２．項目名を参照できる「表形式の構造」

| 種類 | 説明 |
|----|----|
| ① テーブル（表） | 実体として存在する基本的なデータベース表。例：社員、部署など。 |
| ② ビュー（View） | SELECT文により定義された仮想表。テーブルと同様に扱える。 |
| ③ サブクエリに付けた別名 | FROM句中の副問い合わせにエイリアスを付けることで「表」として参照可。 |
| ④ WITH句（共通表式） | SQLの先頭で定義される一時的な表。使用時には必ず別名が必要。 |
| ⑤ TABLE関数（DB依存） | 関数の戻り値として「行＋列」の集合を返すもの（PostgreSQLなど）。 |
| ⑥ JOINによる一時的な結合表 | JOINで結合した結果セットも「表形式」として項目参照が可能。 |

※すべて「FROM句」や「JOIN句」に記載することで、その中の項目名をSELECT句等で参照可能。

------------------------------------------------------------------------

### ３．項目名を直接持たないもの（参照不可）

| 種類 | 理由 |
|----|----|
| × 単一の値（スカラ値） | 数値や文字列リテラルであり、表形式でないため。 |
| × スカラ関数の戻り値 | 1つの値しか返さず、項目構造を持たないため。 |
| × 集約関数の結果（HAVING等） | 集約後の値には項目構造が存在せず、FROM句で使用できない。 |
| × GROUP BYのグループ構造 | グループ自体は表ではなく、単なる分類構造。 |

------------------------------------------------------------------------

### ４．ビューに対する別名（エイリアス）の使用

#### （１）ビューにも別名は付けられる

ビューはテーブルと同様に扱えるため、**FROM句中で別名（エイリアス）を付けて使用可能**。

    SELECT A.社員名
    FROM 社員ビュー AS A;

もしくは省略形：

    SELECT A.社員名
    FROM 社員ビュー A;

#### （２）ビューに別名を付ける目的

| 目的 | 説明 |
|----|----|
| 可読性の向上 | ビュー名が長い場合や複数回使用する場合に短縮して読みやすくなる |
| JOIN・自己結合対応 | 同じビューを複数回使う場合に識別子として活用できる |
| 明示的な参照の明確化 | `エイリアス.項目名` という形で所属を明示できる |

#### （３）ビューの定義時にエイリアスは不要

ビューの定義時には、別名は付けない。

    CREATE VIEW 社員ビュー AS
    SELECT 社員ID, 社員名, 部署ID
    FROM 社員;

→ 使用時にエイリアスを付けて活用する。

------------------------------------------------------------------------

### ５．代表的な使用例

#### 例１：サブクエリに対するエイリアス

    SELECT 社員名
    FROM (
      SELECT 社員ID, 社員名 FROM 社員
    ) AS 社員情報;

#### 例２：WITH句に対するエイリアス

    WITH 部門人数 AS (
      SELECT 部署ID, COUNT(*) AS 人数
      FROM 社員
      GROUP BY 部署ID
    )
    SELECT * FROM 部門人数;

#### 例３：ビューに対するエイリアス

    SELECT A.社員名, B.部署名
    FROM 社員ビュー A
    JOIN 部署ビュー B ON A.部署ID = B.部署ID;

------------------------------------------------------------------------

### ６．まとめ

| 観点 | 内容 |
|----|----|
| 項目名を持つ対象 | テーブル、ビュー、サブクエリの別名、WITH句、TABLE関数、JOIN結果 |
| 項目名を持たない対象 | スカラ値、スカラ関数、GROUP BY後の構造、HAVING句の条件など |
| ビューの別名 | FROM句で付けることができる。JOINや自己結合時に特に有用。 |
| 定義時のエイリアス | ビュー定義（CREATE VIEW）では別名不要。使用時に付ける。 |

SQLでは「表形式（行と列の集合）」かどうかが、項目名参照可能性を判断するカギとなる。
