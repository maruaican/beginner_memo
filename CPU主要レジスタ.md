
---

### CPU主要レジスタに関する演習問題

#### 問1
スタックポインタ(SP)の役割として、最も適切なものはどれか。

ア. 次に実行すべき命令が格納されている主記憶のアドレスを保持する。
イ. 現在実行中の機械語命令そのものを保持する。
ウ. サブルーチン呼出し時に、戻り先アドレスなどを格納するスタック領域の最上段のアドレスを保持する。
エ. 演算結果の状態や割込みの許可状態を示すフラグを保持する。


解答と解説

**解答：ウ**

**解説：**
スタックポインタ(SP)は、メモリ上のスタック領域の最上段アドレスを指し示すレジスタです。サブルーチン呼び出しや割り込みの際に、復帰先アドレスやレジスタの内容を一時的に保存するために使用されます。
- アはプログラムカウンタ(PC)の説明です。
- イは命令レジスタ(IR)の説明です。
- エはステータスレジスタ(PSW)の説明です。



---

#### 問2
プログラムカウンタ(PC)が保持している情報は何か。

ア. 命令デコーダが解釈する対象となる機械語命令
イ. プログラムの実行順序を制御するために、次にフェッチすべき命令のアドレス
ウ. 演算対象となるデータや演算結果
エ. 関数から復帰する際に参照されるアドレスが格納されている領域のアドレス


<summary>解答と解説

**解答：イ**

**解説：**
プログラムカウンタ(PC)は、CPUが次に実行（フェッチ）する命令が格納されているメモリアドレスを保持しています。これにより、プログラムの命令が順番に実行されます。
- アは命令レジスタ(IR)が保持します。
- ウは汎用レジスタ(GPR)が主に保持します。
- エはスタックポインタ(SP)が指し示すスタック領域に格納される情報に関連する説明です。



---

#### 問3
CPUがメモリから命令を読み出す「命令フェッチ」の直後、その命令語が格納されるレジスタはどれか。

ア. スタックポインタ(SP)
イ. ステータスレジスタ(PSW)
ウ. プログラムカウンタ(PC)
エ. 命令レジスタ(IR)


<summary>解答と解説

**解答：エ**

**解説：**
命令フェッチによって主記憶から読み出された命令語は、CPU内部の命令レジスタ(IR)に格納されます。その後、命令デコーダがIRの内容を解釈して、どのような処理を行うかを決定します。



---

#### 問4
ある算術演算を実行した結果、演算結果が負の値になった。この情報は、どのレジスタのどの部分に反映されるか。

ア. プログラムカウンタ(PC)の値が負になる。
イ. 命令レジスタ(IR)に負数を示すコードが格納される。
ウ. ステータスレジスタ(PSW)のサインフラグがセットされる（1になる）。
エ. スタックポインタ(SP)がスタックの底を指すようになる。


<summary>解答と解説

**解答：ウ**

**解説：**
演算結果の状態（ゼロ、負、桁あふれなど）は、ステータスレジスタ(PSW)内の各種フラグに反映されます。演算結果が負になった場合、サインフラグ（またはネガティブフラグ）がセットされます。このフラグは、後の条件分岐命令などで参照されます。



---

#### 問5
サブルーチン呼び出しにおいて、スタックポインタが直接関与**しない**処理はどれか。

ア. 呼び出し元への復帰先アドレスをスタックに退避させる処理。
イ. サブルーチンの処理内容を解釈するために命令をデコードする処理。
ウ. サブルーチン内で使用する局所変数のための領域をスタック上に確保する処理。
エ. サブルーチンに渡す引数をスタックに積む処理。


<summary>解答と解説

**解答：イ**

**解説：**
命令のデコード（解釈）は、命令レジスタ(IR)に格納された命令を命令デコーダが解析して行う処理です。スタックポインタ(SP)はこの処理には関与しません。ア、ウ、エは、いずれもサブルーチン呼び出しに伴うスタック操作であり、SPがその位置を管理するために深く関与します。



---

#### 問6
割り込み処理が発生した際、実行中のプログラムに正しく復帰するために、CPUの状態をスタックに退避させる必要がある。このとき、最低限退避させるべき情報の組合せとして、最も重要なものはどれか。

ア. プログラムカウンタと命令レジスタ
イ. プログラムカウンタとステータスレジスタ
ウ. 命令レジスタと汎用レジスタ
エ. ステータスレジスタとキャッシュメモリの内容


<summary>解答と解説

**解答：イ**

**解説：**
割り込みから正しく復帰するためには、「どこまで処理を進めていたか（プログラムカウンタ）」と「その時点での演算状態はどうだったか（ステータスレジスタ）」の2つが不可欠です。命令レジスタは割り込み処理ルーチンの命令で上書きされるため、退避の優先度は低いです。汎用レジスタも退避が必要な場合がありますが、最も根幹となるのはPCとPSWです。



---

#### 問7
CPUの命令実行サイクルにおいて、「次に実行すべき命令のアドレスをメモリに提示する」という役割を担うレジスタはどれか。

ア. 命令レジスタ(IR)
イ. プログラムカウンタ(PC)
ウ. スタックポインタ(SP)
エ. ステータスレジスタ(PSW)


<summary>解答と解説

**解答：イ**

**解説：**
命令実行サイクルの最初のステップである「命令フェッチ」では、プログラムカウンタ(PC)が保持するアドレスがメモリアドレスバスに送られ、そのアドレスに格納されている命令が読み出されます。したがって、次に実行すべき命令のアドレスをメモリに提示するのはPCの役割です。



---

<h4>問8</h4>
再帰的な関数呼び出し（関数が自分自身を呼び出す処理）を実現する上で、呼び出しの階層ごとに異なる復帰先アドレスや局所変数を管理するために、不可欠な役割を持つレジスタはどれか。

ア. プログラムカウンタ(PC)
イ. 命令レジスタ(IR)
ウ. 汎用レジスタ(GPR)
エ. スタックポインタ(SP)


<summary>解答と解説

**解答：エ**

**解説：**
再帰呼び出しでは、関数が呼び出されるたびに、その時点での復帰先アドレスと局所変数を保存する必要があります。スタックポインタ(SP)が管理するスタック領域にこれらの情報を順次積んでいく（Push）ことで、呼び出しの階層構造を正しく管理し、関数の終了時に順番に復帰（Pop）することが可能になります。SPがなければ、この仕組みは実現困難です。



---

<h4>問9</h4>
ある命令を実行した直後のCPUの状態として、あり得ないものはどれか。

ア. 演算結果がゼロになったため、ステータスレジスタのゼロフラグが1になった。
イ. 分岐命令を実行したため、プログラムカウンタの値が不連続に変化した。
ウ. サブルーチン呼び出し命令を実行したため、プログラムカウンタの値がスタックに積まれた。
エ. 加算命令を実行したため、命令レジスタの値が2つの被加数の和になった。


<summary>解答と解説

**解答：エ**

**解説：**
命令レジスタ(IR)は、実行する命令そのもの（機械語）を保持するレジスタであり、演算結果を保持するものではありません。加算命令の演算結果は、通常、汎用レジスタやアキュムレータに格納されます。
- ア、イ、ウはCPUの動作として正常なものです。特にウは、サブルーチン呼び出し時のSPを用いたスタックへのPC退避動作を説明しています。



---

<h4>問10</h4>
プログラムのデバッグ中に、サブルーチンからの復帰処理で意図しないアドレスにジャンプしてしまう不具合が発生した。この原因として、最も可能性が高いものはどれか。

ア. プログラムカウンタが、サブルーチンの開始アドレスを正しく保持できていない。
イ. 命令レジスタが、RET命令（復帰命令）を正しくデコードできていない。
ウ. スタックポインタが指す領域に格納された復帰先アドレスが、別の処理によって上書きされてしまった。
エ. ステータスレジスタのフラグが、予期しない値にセットされている。


<summary>解答と解説

**解答：ウ**

**解説：**
サブルーチンからの復帰は、スタックに退避しておいた復帰先アドレスをプログラムカウンタ(PC)に戻すことで行われます。もし意図しないアドレスにジャンプする場合、スタックに格納した復帰先アドレスが、サブルーチンの処理中（例えば、配列の範囲外アクセスなど）に破壊されてしまった可能性が最も高いです。このような現象を「スタック破壊」と呼びます。

---

## CPUの主要レジスタ解説：スタックポインタを中心に

応用情報技術者試験では、CPU内部で重要な役割を担う各種レジスタの機能を正確に理解しているかが問われます。特に、プログラムカウンタ(PC)とスタックポインタ(SP)の役割を混同させる問題が頻出します。
この解説では、スタックポインタ(SP)を中心に、各主要レジスタの役割と違いを体系的に整理し、試験対策のポイントを明確にします。

### 1. CPUの主要レジスタの概要と比較

CPUには、それぞれ特定の役割を持つ複数のレジスタが存在します。命令を実行する流れに沿って理解することが効果的です。

```text
【CPU内の主要レジスタと役割】
 ┌─────────────────┐
 │ プログラムカウンタ（PC） │ → 次に実行する命令のアドレスを保持
 ├─────────────────┤
 │ 命令レジスタ（IR）        │ → 現在実行中の命令そのものを保持
 ├─────────────────┤
 │ スタックポインタ（SP）    │ → スタックの最上段のアドレスを保持
 │                           │   （戻りアドレス，局所変数，退避レジスタ）
 ├─────────────────┤
 │ ステータスレジスタ（PSW） │ → 演算結果の状態，割込み許可状態を保持
 ├─────────────────┤
 │ 汎用レジスタ（GPR）       │ → データや演算結果など、汎用的に値を保持
 └─────────────────┘
```
**【学習のポイント】この並び順（PC→IR→SP→PSW）の意味**
この順序は、CPUが命令を実行する一連の流れ「**命令の流れを指す(PC) → 命令を取り込む(IR) → 実行結果を保持する(PSW)**」に沿っています。SPは、サブルーチン呼び出しなどでこの流れを補助する役割を果たします。この順序で覚えることで、各レジスタの関連性を体系的に理解しやすくなります。

#### 1.1. 主要レジスタの機能比較表

| レジスタ名 | 保持する内容 | 主な用途 | 試験で狙われる混同 |
| :--- | :--- | :--- | :--- |
| **プログラムカウンタ (PC)** | 次に実行する命令のアドレス | 命令の逐次実行を制御 | SPと混同しやすい |
| **命令レジスタ (IR)** | メモリから読み出した実行中の命令（機械語命令そのもの） | 命令デコーダが解釈し、CPUの各部へ制御信号を出す | PCと混同しやすい |
| **スタックポインタ (SP)** | スタック領域の最上段のアドレス | サブルーチン呼出し、割込み処理、局所変数の管理 | PCやIRと混同しやすい |
| **ステータスレジスタ (PSW)** | 演算結果の状態（フラグ）、割込み許可状態 | 条件分岐、例外処理の制御 | IRと混同しやすい |
| **汎用レジスタ (GPR)** | データ、計算途中の値、アドレスなど | プログラムのデータ処理の主体 | - |

### 2. スタックポインタ(SP)の詳細解説

#### 2.1. 定義と役割
スタックポインタ（Stack Pointer, SP）は、メモリ上にある**スタック領域の最上段のアドレスを保持する**ための専用レジスタです。スタックは、後入れ先出し（LIFO: Last-In, First-Out）のデータ構造であり、SPはデータの格納（Push）や取り出し（Pop）が行われる位置を常に指し示しています。

#### 2.2. 技術的な必要性
SPとスタックは、プログラムの実行において以下の重要な課題を解決します。

- **サブルーチン呼び出し**: サブルーチンを実行した後、呼び出し元の次の命令へ正確に戻る必要があります。そのための**復帰先アドレス**をスタックに一時的に保存し、その場所をSPで管理します。
- **局所変数の確保**: サブルーチン内でだけ使用する一時的な変数（局所変数）の領域を、スタック上に動的に確保・解放するためにSPが利用されます。
- **割り込み処理**: 割り込みが発生した際、実行中のプログラムの状態（PCやPSWなど）をスタックに退避させて処理を中断し、割り込み処理完了後に正確に復帰するために必須です。

### 3. 具体例で理解する：サブルーチン呼び出しとスタック操作

メインルーチンがサブルーチンを呼び出す際、CPUとスタックは以下のように連携して動作します。

1.  **復帰先アドレスの退避 (Push)**
    メインルーチンの次に実行される命令のアドレス（現在のPCの値）を、SPが指すスタック領域に格納（Push）します。
2.  **サブルーチンへジャンプ**
    サブルーチンの開始アドレスをPCに設定し、処理を移します。
3.  **局所変数領域の確保**
    サブルーチン内で局所変数が必要な場合、SPの値をずらしてスタック上に領域を確保します。
4.  **サブルーチン実行**
    サブルーチンの処理を行います。
5.  **局所変数領域の解放**
    サブルーチン終了時、確保した局所変数領域を解放するため、SPの値を元に戻します。
6.  **復帰先アドレスの復元 (Pop)**
    SPが指すスタック領域から退避させていた復帰先アドレスを取り出し（Pop）、PCに設定します。これにより、メインルーチンの元の場所へ処理が戻ります。

### 4. 応用情報技術者試験の攻略ポイント

#### 4.1. 試験の着眼点と頻出パターン
試験では「**どのレジスタが、どの情報を保持しているか**」を正確に区別できるかが問われます。特に、以下の混同を狙った選択肢が多く見られます。
- **PCとSPの違い**: 「次に実行する命令のアドレス」はPC、「スタックの最上段のアドレス」はSPです。出題者はこの2つを入れ替えた選択肢で受験者を混乱させようとします。
- **IRとPSWの違い**: 「実行中の命令そのもの」はIR、「演算結果の状態やフラグ」はPSWです。

#### 4.2. 典型的な正答例と誤答例
以下は、スタックポインタが問われた際の典型的な選択肢のパターンです。

- **【正答例】**
  - `サブルーチン呼出し時に，戻り先アドレス及びレジスタの内容を格納するメモリのアドレス`
  - *解説：SPは、これらの情報が格納されるスタック領域の先頭アドレスを指します。*

- **【誤答例（他のレジスタの説明）】**
  - `次に読み出す機械語命令が格納されているアドレス`
  - *解説：これは**プログラムカウンタ(PC)**の説明です。*
  - `メモリから読み出された機械語命令`
  - *解説：これは**命令レジスタ(IR)**の説明です。*
  - `割込みの許可状態，及び条件分岐の判断に必要な演算結果の状態`
  - *解説：これは**ステータスレジスタ(PSW)**の説明です。*

#### 4.3. よくある誤解と正しい知識

| 誤解 | 正しい知識 |
| :--- | :--- |
| SPは「最後に参照されたアドレス」を保持する。 | SPは「**スタックの最上段のアドレス**（次にPush/Popされる場所）」を保持する。 |
| SPは命令の流れを管理する。 | 命令の流れを管理するのは**PC**。SPはデータの一時的な保存場所を管理する。 |
| 局所変数はメモリの固定領域に置かれる。 | 局所変数は、実行時に**スタック領域に動的に確保**されるのが一般的である。 |

### 5. 【発展】命令実行サイクルと各レジスタの連携

CPUは「フェッチ → デコード → 実行」というサイクルで命令を処理します。この流れの中で各レジスタがどのように連携するかを知ると、理解がさらに深まります。

**例：`ADD R1, R2` （R1にR2を加算）という命令の実行サイクル**

1.  **フェッチ（命令の取り出し）**
    - **PC**が指すメモリアドレス（例: `0x1000`）から命令 `ADD R1, R2` を読み出します。
    - 読み出された命令は**IR (命令レジスタ)**に格納されます。
    - **PC**は次の命令のアドレス（例: `0x1004`）を指すよう更新されます。
2.  **デコード（命令の解釈）**
    - 命令デコーダが**IR**の内容を解釈し、「R1とR2の値を加算する」という処理内容を特定します。
3.  **実行（演算）**
    - 演算装置(ALU)が**汎用レジスタ** R1とR2から値を読み出し、加算処理を実行します。
    - 演算結果（`R1 + R2` の値）は、再び**汎用レジスタ** R1に書き込まれます。
    - 演算結果の状態（ゼロになったか、桁あふれしたか等）が**PSW (ステータスレジスタ)**の各フラグに反映されます。

この一連のサイクルにおいて、サブルーチン呼び出し（CALL命令）や割り込みが発生した場合にのみ、**SP (スタックポインタ)**が補助的に動作し、PCやレジスタの内容をスタックに退避・復元します。