# パイプライン方式とハザード解説

## １　全体像（テキスト図）

パイプラインは1命令を分割して並列実行する仕組みです。

```
命令1   [取]─[解]─[実]─[書]
命令2        [取]─[解]─[実]─[書]
命令3             [取]─[解]─[実]─[書]
```

* \[取] ＝ 命令フェッチ（命令を読み出す）
* \[解] ＝ 命令デコード（解読）
* \[実] ＝ 実行（演算など）
* \[書] ＝ 書き戻し（レジスタやメモリへ結果格納）

→ 各命令が「ずらして」進むことで、複数命令を同時に処理できる。

---

## １－１　定義（IPA準拠）と用語の由来

* **パイプライン処理**：
  CPU内部で命令実行を段階に分割し、複数の命令を重ね合わせて並列実行することでスループットを向上させる方式（IPAシラバス記載）。

* **ハザード（Hazard）**：
  英語で「危険・障害」を意味する。CPUのパイプライン処理がスムーズに流れなくなる要因を指す。

---

## １－２　技術の必要性（解決する具体的課題）

* 課題：命令を逐次（1つずつ）実行するとCPUがアイドル時間を多く持ってしまい遅い。
* 解決：パイプライン方式で並列化し、CPU利用効率を高める。
* 追加課題：ただし「競合」や「依存関係」によりパイプラインが止まることがあり、これがハザード。

---

## １－３　試験の着眼点

* 「3種類のハザード」を正しく分類できるか（構造／制御／データ）。
* 「分岐命令」や「命令結果の利用」が出たら → 制御ハザード or データハザードを識別。
* 誤答を誘う典型：分岐命令なのに「データハザード」と答えてしまう。

---

## １－４　体系マップ（分類・比較表）

| 種類      | 原因             | 例                          |
| ------- | -------------- | -------------------------- |
| 構造ハザード  | ハードウェア資源の競合    | 命令1がメモリを読み込み中に命令2もメモリにアクセス |
| 制御ハザード  | 分岐や割込みによる実行順不明 | if文やジャンプで、次命令が分からず待機       |
| データハザード | 命令間のデータ依存      | 命令1の結果を命令2が必要とする           |

---

## １－５　代表例（正答例・誤答例）

* 正答例：
  「分岐命令により先読みが無駄になる」→ 制御ハザード。
  「加算結果を直後の命令が使う」→ データハザード。

* 誤答例（試験作成者が狙う）：
  「分岐命令で次の命令が決まらない」→ データハザードと答える誤り。

---

## １－６　よくある誤解と対処

* 誤解①：ハザード＝全部データ依存だと思う。
  → 対処：**分岐＝制御、競合＝構造、依存＝データ**と整理する。

* 誤解②：1つの命令だけが遅くなると考える。
  → 実際は**後続すべての命令が遅れる**ため、全体効率が下がる。

---

## １－７　一問一答（5問）

**問題1**
命令の分岐によってパイプライン先読みが無駄になるのはどのハザードか。
**回答**：制御ハザード。
**解説**：分岐命令は次にどの命令を取るか不明になるため、パイプラインの流れが止まる。

---

**問題2**
複数の命令が同じ演算器を同時に使おうとした場合に発生するのは？
**回答**：構造ハザード。
**解説**：CPU内部のハードウェア資源競合が原因。

---

**問題3**
命令1の結果を命令2が必要とする場合、どのハザードか。
**回答**：データハザード。
**解説**：結果が出る前に次の命令が進めない。

---

**問題4**
分岐予測が外れると生じるハザードは？
**回答**：制御ハザード。
**解説**：誤った先読み命令が破棄され、処理が遅れる。

---

**問題5**
「命令実行ステージが重なることによる競合」をまとめた総称は？
**回答**：パイプラインハザード。
**解説**：構造・制御・データの3種類が含まれる。

---

## １－８　要約（3行以内）

パイプラインは命令を段階的に並列化して高速化する技法。
効率低下を招く障害はハザードと呼ばれ、構造・制御・データの3種類に分類される。
特に分岐命令によるものは制御ハザードである。

---


