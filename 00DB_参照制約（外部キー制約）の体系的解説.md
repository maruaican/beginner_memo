
---

# 参照制約（外部キー制約）の体系的解説

このドキュメントは、データベースにおける「参照制約（外部キー制約）」について、その定義、目的、具体的な操作制限、関連用語の正確な理解までを体系的にまとめたものです。

## 1. 参照制約とは

### 1.1. 定義
**参照制約（Referential Integrity Constraint）**とは、関係データベースにおける整合性制約の一つです。「`あるテーブルの列の値（**外部キー**）が、別のテーブルの主キー（または候補キー）として必ず存在しなければならない`」というルールを指します。

この制約を実現するために用いられるのが**外部キー（Foreign Key）**です。外部キーは、あるテーブルの列が、他のテーブルの主キーを参照する役割を持つことを定義します。

*   **IPA用語集での表現**: 「参照整合性制約」とも表現されます。
*   **用語の由来**: 外部キー（Foreign Key）は、英語の "Foreign"（外部の）と "Key"（鍵）に由来します。これは、キーの正当性を自身のテーブル内だけでは保証できず、外部の（別の）テーブルに依存することから名付けられました。

### 1.2. 目的と必要性
参照制約は、データベース内のデータの不整合を防ぎ、一貫性を保つために不可欠です。具体的には、以下のような課題を解決します。

*   **データ不整合の防止**:
    実在しないデータを登録してしまう誤りを防ぎます。例えば、「製品」表に存在しない製品番号を「在庫」表に登録できてしまうと、架空の製品の在庫が計上されてしまいます。
*   **孤児データ（Orphan Data）の発生防止**:
    参照先のデータが意図せず削除され、参照元のデータが参照先を失ってしまう状態（孤児データ）を防ぎます。例えば、「在庫」表から参照されている「製品」表の行が削除されると、「在庫」表の該当データはどの製品を指しているのか不明になってしまいます。

### 1.3. 関連用語の整理
参照制約を理解する上で重要な、テーブル間の関係を示す用語を整理します。

| 用語（役割） | 説明 | 今回の例 |
| :--- | :--- | :--- |
| **参照先表（親表）** | 参照される側。主キーを持つテーブル。 | **製品**表 |
| **参照元表（子表）** | 参照する側。外部キーを持つテーブル。 | **在庫**表 |

**【関係図】**
```
製品表（製品番号:主キー, 製品名, 型, 単価）
    ↑ 参照される（親）
    │
在庫表（在庫管理番号:主キー, 製品番号:外部キー, 在庫量）
                             ↑ 参照する（子）
```

## 2. 参照制約による操作の制限

参照制約が設定されている場合、データの追加・削除・更新に以下の制限が加わります。

| 制約対象 | 子表（参照元表）の操作 | 親表（参照先表）の操作 |
| :--- | :--- | :--- |
| **行の追加** | 親表に存在しない外部キーの値を持つ行を追加しようとすると、**拒否される**。 | 制限なし。 |
| **行の削除** | 制限なし。 | 子表から参照されている行を削除しようとすると、**拒否される**。（※） |
| **行の更新** | 外部キーの値を、親表に存在しない値に更新しようとすると、**拒否される**。 | 主キーの更新は、子表から参照されている場合、通常は**拒否される**か、他の動作が設定される。（※） |

※ **参照動作**: 親表での削除（`ON DELETE`）や更新（`ON UPDATE`）時に、子表のデータをどう扱うかを定義できます。例えば、親表の行が削除されたら子表の該当行も自動的に削除する（`CASCADE`）や、`NULL`を設定する（`SET NULL`）といった設定も可能です。

## 3. 【問題解説】平成28年春期 問29

**問題**: 次の表において、"在庫" 表の製品番号に定義された参照制約によって拒否される可能性のある操作はどれか。

**テーブル定義**:
*   `在庫`（<u>在庫管理番号</u>, <ins>製品番号</ins>, 在庫量）
*   `製品`（<u>製品番号</u>, 製品名, 型, 単価）
    *   実線の下線: 主キー
    *   破線の下線: 外部キー

### 3.1. 問題のポイント
この問題は、参照制約が「子表への行追加」と「親表の行削除」にどう作用するかを問う典型的な出題です。
*   **親表**: `製品`表
*   **子表**: `在庫`表
*   **外部キー**: `在庫`表の`製品番号`

### 3.2. 各選択肢の検討

*   **"在庫"表の行削除**
    *   子表（参照元）の行を削除する操作であり、他のテーブルとの整合性を崩さないため、参照制約による**制限はありません**。

*   **"在庫"表の表削除**
    *   子表（参照元）のテーブル自体を削除する操作であり、参照制約による**制限はありません**。

*   **"在庫"表への行追加**
    *   **正しい**。子表（参照元）に行を追加する際、`製品`表（親表）に存在しない`製品番号`を指定すると、参照制約違反となるため、データベースはその**追加操作を拒否します**。

*   **"製品"表への行追加**
    *   親表（参照先）に行を追加する操作であり、他のテーブルとの整合性を崩さないため、参照制約による**制限はありません**。

## 4. 「外部キー」と「参照制約」の厳密な関係

この2つの用語は密接に関連しており、試験対策ではほぼ同義として扱われますが、厳密には役割が異なります。

### 4.1. 厳密な違い
*   **外部キー (Foreign Key)**
    *   「子表のある列が、親表の主キーを参照する」という**列の構造的な役割・属性**を指します。
*   **参照制約 (Referential Integrity Constraint)**
    *   「外部キーの値は、親表の主キーに必ず存在しなければならない」という、外部キーに伴って発生する**整合性ルール（制約条件）**を指します。

結論として、「**外部キーという定義を設けることで、参照制約が働く**」という関係にあります。

### 4.2. SQLにおける定義（由来）
この関係性は、SQLの定義文（DDL）に由来します。

```sql
CREATE TABLE 在庫 (
    在庫管理番号   INT PRIMARY KEY,
    製品番号       INT,
    在庫量         INT,
    -- 「製品番号」列を外部キーとして定義し、「製品」表の「製品番号」列を参照させる
    FOREIGN KEY (製品番号) REFERENCES 製品(製品番号)
);
```

*   `FOREIGN KEY`: 列を「外部キー」として定義するキーワードです。
*   `REFERENCES`: 参照先の表と列を指定します。

この `FOREIGN KEY ... REFERENCES ...` という構文によって、DBMSに参照制約が登録され、自動的に整合性ルールが働くようになります。

### 4.3. 試験対策上の捉え方
IPAの基本情報・応用情報技術者試験では、「外部キー」と「参照制約」を厳密に区別させる問題は過去に出題されていません。出題者の意図は、両者の違いではなく、「親子関係を正しく理解し、どの操作が制限されるかを把握しているか」を問うことにあります。

したがって、**試験対策上は「外部キー＝参照制約」と理解しておいて問題ありません**。

## 5. 知識のチェックとよくある誤解

### 5.1. よくある誤解
*   **誤解①**: 「外部キー制約は、子表の削除も禁止する」
    *   **正解**: ❌ 子表（参照元）の行削除は制限されません。制限されるのは、子表から参照されている**親表（参照先）の行削除**です。
*   **誤解②**: 「参照制約は、親表の追加も禁止する」
    *   **正解**: ❌ 親表（参照先）の行追加は自由です。むしろ、親表にデータが存在しなければ、子表にそのデータを登録することができません。

### 5.2. 一問一答
*   **Q1. 外部キー制約は、どのような整合性を保証しますか？**
    *   A1. 参照整合性。子表の外部キーの値が、必ず親表の主キーに存在することを保証します。

*   **Q2. 子表に行を追加するときにチェックされることは何ですか？**
    *   A2. 追加しようとしている行の外部キーの値が、親表の主キーに存在するかどうかです。

*   **Q3. 親表の行を削除するときに問題となるのはどのような場合ですか？**
    *   A3. 削除しようとしている行の主キーが、子表から参照されている場合です。この場合、削除は拒否されます。

*   **Q4. 子表の行削除は参照制約によって制限されますか？**
    *   A4. 制限されません。

*   **Q5. 平成28年春期 問29の正答はどれですか？**
    *   A5. 「"在庫"表への行追加」です。理由は、親表である`製品`表に存在しない製品番号を追加しようとすると、参照制約違反になるためです。