
---

# モジュール結合度の体系的解説

## 1. モジュール結合度とは

### 1.1. 基本的な定義
モジュール結合度（Coupling）とは、**モジュール間の関連性や依存度の強さを示す指標**です。語源の「Couple（結びつける）」が示す通り、モジュール同士がどの程度強く結びついているかを表します。

- **結合度が低い（弱い）**: モジュール間の依存度が低く、それぞれが独立している状態。
- **結合度が高い（強い）**: モジュール間の依存度が高く、一方の変更が他方に影響を与えやすい状態。

### 1.2. なぜ重要なのか（技術の必要性）
ソフトウェア設計において、モジュールの**独立性**と**保守性**を高める観点から、モジュール結合度は可能な限り低く（弱く）することが望ましいとされています。結合度を適切に管理することで、以下の課題を解決できます。

- **変更時の影響範囲の局所化**: あるモジュールを変更した際に、他のモジュールに予期せぬ影響が及ぶのを防ぎます。
- **再利用性の向上**: モジュールが特定の環境に強く依存していないため、他のシステムでも再利用しやすくなります。
- **保守性・テスト容易性の向上**: 各モジュールを個別に修正したり、テストしたりすることが容易になります。

## 2. モジュール結合度の6段階レベル

モジュール結合度は、モジュール間のデータの受け渡し方法や参照の仕方によって、以下の6段階のレベルに分類されます。下に行くほど結合度が強く（高く）なり、依存関係が深まります。

| 結合度の強さ | 種類         | 概要                                       |
| :----------- | :----------- | :----------------------------------------- |
| **弱い** ↑   | **データ結合**   | 処理に必要なデータだけを単一パラメータで渡す |
|              | **スタンプ結合** | 必要なデータを構造体などのデータ構造で渡す   |
|              | **制御結合**   | モジュールの動作を制御するための情報を渡す   |
|              | **外部結合**   | 大域的に宣言された単一のデータを参照する     |
|              | **共通結合**   | 大域的に宣言されたデータ構造を参照する       |
| **強い** ↓   | **内容結合**   | 他のモジュールの内部を直接参照・操作する     |

## 3. 各結合度の詳細解説（Aの他者依存度という視点から）

ここでは、モジュールAがモジュールBを呼び出す、または共通のデータを参照する状況を想定し、**「AがBにどれだけ巻き込まれるか（依存しているか）」**という視点で各結合度を解説します。

### 3.1. データ結合 (Data Coupling)
- **定義**: 処理に必要なデータだけを、引数（単一のパラメータ）として受け渡している関係。
- **直感的なイメージ**: 「データだけをシンプルに渡す」。
- **AのBへの依存度**: **【弱い】** AはBに値を渡すだけで、Bの内部構造を全く知る必要がありません。最も独立性が高い理想的な状態です。
- **具体例**: モジュールAが、計算モジュールBに数値`10`を渡して、その結果を受け取る。

### 3.2. スタンプ結合 (Stamp Coupling)
- **定義**: 処理に必要なデータを、レコードや構造体などのデータ構造にまとめて引数として受け渡している関係。
- **直感的なイメージ**: 必要な情報を「スタンプ」のようにひとまとめにして、ポンと渡す。
- **AのBへの依存度**: **【弱め】** データ結合よりは多くの情報を渡しますが、AはBがその構造体のどの部分を使うかまでは関知しません。ただし、データ構造自体の定義にAとBが共に依存することになります。
- **具体例**: 顧客情報を扱うモジュールAが、住所印字モジュールBに「顧客構造体（氏名、住所、電話番号などを含む）」を丸ごと渡す。

### 3.3. 制御結合 (Control Coupling)
- **定義**: 呼び出し先のモジュールの動作を制御するための要素（フラグや処理を分岐させるパラメータなど）を引数として受け渡している関係。
- **直感的なイメージ**: AがBに対して「どう動くか指示する」。
- **AのBへの依存度**: **【中程度】** Aは、Bにどのような処理パターンが存在するかを知っている必要があり、Bの内部ロジックに依存しています。つまり、**「渡す値でBの動作を変えている」**状態です。
- **具体例**:
  ```
  # モジュールA
  flag = 1
  call ModuleB(flag) # flagの値によってBの処理が変わる

  # モジュールB(flag)
  if flag == 1:
      print("処理パターン1")
  else:
      print("処理パターン2")
  ```
  Aが渡す`flag`の値によってBの処理が変わるため、AはBの動作に依存しています。

### 3.4. 外部結合 (External Coupling)
- **定義**: 複数のモジュールが、大域的に宣言された**単一のデータ項目**（グローバル変数など）を参照している関係。
- **直感的なイメージ**: 「外で宣言された`一つのもの（ノート）`を、みんなで見る」。
- **AのBへの依存度**: **【中程度】** Aは、自分ではデータを書き換えなくても、モジュールBがそのグローバル変数を変更する可能性があります。その変更はAの処理結果に影響を及ぼすため、AはBの振る舞いに依存することになります。ただし、影響範囲は`単一のデータ`に限定されます。

### 3.5. 共通結合 (Common Coupling)
- **定義**: 複数のモジュールが、大域的に宣言された**データ構造**（レコードや構造体、共通域など）を参照している関係。
- **直感的なイメージ**: 「みんなで共有している`大きな資料棚`を、みんなで見る」。
- **AのBへの依存度**: **【強い】** **「見るだけ」であっても結合度が強い**とされます。なぜなら、`Aが参照しているデータ構造のどこか一部を、Bが書き換える可能性がある`ためです。
    - **AはBを直接見ていなくても**、Bが共通のデータ（例：ホワイトボードの記述）を変更すると、それを参照しているAの処理結果や挙動が変わってしまいます。
    - 参照するデータ項目が多いため、外部結合よりも影響範囲が広く、AはBの変更に巻き込まれる可能性が高くなります。
- **具体例**:
  ```
  # グローバルな共通データ（社員データ）
  社員 = {"名前": "田中", "部署": "営業"}

  # モジュールA: 田中さんの部署を見て処理を行う
  if 社員["部署"] == "営業":
      print("営業部の処理を実行")

  # モジュールB: 田中さんの部署を変更する
  社員["部署"] = "企画"
  ```
  Bが`社員`データを変更すると、Aの処理結果が変わってしまいます。このように、AはBの振る舞いに強く依存します。

### 3.6. 内容結合 (Content Coupling)
- **定義**: あるモジュールが、他のモジュールの**内部を直接参照・使用・操作**している関係。
- **直感的なイメージ**: 「相手の中身（ノート）を直接のぞき込んだり、書き換えたりする」。
- **AのBへの依存度**: **【最強】** AはBの内部コードや内部変数にまで依存しており、Bが少しでも変更されるとAは動作しなくなる可能性が非常に高いです。最も避けるべき結合状態です。
- **具体例**:
    - あるモジュールが、別のモジュールの内部変数に直接値を代入する。
    - あるモジュールが、**`CALL`命令を使わずに`JUMP`命令**で他のモジュールの特定の処理部分に分岐する。
        - **`CALL`命令**: 呼び出し元の情報（戻りアドレスなど）を保存してから移動する正規の呼び出し。
        - **`JUMP`命令**: 単に指定の場所に移動するだけ。呼び出し元が別のモジュールの内部コードを直接使用することに相当するため、内容結合となる。

## 4. 学習・試験対策のポイント

### 4.1. 試験の着眼点（頻出ポイント）
- **引数か、グローバル参照か、内部参照か**: この違いで結合度の種類を判断する問題が多い。
- **外部結合と共通結合の違い**: 参照対象が「単一のデータ」か「複数のデータ（構造体）」かで見分ける。
- **内容結合の具体例**: `JUMP`命令による呼び出しは、内容結合の典型例として頻出する。
- **制御結合の判断**: 引数を渡すだけでなく、その値によって「呼び出し先の処理ロジックが変化するか」がポイント。

### 4.2. よくある誤解と正しい知識
- **誤解**: 「引数を渡す処理はすべてデータ結合である」
- **正解**: 引数を渡していても、その値で**モジュールの動作を制御・変更している**場合は**制御結合**となる。
<br>
- **誤解**: 「データを見ているだけなら、依存はない（結合度は低い）」
- **正解**: 共通のデータを参照している場合、**他のモジュールがそのデータを変更する可能性**がある。その変更によって自分のモジュールの挙動が変わってしまうため、強い依存関係（**共通結合**）となる。
<br>
- **誤解**: 「`JUMP`命令によるモジュール呼び出しは外部結合である」
- **正解**: `JUMP`命令はモジュールの内部コードを直接使用することになるため、最も強い**内容結合**に分類される。

## 5. 理解度チェック（一問一答）

1.  **問**: モジュール間で、処理に必要なデータのみを単一の引数で渡す場合の結合度は？
    - **答**: **データ結合**。必要最小限の値だけを渡すため、独立性が最も高い。
2.  **問**: モジュールの動作を制御するために、処理を分岐させるフラグを引数で渡す場合の結合度は？
    - **答**: **制御結合**。呼び出し元が、呼び出し先の処理の選択に影響を与えているため。
3.  **問**: 複数のモジュールが、グローバルに宣言された一つの変数を参照している場合の結合度は？
    - **答**: **外部結合**。単一の共通データを参照しているため。
4.  **問**: 複数のモジュールが、グローバルに宣言された構造体（複数データ）を参照している場合の結合度は？
    - **答**: **共通結合**。他モジュールによるデータ変更の影響範囲が広く、依存度が高いため。
5.  **問**: あるモジュールが、`CALL`命令を使わずに`JUMP`命令で別のモジュールを呼び出す場合の結合度は？
    - **答**: **内容結合**。呼び出し先の内部コードに直接依存するため、最も強い結合となる。
6.  **問**: 必要なデータを構造体としてまとめて引数で渡す場合の結合度は？
    - **答**: **スタンプ結合**。データ構造の定義を共有する必要があるため、データ結合よりは強い。

## 6. 要約

- モジュール結合度は、モジュールの**独立性**と**保守性**に関わる重要な指標であり、AがBにどれだけ**巻き込まれるか（依存しているか）**で強さが決まります。
- 結合度は弱い順に、**データ → スタンプ → 制御 → 外部 → 共通 → 内容**となり、できるだけ弱い結合を保つ設計が望ましいです。
- 「渡す値で動作が変われば**制御結合**」「見るだけでも共有データが多ければ**共通結合**」など、データの受け渡し方や参照方法で結合度の種類を正確に判断することが重要です。



---------------------------------------------------------------------------------
User
やはり、外部結合と共通結合が分からない。AとBの例えで詳しく


承知いたしました。外部結合と共通結合の違いは、特に「見るだけなのに、なぜ結合度の強さが違うのか」という点で混乱しやすいポイントです。
モジュールA（あなた）とモジュールB（他人）の例えを使って、この違いが明確にわかるように詳しく解説します。

---

### シナリオ設定：AさんとBさんが同じキッチンで料理をする

*   **あなた（モジュールA）**: スープを作る担当です。
*   **同僚（モジュールB）**: 別の料理（例えばサラダ）を作る担当です。
*   **共有情報**: キッチンの壁にある「ホワイトボード」に書かれたレシピ情報。これは**グローバルデータ**（誰でも見たり書き換えたりできるデータ）に相当します。

Aさん（あなた）の仕事が、Bさん（同僚）の行動によってどれだけ影響を受けるか（= **AのBへの依存度**）を見ていきましょう。

---

### 1. 外部結合の例え：「塩の量」だけを共有する

ホワイトボードには、**たった一つだけ**情報が書かれています。

**【ホワイトボードの情報（単一のグローバル変数）】**
`今日のスープに使う塩の量 = 5g`

*   **Aさん（あなた）の仕事**: この「5g」という情報を見て、スープを作ります。
*   **Bさん（同僚）の行動**: Bさんはサラダを作っていますが、全体の味のバランスを考え、「スープは少し薄味にしよう」と思い、ホワイトボードの塩の量をこっそり「**3g**」に書き換えました。
*   **Aさんへの影響**: あなたはBさんが書き換えたことに気づかず、ホワイトボードの「3g」を見てスープを作りました。結果、あなたが意図したものより薄味のスープが完成してしまいました。

#### 【ここからわかること】
あなたのスープ作り（Aの処理）は、Bさんの行動によって**確かに影響を受けました**。
しかし、その影響は「**塩の量**」という**ピンポイントな一点**に限定されています。Bさんがサラダのドレッシングのレシピを変えようが、他の何をしようが、あなたのスープには直接関係ありません。

これが**外部結合**です。
AはBに依存していますが、その依存は**特定の単一データ**に限られているため、影響範囲が比較的狭く、依存度は**「中程度」**と評価されます。

---

### 2. 共通結合の例え：「レシピ全体」を共有する

今度は、ホワイトボードに**たくさんの情報が書かれた一つの大きなレシピ表**が貼られています。

**【ホワイトボードの情報（グローバルな構造体）】**

| 今日のディナー共通レシピ |
| :--- | :--- |
| 塩 | 5g |
| 砂糖 | 10g |
| オリーブオイル | 30ml |
| 小麦粉 | 100g |
| 牛肉 | 200g |

*   **Aさん（あなた）の仕事**: このレシピ表を見て、スープ（塩、牛肉を使用）とメインディッシュ（塩、オリーブオイル、小麦粉、牛肉を使用）を作ります。
*   **Bさん（同僚）の行動**: Bさんはサラダとデザートを担当しており、同じレシピ表を見ています。Bさんは自分の判断で、レシピ表の**2箇所**を書き換えました。
    1.  「デザート用に、**砂糖**を**50g**にしよう」
    2.  「サラダに使うから、**オリーブオイル**を**50ml**にしよう」
*   **Aさんへの影響**:
    1.  Bさんが「砂糖」を変えたことは、あなたのスープには影響ありませんでした。
    2.  しかし、Bさんが「オリーブオイル」を**50ml**に書き換えたため、あなたがメインディッシュで使おうとしたときに、レシピ通りの量ではオリーブオイルが足りなくなるかもしれません。

#### 【ここからわかること】
今回も、あなたの仕事（Aの処理）は、Bさんの行動によって影響を受けました。重要なのは、その**危険性の度合い**です。

あなたはレシピ表全体に依存しているため、
「**Bさんがレシピ表のどこか一つでも変更すると、自分の仕事のどこかに影響が出るかもしれない**」
というリスクを常に抱えることになります。

Bさんが良かれと思って変更した箇所が、巡り巡ってあなたの仕事の思わぬ部分に影響を与えるのです。影響範囲が広く、予測が困難になります。

これが**共通結合**です。
AはBに依存しており、その依存対象が**複数のデータ項目を含むかたまり（構造体）**であるため、影響範囲が広範囲に及ぶ可能性があります。したがって、依存度は**「強い」**と評価されます。

---

### まとめ：なぜ「見るだけ」で依存度に差がつくのか？

| 比較項目     | 外部結合（単一データ）                                     | 共通結合（複数データ）                                                              |
| :----------- | :--------------------------------------------------------- | :---------------------------------------------------------------------------------- |
| **Aの依存対象**  | 「塩の量」という**点**                                     | 「レシピ全体」という**面**                                                          |
| **Aのリスク**    | Bが**その一点**を変えた時だけ影響を受ける                   | Bが**面のどこか**を変えただけで、自分の仕事の**どこか**に影響が出る**可能性がある** |
| **影響の予測** | しやすい（塩の量だけ気にすればよい）                       | しにくい（レシピの全項目を気にしないといけない）                                    |
| **結論**     | AのBへの依存度は**中程度**                                 | AのBへの依存度は**強い**                                                            |

**結論として、A（あなた）の視点から見ると、依存している情報の「量と範囲」が広ければ広いほど、B（他人）の行動によって自分の仕事が破壊されるリスクが高まります。**

だから、「見るだけ」という行為は同じでも、見ている対象が**単一のデータか、データ構造（かたまり）か**によって、結合度の強さが変わるのです。