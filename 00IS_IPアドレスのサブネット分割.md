
# IPアドレスのサブネット分割：基本ルールから実践設計まで

このドキュメントでは、IPアドレスのサブネット分割について、その根本的なルールから具体的な計算方法、さらには実践的なネットワーク設計思想までを体系的に解説します。具体的な問題演習を通じて、CIDRの仕組みと論理的なネットワーク境界の重要性を深く理解することを目的とします。

## 1. なぜネットワークを分割するのか？：ネットワーク設計の基本思想

IPアドレスを用いたネットワーク構築は、世界共通のルールに基づいて行われますが、そのルールの上で、設計者は組織の要件に合わせてネットワークを効率的かつ安全に運用するために「サブネット分割」を行います。主な目的は以下の3つです。

- **ホスト数の最適化**: 部署やフロアごとに必要なIPアドレス数を算出し、無駄のないようにネットワーク規模を決定します。将来の拡張性も考慮し、柔軟な設計が求められます。

- **セキュリティと管理性の向上**: サブネットを分けることで、通信はルータを経由する必要が生まれます。この境界で通信を制御し、重要なサーバー群や機密情報を扱う部署のネットワークを保護・分離できます。

- **パフォーマンスの維持**: 1つのサブネットは1つの**ブロードキャストドメイン**（ブロードキャスト通信が届く範囲）を形成します。ネットワーク規模が大きすぎると、ブロードキャスト通信が増加しパフォーマンスを低下させるため、適切に分割して影響範囲を限定します。

## 2. 実践演習：特定のIPアドレスを計算する

まず、具体的な問題を解くプロセスを通じて、サブネット計算の基本を理解します。

### 2.1. 問題の提示

> **【出典：平成30年秋期 問34】**  
> あるサブネットでは、ルータやスイッチなどのネットワーク機器にIPアドレスを割り当てる際、割当て可能なアドレスの末尾から降順に使用するルールを採用している。このサブネットのネットワークアドレスを `10.16.32.64/26` とするとき、10番目に割り当てられるネットワーク機器のアドレスはどれか。

### 2.2. ステップ1：サブネット情報の分析

指定されたサブネット `10.16.32.64/26` を分析します。プレフィックス長 **`/26`** は、IPアドレス32ビットのうち、先頭26ビットが**ネットワーク部**、残りの6ビット（32 - 26 = 6）が**ホスト部**であることを示します。

```
|←----- ネットワーク部 (26ビット) -----→|← ホスト部 (6ビット) →|
```

ホスト部は6ビットなので、このサブネットが収容できるアドレスの総数は **2⁶ = 64個** となります。

### 2.3. ステップ2：割り当て可能アドレス範囲の特定

サブネット内には、ホストに割り当てられない特別なアドレスが2つ存在します。

- **ネットワークアドレス**: ホスト部の全ビットが `0` のアドレス。ネットワークそのものを識別します。
- **ブロードキャストアドレス**: ホスト部の全ビットが `1` のアドレス。範囲内の全ホストへの一斉同報通信に使われます。

この2つを除くため、実際にホストに割り当て可能なアドレス数は `64 - 2 = 62個` です。

- **ネットワークアドレス**: `10.16.32.64`
- **ブロードキャストアドレス**: `10.16.32.127`
- **使用可能なホストアドレス範囲**: `10.16.32.65` ～ `10.16.32.126`

### 2.4. ステップ3：割り当てルールを適用し解答を導出

問題のルールは「**割当て可能なアドレスの末尾から降順に使用する**」です。使用可能な末尾のアドレス `10.16.32.126` から降順に10番目のアドレスを求めます。

| 割り当て順 | 第4オクテットの値 | IPアドレス        |
| :---: | :---: | :--- |
| 1番目   | 126               | `10.16.32.126`    |
| 2番目   | 125               | `10.16.32.125`    |
| ...     | ...               | ...               |
| **10番目** | **117**           | `10.16.32.117`    |

計算式で求める場合、`126 - (10 - 1) = 126 - 9 = 117` となります。したがって、正解は **`10.16.32.117`** です。

## 3. サブネットの仕組みと基本ルール

次に、演習の背景にあるIPネットワークの普遍的なルールと構造を解説します。

### 3.1. 世界共通のルール：CIDRとプレフィックス長

IPアドレスの構造と割り当て方法は、**RFC (Request for Comments)** という文書で標準化されており、その中心技術が **CIDR (Classless Inter-Domain Routing)** です。CIDRは、IPアドレスを**ネットワーク部**と**ホスト部**に柔軟に分割し、その境界を**プレフィックス長**で示します。

このルールは **IETF (Internet Engineering Task Force)** などが定める世界共通の標準であり、ネットワーク技術の根幹をなす知識です。

### 3.2. プレフィックス長とブロックサイズの対応関係

プレフィックス長がいくつであれ、ホスト部のビット数からネットワークが収容できるアドレス総数（ブロックサイズ）を計算するルールは、**2のべき乗**に基づく数学的な原則であり、普遍的です。

| プレフィックス | ホスト部<br>ビット数 | 計算式  | アドレス総数<br>(ブロックサイズ) | 境界の刻み幅 |
| :--- | :---: | :--- | :--- | :--- |
| **/25**        | 7ビット          | 2⁷       | **128個**                  | 128単位      |
| **/26**        | 6ビット          | 2⁶       | **64個**                   | 64単位       |
| **/27**        | 5ビット          | 2⁵       | **32個**                   | 32単位       |
| **/28**        | 4ビット          | 2⁴       | **16個**                   | 16単位       |
| **/29**        | 3ビット          | 2³       | **8個**                    | 8単位        |
| **/30**        | 2ビット          | 2²       | **4個**                    | 4単位        |

### 3.3. サブネットの構造：なぜブロックサイズが決まるのか？ (ビットレベルの解説)

`/26` サブネットのブロックサイズが「64」になる理由は、IPアドレスのビット構造にあります。IPv4アドレスは、`.` で区切られた4つの**オクテット**（8ビットの塊）で構成されます。

`/26` の場合、ネットワーク部は26ビット、ホスト部は6ビットです。このホスト部6ビットは、第4オクテト（最後の8ビット）の中に完全に収まります。

```
第4オクテット（8ビット）: [ N N H H H H H H ]
                             ↑   ↑
                           ネットワーク部(2ビット) | ホスト部(6ビット)
```

第4オクテットの上位2ビットがネットワーク部の一部となり、この2ビットの組み合わせによってサブネットが区別されます。

| 第4オクテット上位2ビット | 範囲（10進数） | サブネット例 (`10.16.32.0/24`内) |
| :--- | :--- | :--- |
| `00`xxxxxx           | 0 ～ 63      | `10.16.32.0/26` |
| `01`xxxxxx           | 64 ～ 127    | `10.16.32.64/26` |
| `10`xxxxxx           | 128 ～ 191   | `10.16.32.128/26` |
| `11`xxxxxx           | 192 ～ 255   | `10.16.32.192/26` |

このように、上位2ビットが変わるごとに新しい64個のIPアドレスブロックが始まるため、`/26` のネットワークアドレスは64の倍数になるのです。

## 4. プレフィックス長の役割とネットワーク設計

プレフィックス長は単なるアドレス範囲を示すだけでなく、ネットワークの振る舞いを定義する重要な役割を担います。

### 4.1. 単なる範囲ではない「論理的な境界」

CIDRのルール上、プレフィックス長は**「1つのネットワークとして扱う論理的な境界」**を定義します。これは、人間が定めた論理的な約束事であり、具体的には以下の単位として機能します。

- **ルーティング**: ルータはプレフィックス単位（例: `/26`）で経路情報を認識し、パケットを転送します。
- **アドレス管理**: DHCPサーバはプレフィックス単位でIPアドレスの払い出し範囲を管理します。
- **ブロードキャストドメイン**: ブロードキャスト通信が届く範囲は、プレフィックスによって定義されたサブネット内に限定されます。

例えば、`10.16.32.0/25` は「128個のアドレス全体で1つのネットワーク」ですが、これを `10.16.32.0/26` と `10.16.32.64/26` に分けると、「それぞれが独立した2つのネットワーク」として扱われます。

### 4.2. ネットワークの分割とVLSM

1つの大きなネットワークを複数の小さなネットワークに分割したい場合、**プレフィックス長を長く（数値を大きく）**します。これにより、ネットワーク部が増えてホスト部が減り、より小さなサブネットが生まれます。

- **元のネットワーク**: `10.16.32.0/25` （1つのネットワーク、128個のアドレス）
- **`/26`に分割**: 2つのネットワーク（各64個）に分割
  - `10.16.32.0/26`
  - `10.16.32.64/26`
- **`/27`に分割**: 4つのネットワーク（各32個）に分割
  - `10.16.32.0/27`
  - `10.16.32.32/27`
  - `10.16.32.64/27`
  - `10.16.32.96/27`

この考え方は、必要なホスト数に応じてネットワークサイズを柔軟に設計する **VLSM (可変長サブネットマスク)** の基礎となります。例えば、拠点間接続には `/30`、小規模部署には `/27`、大規模フロアには `/25` を割り当てるなど、IPアドレスを効率的に活用できます。