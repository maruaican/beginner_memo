# SQL結合条件の解説：AND EMP.部署番号 = DEP.部署番号

令和6年春 応用情報技術者試験（午後） データベース問題より

## １．このSQLの目的

指定された管理者が評価している従業員の一覧を取得し、  
その従業員が所属する部署情報とあわせて出力する。

SELECT DEP.部署番号, DEP.部署名, EMP.従業員番号, EMP.従業員氏名  
FROM 従業員 EMP  
INNER JOIN 部署 DEP  
ON EMP.会社番号 = DEP.会社番号  
AND EMP.部署番号 = DEP.部署番号 -- ←★ 焦点  
WHERE  
EMP.会社番号 = :会社番号  
AND DEP.管理者番号 = :管理者番号  
ORDER BY EMP.従業員番号;

## ２．AND EMP.部署番号 = DEP.部署番号 の意味

この行は、従業員が所属する部署（EMP）と、部署マスタ（DEP）を正しく結びつけるための条件。

\- EMP.部署番号：従業員が所属している部署の番号  
- DEP.部署番号：部署マスタ側の部署番号  
両者を結ぶことで、部署名（DEP.部署名）、管理者番号（DEP.管理者番号）など、部署に関する追加情報を取得できるようになる。

## ３．なぜこの結合条件が必要なのか？

部署番号は、部署を特定するための主キーの一部であり、  
同じ「部署番号」が他社にも存在する可能性がある。  
そのため、以下の2条件が必要：  
EMP.会社番号 = DEP.会社番号  
AND EMP.部署番号 = DEP.部署番号  
  
これにより、「同一会社内での同一部署」に正しく結合できる。

## ４．この条件がなければどうなるか？

EMP.部署番号 = DEP.部署番号 を書き忘れると、会社番号が同じで部署番号が異なる複数の部署にマッチしてしまい、間違った部署情報（部署名、管理者）が結びつき、誤った出力結果となる。

## ５．この箇所で問われる力（試験的観点）

| 観点 | 説明 |
|----|----|
| リレーションの構造理解 | 「部署番号」が外部キーであることを理解しているか |
| 結合条件の設計力 | 必要なキーすべてをON句に書くことの意義を理解しているか |
| 実務感覚 | 同名の項目でも、意味と文脈によって結合の要否を判断する力 |

## ６．まとめ：この行の重要性

\- EMP.部署番号 = DEP.部署番号 は、従業員と部署を正しく結びつけるための核心部分。  
- 部署情報の取得には必須であり、ON句での記述が不可欠。  
- 試験では、結合条件に漏れがある選択肢を誤りと見抜けるかが鍵となる。
