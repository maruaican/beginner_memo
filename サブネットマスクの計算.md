
### **サブネットマスクとCIDRの丁寧な解説**

#### **【大前提】なぜサブネットマスクが必要なのか？**

まず、IPアドレスとサブネットマスクがなぜセットで使われるのかを理解することが大切です。

IPアドレス（例：`192.168.1.10`）は、インターネット上の「住所」のようなものです。しかし、この住所だけでは「どの地域の、どの家」なのかが分かりません。

*   **ネットワーク部（地域の情報）**: 住所でいう「市区町村」に相当します。同じネットワークにいるコンピュータは、この部分が同じ値になります。
*   **ホスト部（家の情報）**: 住所でいう「番地や部屋番号」に相当します。同じネットワーク内で、各コンピュータを識別するための番号です。

この「どこまでが地域の情報で、どこからが家の情報か」を区別するための目印が**サブネットマスク**です。

#### **【補足解説】CIDR（サイダー）とは何か？**

昔は、IPアドレスをクラスA, B, Cといったクラスに分けて管理していました（クラスフルアドレッシング）。
*   クラスA: `255.0.0.0`
*   クラスB: `255.255.0.0`
*   クラスC: `255.255.255.0`

しかし、この方法では「大きすぎる」か「小さすぎる」ネットワークしか作れず、IPアドレスの無駄が多く発生していました。

そこで登場したのが**CIDR (Classless Inter-Domain Routing)**です。
CIDRは、クラスという概念をなくし、IPアドレスのネットワーク部を**1ビット単位で柔軟に指定できる**ようにした仕組みです。

その指定方法が、IPアドレスの末尾に`/`（スラッシュ）と数字を付ける**プレフィックス長**表記です。

`192.168.1.10/22`

この`/22`が「**IPアドレスの先頭から22ビット分がネットワーク部ですよ**」という意味になります。サブネットマスクは、このCIDRの指定をコンピュータが理解できる32ビットの数値で表現したものです。

---

### **【本題】/22 を「2進数の重み」でサブネットマスクに変換する方法**

ここから、元の解説をさらに噛み砕いて、手順を追って解説します。

#### **手順0：知っておくべき2つの大原則**

計算を始める前に、2つの基本ルールを頭に入れておきましょう。

1.  **CIDRの数字の意味**
    `/22`は、サブネットマスクを2進数で表したときに、**先頭から`1`が22個並ぶ**ことを意味します。サブネットマスクは全部で32ビットなので、残りの `32 - 22 = 10`個は`0`になります。

2.  **2進数と10進数の変換ルール（オクテットの重み）**
    サブネットマスクは8ビットずつの4つのブロック（オクテット）に分かれています。各ビットには、それぞれ「重み」と呼ばれる数値が割り当てられています。

| 2進数の桁 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **重み** | **128** | **64** | **32** | **16** | **8** | **4** | **2** | **1** |

2進数で`1`になっている部分の**重みをすべて足し算する**と、10進数に変換できます。
例えば、`11000000` なら、`1`が立っている「128」と「64」の重みを足して `128 + 64 = 192` となります。

この2つのルールさえ分かっていれば、どんなCIDR表記でも必ず計算できます。

#### **手順1：/22 を32ビットの2進数に展開する**

大原則1に従い、`/22`を2進数で表現します。
「先頭から1が22個、残りは0」です。これを8ビットごとに区切って見やすくします。
全部で３２ビットなので、右から１０ビット（＝３２ー２２）が０になる。


`11111111 . 11111111 . 11111100 . 00000000`
↑8個↑　　　↑8個↑　　　↑6個↑　　　↑0個↑
合計 8 + 8 + 6 = 22個の`1`

#### **手順2：各オクテットを10進数に変換する**

大原則2の「重み」を使って、オクテットごとに10進数へ変換します。

*   **第1オクテット： `11111111`**
    `1`が立っている重みを全部足します。
    `128 + 64 + 32 + 16 + 8 + 4 + 2 + 1 = 255`
    （※全てのビットが1の場合は、必ず255になります。これは覚えておくと便利です。）

*   **第2オクテット： `11111111`**
    第1オクテットと同じなので、`255`です。

*   **第3オクテット： `11111100`**
    ここがポイントです。`1`が立っている部分の重み**だけ**を足します。
    `128 + 64 + 32 + 16 + 8 + 4 = 252`
    （`0`になっている「2」と「1」の重みは足しません。）

*   **第4オクテット： `00000000`**
    `1`が一つもないので、足す重みがありません。合計は`0`です。
    （※全てのビットが0の場合は、必ず0になります。）

#### **手順3：結果をまとめる**

各オクテットで計算した10進数を`.`（ドット）でつなげます。

`255.255.252.0`

これが `/22` のサブネットマスクです。

---

### **暗算のコツと確認問題**

#### **暗算化のコツ**

この計算に慣れると、暗算でもできるようになります。

1.  CIDRの`/X`が与えられたら、Xを8で割ってみる。
    *   例: `/22` → 22 ÷ `8` = 2 余り 6
    *   この「2」は、`255`が2回続くことを意味します → `255.255`
    *   この「余り6」は、3番目のオクテットの先頭から`1`が6個並ぶことを意味します。

2.  余りの部分だけ計算する。
    *   「余り6」→ `11111100`
    *   ６個分の重みを足す: 128+64+32+16+8+4 = 252

3.  残りはすべて`0`なので、`0`を入れる。

4.  合体させて `255.255.252.0` となります。

#### **確認問題（再解説）**

**Q: /27 のサブネットマスクを求めよ。**

1.  **2進数に展開**
    `/27` → 先頭から`1`が27個、残りは`0`が5個。
    `11111111 . 11111111 . 11111111 . 11100000`
    (8個 + 8個 + 8個 + 3個 = 27個)

2.  **10進数に変換**
    *   第1オクテット (`11111111`) → `255`
    *   第2オクテット (`11111111`) → `255`
    *   第3オクテット (`11111111`) → `255`
    *   第4オクテット (`11100000`) → `1`が立っている重みだけ足す: `128 + 64 + 32 = 224`

3.  **まとめる**
    `255.255.255.224`

**答え：255.255.255.224**

この方法を使えば、どんなCIDR表記でも、2進数の重みを足し算するだけで機械的にサブネットマスクを求めることができます。


ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー


**「クラスA」「クラスB」「クラスC」とは、CIDRが登場する前に使われていた、IPアドレスを管理するための「昔のルール（分け方）」**のことです。これを**クラスフルアドレッシング**と呼びます。

一言でいうと、**IPアドレスの先頭の数字を見るだけで、ネットワークの規模（大きさ）をざっくりと決めてしまう方法**です。

---

### **クラス分けの仕組み：どうやって見分けるのか？**

IPアドレスは4つのオクテット（数字）で構成されていますが、**クラス分けでは、最初のオクテットの数字だけで、そのアドレスがどのクラスに属するかが決まります。**

| クラス | 第1オクテットの範囲 | デフォルトのサブネットマスク | ネットワークの規模 | 用途のイメージ |
| :--- | :--- | :--- | :--- | :--- |
| **クラスA** | `1` ～ `126` | `255.0.0.0` (`/8`) | **巨大** | 国や巨大多国籍企業レベル |
| **クラスB** | `128` ～ `191` | `255.255.0.0` (`/16`) | **大規模** | 大企業や大学レベル |
| **クラスC** | `192` ～ `223` | `255.255.255.0` (`/24`) | **小規模** | 中小企業や家庭内LANレベル |
| クラスD | `224` ～ `239` | (なし) | - | マルチキャスト用（特定グループへの一斉配信） |
| クラスE | `240` ～ `255` | (なし) | - | 実験・研究用 |

※ `0`と`127`で始まるアドレスは特殊な用途で使われるため、通常のクラスAには含まれません。

---

### **各クラスの詳しい解説**

クラス分けのルールでは、ネットワーク部とホスト部の区切りが**クラスごとに固定**されていました。

#### **クラスA (`/8`)**

*   **IPアドレスの例:** `10.1.2.3`
*   **構造:** `ネットワーク部 . ホスト部 . ホスト部 . ホスト部`
*   **サブネットマスク:** `255.0.0.0`
*   **特徴:**
    *   ネットワーク部の範囲は狭い（約126個しか作れない）。
    *   しかし、1つのネットワークの中に**約1677万台**（256 × 256 × 256）ものコンピュータ（ホスト）を接続できる。
    *   あまりに規模が大きすぎるため、使い勝手が悪く、ほとんど使われませんでした。

#### **クラスB (`/16`)**

*   **IPアドレスの例:** `172.16.4.5`
*   **構造:** `ネットワーク部 . ネットワーク部 . ホスト部 . ホスト部`
*   **サブネットマスク:** `255.255.0.0`
*   **特徴:**
    *   ネットワーク部の数は約1万6000個。
    *   1つのネットワークの中に**約6万5000台**（256 × 256）のホストを接続できる。
    *   大規模な組織向けですが、これでもまだ大きすぎることが多々ありました。

#### **クラスC (`/24`)**

*   **IPアドレスの例:** `192.168.1.6`
*   **構造:** `ネットワーク部 . ネットワーク部 . ネットワーク部 . ホスト部`
*   **サブネットマスク:** `255.255.255.0`
*   **特徴:**
    *   ネットワーク部の数は約209万個と非常に多い。
    *   1つのネットワークの中に接続できるホストは**254台**（0と255は特殊な用途で使えないため）と小規模。
    *   最も一般的に使われたクラスです。

---

### **【最重要】なぜクラス分けは使われなくなったのか？**

このクラスフルという考え方には、非常に大きな問題がありました。それは**「IPアドレスの無駄遣いが激しい」**ことです。

**具体例:**
ある会社が、**300台**のコンピュータを接続するネットワークを作りたいとします。

*   **クラスC**では、最大254台までしか接続できないので**足りません**。
*   仕方なく**クラスB**を割り当てると、約6万5000台分のIPアドレスがもらえます。
*   しかし、実際に使うのは300台だけ。**残りの約6万5000個のIPアドレスはすべて無駄**になってしまいます。

このように「大・中・小」の3サイズしかなく、帯に短したすきに長し、という状況が多発しました。インターネットが普及するにつれて、このままではIPアドレスが枯渇してしまうことが明らかになりました。

### **【結論】クラスとCIDRの関係**

そこで登場したのが、あなたが先に学んだ**CIDR（サイダー）**です。

*   **クラス（昔のルール）**: ネットワークの区切りは`/8`, `/16`, `/24`の**3種類に固定**。
*   **CIDR（今のルール）**: ネットワークの区切りを`/1`～`/32`まで**1ビット単位で自由に設定**できる。

CIDRを使えば、先ほどの「300台のネットワーク」には、510台（2の9乗-2）のホストが接続できる`/23`（`255.255.254.0`）を割り当てることができます。これにより、クラスBを使うよりもはるかにIPアドレスを節約できるのです。

このように、CIDRはクラスの問題点を解決した、より柔軟で効率的な仕組みです。
現在では、**ほぼすべてのネットワークでCIDRが使われています**が、クラスの考え方は、

*   プライベートIPアドレスの範囲（`10.x.x.x`、`172.16.x.x`、`192.168.x.x`など）
*   ネットワークの基礎を学ぶ上での歴史的背景

として、今でも知識として知っておくことが非常に重要です。