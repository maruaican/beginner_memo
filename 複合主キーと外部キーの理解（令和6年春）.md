# 部署表と従業員表における複合主キーと外部キーの理解

## 1. はじめに

この資料は、応用情報技術者試験（令和6年春）に出題されたデータベース設計の問題における、「会社番号」「部署番号」「従業員番号」の関係、および複合主キーと外部キーの考え方を、図解とともに整理したものです。

## 2. テーブル構造の整理

以下の2つのテーブルを扱います。

① 部署表（部署）  
　- 会社番号（主キーの一部）  
　- 部署番号（主キーの一部）  
　→ 会社ごとに部署番号が割り当てられるため、「会社番号＋部署番号」で部署を一意に特定します。  
  
② 従業員表（従業員）  
　- 会社番号（主キーの一部）  
　- 従業員番号（主キーの一部）  
　- 部署番号（外部キー）  
　→ 「会社に属する従業員」を表します。部署番号は従業員が所属する部署を表します。

## 3. 複合主キーと外部キーの整理

部署表の主キー：  
　→ （会社番号, 部署番号）  
  
従業員表の主キー：  
　→ （会社番号, 従業員番号）  
  
従業員表の外部キー：  
　→ 部署番号（単独）ではなく、部署表の（会社番号, 部署番号）を参照していると考えるのが自然です。

## 4. SQL文とON句の理解

試験問題のSQLでは以下のような結合が登場します：  
  
FROM 従業員 EMP  
JOIN 部署 DEP  
ON EMP.会社番号 = DEP.会社番号  
AND EMP.部署番号 = DEP.部署番号  
  
これは、従業員が所属する部署（EMP.部署番号）と、部署そのもの（DEP.部署番号）を結びつけるために、「会社番号＋部署番号」の両方で結合しているのです。  
文脈上、部署は会社ごとに異なるため、会社番号だけでは不十分で、部署番号だけでも不足です。両方必要です。

## 5. なぜER図やキーの概念が出てくるか

ER図やキー（主キー・外部キー）の概念は、SQL文を素早く正確に書くための前提知識です。特にJOIN句でどの項目を結合条件に書くかを判断するには、「何を一意に特定すべきか」「どの項目がどこを参照しているか（外部キー）」という構造的な理解が不可欠です。

## 6. まとめ

・部署は「会社番号＋部署番号」で一意に特定される（複合主キー）  
・従業員表はその部署を参照するため、同じく「会社番号＋部署番号」で部署表を参照する必要がある  
・ON句にANDが必要なのは、この「複合キーで結合する」必要があるからである  
・SQLを素早く読むには、背後のリレーション設計を理解しておく必要がある
