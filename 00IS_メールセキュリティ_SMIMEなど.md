## １．S/MIMEの解説
---
# １　送信者側（メール作成）

送信者（メール送信）
 ├─ **(1)メール本文**
 │     （例：本文テキスト）
 │
 ├─ **(2)電子署名**を作成
 │     ├─ メール本文をハッシュ化 ＝ ダイジェスト
 │     ├─ ダイジェストを`送信者秘密鍵`で暗号化
 │     └─ → これが**電子署名**
 │
 └─ **(3)電子証明書**を添付
       ├─ `送信者公開鍵`
       └─ CA署名（証明書全体に対する認証局の署名）

[送信パッケージ]
  → 「メール本文 ＋ 電子署名 ＋ 電子証明書」
---
# ２　受信者側（メール受信）

受信者（メール受信）
  │
  ├─ Step1: **(3)電子証明書** 自体の正当性を検証
  │     ├─ CA署名を `CA公開鍵(公式サイトから持ってくる)`   で検証
  │     └─ → OKなら「証明書内の`送信者公開鍵`は信頼できる」
  │
  ├─ Step2: **(2)電子署名** の検証
  │     ├─ 証明書から`送信者公開鍵`を取り出す
  │     ├─ 電子署名を[復号]→ ダイジェスト①
  │     ├─ メール本文を[ハッシュ化] → ダイジェスト②
  │     └─ ダイジェスト①と②を比較
  │
  └─ 判定
        ├─ 一致 → 改ざんなし ＆ 本人性確認OK
        └─ 不一致 → 改ざん or なりすましの可能性
---

# ３　要点まとめ

* 送信者が送るのは **「本文＋署名＋証明書」** の３点セット
* 受信者は **CA公開鍵**と**送信者公開鍵**をそれぞれ用途に応じて使い分ける

  * CA公開鍵 → **電子証明書**そのものの検証
  * 証明書内の送信者公開鍵 → 送信者が送付した**電子署名**の検証
* 検証が通れば「改ざんされていない」「本人が送った」が確認できる

---


##　２　ハイブリッド暗号方式
電子署名の流れに **本文暗号化（S/MIMEの機能の1つ）** を加えて整理してみましょう。
ポイントは「本文は共通鍵で暗号化」「共通鍵は受信者の公開鍵で暗号化して送る」という二段構えです。

---

# １　送信者側（暗号化付きメール作成）

```
送信者（メール送信）
 ├─ メール本文（平文）
 │
 ├─ Step1: 共通鍵を生成
 │     └─ 一時的なランダム共通鍵（例：AESキー）
 │
 ├─ Step2: 本文を暗号化
 │     └─ 本文を共通鍵で暗号化 → 暗号文
 │
 ├─ Step3: 共通鍵を暗号化
 │     └─ 共通鍵を「受信者の公開鍵」で暗号化 → 鍵カプセル
 │
 ├─ Step4: 電子署名を作成
 │     ├─ 暗号文をハッシュ化 → ダイジェスト
 │     ├─ ダイジェストを「送信者秘密鍵」で暗号化
 │     └─ → 電子署名
 │
 └─ Step5: 電子証明書を添付
       ├─ 送信者公開鍵
       └─ CA署名（証明書全体の保証）

[送信パッケージ]
 → 「暗号文 ＋ 鍵カプセル ＋ 電子署名 ＋ 電子証明書」
```

---

# ２　受信者側（暗号化メールの受信）

```
受信者（メール受信）
  │
  ├─ Step1: 共通鍵を復号
  │     └─ 鍵カプセルを「自分の秘密鍵」で復号 → 共通鍵入手
  │
  ├─ Step2: 本文を復号
  │     └─ 暗号文を共通鍵で復号 → 平文本文を得る
  │
  ├─ Step3: 電子証明書の正当性確認
  │     └─ CA署名を CA公開鍵 で検証 → 証明書OK
  │
  ├─ Step4: 電子署名を検証
  │     ├─ 証明書から送信者公開鍵を取り出す
  │     ├─ 電子署名を復号 → ダイジェスト①
  │     ├─ 平文本文をハッシュ化 → ダイジェスト②
  │     └─ ダイジェスト①と②を比較
  │
  └─ 判定
        ├─ 復号成功 → 受信者本人のみが読める（機密性）
        ├─ 署名一致 → 改ざんなし ＆ 本人性確認
        └─ 不一致 → 改ざん or なりすまし
```

---

# ３　要点まとめ

* **共通鍵暗号**（AESなど）は速いので本文暗号化に利用
* **公開鍵暗号**（RSAなど）は遅いので「共通鍵を安全に渡す」用途で利用
* この仕組みを「ハイブリッド暗号方式」と呼ぶ
* S/MIMEは「電子署名」＋「暗号化」を組み合わせ、

  * 機密性（本文の暗号化）
  * 完全性（改ざん検知）
  * 認証（本人性確認）
    を同時に実現する

---




##　３　PGP
いいですね！😊
S/MIME と PGP（Pretty Good Privacy）は **「暗号化＋電子署名を実現するメール技術」** ですが、仕組みや前提が異なります。応用情報でも頻出の比較ポイントをまとめます。

---

# １　S/MIME と PGP の比較表

| 項目            | **S/MIME**                                      | **PGP**                       |
| ------------- | ----------------------------------------------- | ----------------------------- |
| **公開鍵の配布方法**  | **認証局（CA）発行の電子証明書**を利用（PKI方式）                   | **ユーザー同士で直接交換**（Web of Trust） |
| **信頼の根拠**     | 信頼できる第三者機関（CA）の署名                               | 友人・知人など人間関係を基盤にした相互署名         |
| **証明書管理**     | OS・メールソフトに組み込まれた証明書ストア                          | 各ユーザーが自分で鍵リングを管理              |
| **導入のしやすさ**   | 組織導入向け（企業・官公庁などで使いやすい）                          | 個人利用やコミュニティ向け                 |
| **互換性**       | Outlook, Thunderbird, Apple Mailなど主要クライアントで標準対応 | 専用ソフトやプラグイン（例：GnuPG）が必要       |
| **試験でのキーワード** | 「CA」「PKI」「証明書」「認証局」                             | 「相互署名」「Web of Trust」「鍵リング」    |

---

# ２　試験での着眼点

* **S/MIME** → 「PKIを利用」「認証局が信頼の源」
* **PGP** → 「Web of Trust」「ユーザー同士の信頼関係」
* 出題者は「S/MIMEもPGPも暗号化と署名を提供するが、信頼の仕組みが異なる」という点を狙うことが多いです。

---

# ３　一問一答（頻出パターン）

**問題**：メールの暗号化と電子署名を行う仕組みであり、認証局を利用せずにユーザー間の相互署名によって信頼関係を構築するものはどれか。

* ア S/MIME
* イ PGP
* ウ SSL/TLS
* エ IPSec

**回答**：イ PGP

**解説**：
S/MIME は認証局（CA）を利用する。
PGP は「Web of Trust」に基づいて、ユーザー同士で公開鍵を署名して回る仕組み。
SSL/TLS や IPSec は通信経路の暗号化であり、メール暗号化ではない。

---
##　Web of Trust　とは？
「Web of Trust（信頼の網）」は **PGPを他の暗号化方式と区別する決定的なキーワード** なんです。
試験でPGPが出るときは、ほぼ必ずこの言葉がヒントになります。
---
# １　PKI（S/MIME）の信頼の仕組み
* PKI（公開鍵基盤）では **認証局（CA）** が「この公開鍵は本人のもの」と保証する。
* つまり「**中央集権的**な信頼モデル」
* 信頼の根拠は **CA署名** に一本化されている。

---
# ２　PGPの信頼の仕組み
* PGPには中央の認証局が存在しない。
* 公開鍵が本当にその人のものかを、**知人・友人などの署名による相互保証**で担保する。
* ある人の鍵を別の人が署名して回ることで、信頼が **網の目状（Web）** に広がっていく。
* この相互署名の仕組みを **Web of Trust** と呼ぶ。

---

# ３　なぜキーワードなのか

* 試験では「PGP＝Web of Trust」と覚えているかを確認する設問が多い。
* 出題者は次のように狙ってきます：

  * 「認証局を利用する」→ S/MIME
  * 「Web of Trustによる信頼モデル」→ PGP
* つまり **PGPの固有の特徴を一言で表すキーワードが Web of Trust**。

---

# ４　一問一答

**問題**：公開鍵暗号を用いたメール暗号化方式のうち、ユーザー間の相互署名による「Web of Trust」を信頼の根拠とする方式はどれか。

* ア S/MIME
* イ PGP
* ウ SSL
* エ IPSec

**回答**：イ PGP

**解説**：
S/MIMEはCA署名、SSLやIPSecは通信路の暗号化。
PGPだけが「Web of Trust」という用語と強く結びついている。

---
👉 つまり、「PGPと聞いたらWeb of Trust」「Web of Trustと聞いたらPGP」ぐらいで直結させて覚えるのが得点のコツです。
