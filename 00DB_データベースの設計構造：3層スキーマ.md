
***

# データベースの設計構造：3層スキーマとデータモデルの体系的整理

## 1. 概要

データベースの設計と構造を理解するためには、大きく分けて2つの重要な概念的枠組みが存在します。

1.  **ANSI/X3/SPARCの3層スキーマ構造**: データベースを「利用者」「論理的な全体構造」「物理的な記録媒体」という3つの異なる視点（抽象レベル）で分離して定義するための**理論的枠組み**です。
2.  **データモデル**: データベースを構築する際の**設計工程（実務手順）**を段階的に示したものです。通常、「概念」「論理」「物理」の順に具体化していきます。

これらは密接に関連していますが、異なる体系であるため混同されやすいです。本ドキュメントでは、それぞれの定義を明確にし、その関係性を体系的に解説します。

---

## 2. ANSI/X3/SPARCの3層スキーマ構造

3層スキーマ構造は、データベースの定義を「外部スキーマ」「概念スキーマ」「内部スキーマ」の3つの層に分けて管理するモデルです。このアプローチにより、各層の独立性が高まり、設計の複雑さが軽減されます。

```
   利用者の視                       記録媒体の視点
      ↑                                  ↑
  外部スキーマ                        内部スキーマ
（ビュー）                          （ファイル編成・インデックス）
      │                                │
      └───────── 概念スキーマ ─────────
             （論理的な全体構造）
```

### 2.1. 概念スキーマ (Conceptual Schema)
*   **定義**: データベース化する対象の業務とデータの内容を、実装に依存しない**論理的な構造**として記述したものです。データベース全体の構造を定義します。
*   **由来**: 「conceptual（概念的）」な、抽象構造であることに由来します。
*   **具体例**:
    *   E-R図の作成
    *   テーブル定義
    *   表の正規化

### 2.2. 外部スキーマ (External Schema)
*   **定義**: データベースの**利用者やアプリケーションからの見方**を記述したものです。データベース全体の中から、特定の利用者が必要とする部分集合（ビュー）を定義します。
*   **由来**: 利用者から見て「external（外部的）」な姿であることに由来します。
*   **別称**: **サブスキーマ (Subschema)** とも呼ばれます。
*   **具体例**:
    *   SQLのビュー (VIEW)
    *   特定部門専用のデータビュー

### 2.3. 内部スキーマ (Internal Schema)
*   **定義**: データを**記録媒体（記憶装置）上にどのような形式で格納するか**を記述したものです。物理的な実装方法を定義します。
*   **由来**: 装置に近い「internal（内部的）」な表現であることに由来します。
*   **具体例**:
    *   ファイル編成
    *   インデックスの設定
    *   データ圧縮方式
    *   データの格納場所

### 2.4. 3層スキーマの必要性
この構造は、以下のような課題を解決するために考案されました。
*   **課題**: 利用者ごとに必要なデータの見方が異なる上、データの物理的な格納方式はDBMSやハードウェアに依存します。これらが混在すると、設計が複雑化し、一部の変更が全体に影響を及ぼしやすくなります。
*   **解決**: 3層に「役割分担」させることで、データ独立性を確保します。
    *   **利用者ごとの見方**: 外部スキーマが担当
    *   **全体の論理設計**: 概念スキーマが担当
    *   **物理的な記憶装置構造**: 内部スキーマが担当

---

## 3. データモデル（設計工程）

データモデルは、データベースを設計・実装する前に行う設計の各段階、およびその成果物（設計図）を指します。通常、以下の3段階のモデルを順に作成し、具体化を進めます。

### 3.1. 概念データモデル
*   **定義**: 業務で扱うデータ（実体）とその関係性を表現する、最も抽象度の高いモデルです。
*   **特徴**: 特定のDBMS（データベース管理システム）に依存しません。
*   **具体例**:
    *   **E-R図**

### 3.2. 論理データモデル
*   **定義**: 概念データモデルを、利用するDBMSの種類を考慮して、より具体的なデータ構造に変換したモデルです。
*   **特徴**: DBMSに依存しますが、まだ物理的な格納方法には触れず、「論理的」な構造を示します。
*   **具体例**:
    *   **関係モデル**: RDB（リレーショナルデータベース）で主流
    *   **階層モデル**
    *   **ネットワークモデル**
    *   **ドキュメント指向モデル**: MongoDBなどで使用

### 3.3. 物理データモデル
*   **定義**: 論理データモデルを元に、実際の記録媒体への格納を考慮して、さらに具体的に設計したモデルです。
*   **特徴**: パフォーマンスや記憶効率を考慮し、ハードウェアやDBMSの仕様に強く依存した「物理的」な設計を行います。
*   **具体例**:
    *   インデックスの設計
    *   データ型のサイズや精度の定義
    *   テーブルの物理的な分割方式（パーティショニング）
    *   容量の見積もり

### 3.4. 実務におけるデータモデルの扱い
*   現場ごとに扱いは異なりますが、3段階の厳密なデータモデル作成を常に行っている現場は多くないのが実情です。
*   多くの現場では3段階をひとまとめに行い、その成果物として、テーブル、列とその型、キー、インデックス、テーブル間の関係性（カーディナリティ）、想定レコード数などを記述した**E-R図**や**テーブル定義書**を作成します。これらの資料を基に、DBの容量やハードウェアのスペックが決定されます。

---

## 4. 3層スキーマとデータモデルの関係性

「3層スキーマ」と「データモデル」は、同じデータベース構造を異なる視点から捉えたものであり、両者には深い対応関係があります。これが最も混同しやすいポイントです。

### 4.1. 目的と視点の違い

*   **3層スキーマ**: DBの抽象レベルを「利用者視点」「論理的全体構造」「物理的実装視点」に分けて整理するための**理論的枠組み**です。
*   **データモデル**: 「概念→論理→物理」という流れで具体化していく**設計工程**です。

### 4.2. 各層・各段階の対応関係

両体系の各要素は、以下のように対応付けることができます。

```
利用者視点      ← 外部（スキーマ）
全体の論理構造  ← 概念（スキーマ） ≒ 論理（データモデル）
記録媒体視点    ← 内部（スキーマ） ≒ 物理（データモデル）
```

| 観点／抽象レベル   | ANSI 3層スキーマ | データモデル設計段階            |
| ------------------ | ---------------- | ------------------------------- |
| **利用者視点**     | **外部スキーマ** | （ビュー定義に相当）            |
| **全体論理構造**   | **概念スキーマ** | **概念データモデル → 論理データモデル** |
| **記録媒体視点**   | **内部スキーマ** | **物理データモデル**            |

**※注意点**: 「概念スキーマ」と「概念データモデル」は名称が似ていますが、前者は理論枠組み上の層、後者は設計工程の最初の段階を指します。

### 4.3. 用語の由来と意味の整理

各キーワードが「なぜそのように呼ばれるか」を理解すると、区別しやすくなります。

| キーワード         | 属する体系     | 意味                                     | なぜその名前か（由来）                                               |
| ------------------ | -------------- | ---------------------------------------- | -------------------------------------------------------------------- |
| **外部スキーマ**   | 3層スキーマ    | 利用者やアプリごとの見方（ビュー）       | 利用者から見て「**外部 (external)**」に見える姿だから                  |
| **概念スキーマ**   | 3層スキーマ    | DB全体の論理的構造（業務のデータ関係）   | 「**conceptual (概念的)**」な、実装に依存しない抽象構造だから          |
| **内部スキーマ**   | 3層スキーマ    | 記録媒体への物理的な格納方法（ファイル編成・索引） | 「**internal (内部的)**」な、装置に近い表現だから                      |
| **論理データモデル** | データモデル   | 概念モデルをDBMS上で表現する段階（例：関係モデル） | DBMSに依存するが、まだ「**論理的 (logical)**」に構造を表す段階だから   |
| **物理データモデル** | データモデル   | 実際の格納設計（インデックス、容量、分割方式） | 「**physical (物理的)**」なデバイスや記録方式を考慮するから            |

### 4.4. 設計段階における要素の呼び名の変化

データモデルの設計段階が進むにつれて、同じ対象を指す要素の呼び名が変わる点にも注意が必要です。

| 概念データモデル<br>(E-R図) | 論理データモデル<br>(関係モデル) | 物理データモデル<br>(テーブル構造) |
| -------------------------- | ------------------------------- | --------------------------------- |
| エンティティ (Entity)      | 関係 (Relation)                 | テーブル (Table)                  |
| 属性 (Attribute)           | 属性 (Attribute)                | 列 (Column)                       |
| インスタンス (Instance)    | タプル (Tuple)                  | 行 (Row)                          |

---

## 5. 情報処理技術者試験におけるポイント

### 5.1. 出題例と解説

**【出題例】** (平成31年春期 問26)
> データベースを記録媒体にどのように格納するかを記述したものはどれか。
>
> ア. 概念スキーマ
> イ. 外部スキーマ
> ウ. サブスキーマ
> エ. 内部スキーマ

**【正解】 エ. 内部スキーマ**
**【解説】** データを記憶装置（記録媒体）上にどのような形式で格納するかを記述するのは「内部スキーマ」の定義そのものです。ファイル編成やインデックスの設定などがこれに該当します。

### 5.2. 出題パターンと着眼点

試験では、各スキーマの定義を混同させる問題が頻出します。

*   「データベースを**記録媒体にどう格納**するか？」 → **内部スキーマ**
*   「**利用者が必要とする部分集合**は？」 → **外部スキーマ**（または**サブスキーマ**）
*   「**業務全体の論理構造**は？」 → **概念スキーマ**

### 5.3. よくある誤解と正しい知識

*   **誤解**: 「サブスキーマは内部スキーマの一部である」
    *   **正しい知識**: サブスキーマは**外部スキーマの別称**です。

*   **誤解**: 「データベース設計の物理モデルは内部スキーマのことではない」
    *   **正しい知識**: ほぼ同義です。設計工程では「物理データモデル」、理論的枠組みでは「内部スキーマ」という用語が使われます。

*   **狙われやすい混同**:
    *   概念スキーマと内部スキーマの役割の混同。
    *   3層スキーマ体系とデータモデル体系の用語の混同（例：「内部スキーマは論理モデルである」→誤り）。

### 5.4. 一問一答形式での理解度チェック

| Q | 質問                                                     | A | 回答と解説                                                                           |
|---|----------------------------------------------------------|---|--------------------------------------------------------------------------------------|
| 1 | 利用者ごとのビューを定義するのはどのスキーマ？             |   | **外部スキーマ**。<br>利用者単位の見方を記述するもので、SQLのビューが典型例です。         |
| 2 | データベースの全体的な論理構造を記述するのは？             |   | **概念スキーマ**。<br>E-R図の作成や正規化など、データベース全体の論理設計が対象です。   |
| 3 | 記録媒体における格納形式を記述するのは？                   |   | **内部スキーマ**。<br>ファイル編成やインデックスなど、物理的な格納方法が対象です。        |
| 4 | サブスキーマはどのスキーマの別名？                         |   | **外部スキーマ**。<br>利用者別に定義されるデータベースの部分構造を指します。            |
| 5 | 「RDBMSが関係モデルを採用する」という決定は、どのスキーマに最も関わる？ |   | **概念スキーマ**。<br>業務をどのような論理構造で表現するか、という選択にあたるためです。 |
| 6 | 「物理データモデル」はなぜ“物理”と呼ばれる？               |   | 記録媒体の容量・索引・分割方式など、ハードウェアに依存した**物理的**な設計を扱うからです。 |
| 7 | 「概念スキーマ」と「論理データモデル」の違いは？             |   | 概念スキーマは**理論的枠組み**上の定義であり、論理データモデルは**設計工程**上の具体化段階を指します。 |

---

## 6. 要約

*   データベースの構造は、**「3層スキーマ（外部・概念・内部）」**という理論的枠組みと、**「データモデル（概念・論理・物理）」**という設計工程の2つの体系で整理されます。
*   「記録媒体への格納方法」を定義するのは**内部スキーマ**であり、これは設計工程における**物理データモデル**に相当します。
*   試験では、「外部＝利用者視点」「概念＝論理構造」「内部＝物理格納」という各層の役割と、両体系の用語の混同を狙った問題が出題されるため、正確な区別が重要です。