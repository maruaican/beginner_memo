## HTTPS通信の体系的理解とセキュリティ

* ※「SSLオフロード」や「SSL証明書」という言葉が実務でも使われているが、実際にはTLSが使われている。これは、SSLという言葉が定着してしまったからで、技術の進化と用語の慣習がズレている例で、IT業界ではよくあること。

### 1. HTTPSの必要性：なぜ通信を保護するのか？

インターネット上の通信は、標準的なプロトコルであるHTTP (Hypertext Transfer Protocol) によって行われます。しかし、HTTP通信は**暗号化**されておらず、通信内容が平文（そのまま読める形式）で送受信されるため、第三者による**盗聴**、改ざん、なりすましのリスクがあります。

例えば、ECサイトで入力したクレジットカード情報や、WebサービスへのログインID・パスワードがHTTPで送信された場合、悪意のある第三者に簡単に盗み見られてしまう可能性があります。これが、安全な通信を実現する**セキュリティ**技術の必要性の根幹です。

そこで登場したのが**HTTPS (Hypertext Transfer Protocol Secure)**です。 HTTPSは、SSL (Secure Sockets Layer) /TLS (Transport Layer Security) というプロトコルを用いて通信を**暗号化**することで、これらの脅威から**Webアプリケーション**と利用者を守ります。

HTTPSが提供する主な**セキュリティ**上の利点は以下の3つです。

*   **盗聴の防止**: 通信内容を**暗号化**することで、第三者が通信を傍受しても内容を解読できなくします。
*   **改ざんの防止**: 通信データが途中で書き換えられていないかを検知する仕組みにより、データの完全性を保証します。
*   **なりすましの防止**: 通信先の**サーバ**が本物であることを証明し、偽サイトへの接続を防ぎます。

### 2. HTTPS通信の体系的解説：暗号化の仕組み

HTTPSの**セキュリティ**は、「共通鍵暗号方式」と「公開鍵暗号方式」を組み合わせたハイブリッド方式によって実現されています。 ここでは、**クライアント**（Webブラウザ）が**Webサーバ**に接続する際の基本的な流れを解説します。

#### 2.1. 暗号化通信の開始まで（SSL/TLSハンドシェイク）

1.  **クライアント**から**サーバ**への接続要求
    *   **クライアント**は、**Webサーバ**に対してHTTPSでの接続をリクエストします。

2.  **サーバ**から**SSLサーバ証明書**と**公開鍵**の送付
    *   リクエストを受けた**Webサーバ**は、認証局（CA）によって発行された**SSLサーバ証明書**と、その中に含まれる**公開鍵**を**クライアント**に送付します。
    *   **用語の由来**:
        *   **SSL (Secure Sockets Layer)**: Netscape社が開発した、安全な通信路（Secure Layer）をソケット（Socket）上に確立するためのプロトコルが由来です。現在は後継の**TLS (Transport Layer Security)**が主流ですが、「SSL」という名称も広く使われています。
        *   **SSLサーバ証明書**: ウェブサイトの運営者の実在性を証明し、通信の暗号化に必要な**公開鍵**を含む電子証明書です。

3.  **クライアント**による**SSLサーバ証明書**の検証と**共通鍵**の生成・送信
    *   **クライアント**は、受け取った**SSLサーバ証明書**が信頼できる認証局から発行されたものか、有効期限が切れていないか、そして通信相手の**FQDN (Fully Qualified Domain Name)**が証明書に記載のものと一致するかなどを検証します。
    *   **用語の由来**:
        *   **FQDN (Fully Qualified Domain Name)**: ホスト名からトップレベルドメインまで、全ての要素を省略せずに指定したドメイン名のことです。 `www.example.com.` のように最後にルートを示すドットが付くのが正式な形式です。
    *   検証に成功すると、**クライアント**はデータの**暗号化**に用いる**共通鍵**を生成します。
    *   そして、サーバから受け取った**公開鍵**を使って、生成した**共通鍵**を**暗号化**し、**Webサーバ**に送信します。

4.  **サーバ**による**共通鍵**の**復号**
    *   **Webサーバ**は、自身だけが持つ「秘密鍵」を用いて、**暗号化**された**共通鍵**を**復号**（元のデータに戻すこと）します。 これで、**クライアント**と**Webサーバ**の両者が同じ**共通鍵**を安全に共有できたことになります。

#### 2.2. 共通鍵による暗号化通信

上記の手順で共有された**共通鍵**を用いて、**クライアント**と**Webサーバ**は実際のデータを**暗号化**・**復号**しながら通信を行います。

*   **公開鍵暗号方式**: 安全な**共通鍵**の受け渡しのために使用されます。処理が複雑で低速なため、鍵交換の初回のみに使われます。
    *   **公開鍵**: 誰にでも公開される鍵で、データの**暗号化**に使います。
    *   **秘密鍵**: **サーバ**が厳重に管理する鍵で、**公開鍵**で**暗号化**されたデータの**復号**に使います。
*   **共通鍵暗号方式**: 実際のデータ通信の**暗号化**に使用されます。処理が高速であるため、頻繁なデータのやり取りに適しています。

### 3. Webアプリケーションを取り巻くセキュリティ脅威とHTTPSの役割

HTTPSは通信経路上の**セキュリティ**を確保しますが、**Webアプリケーション**そのものに脆弱性がある場合、様々な攻撃を受ける可能性があります。

#### 3.1. HTTPSで直接的に防御できる脅威

*   **盗聴**: 通信が**暗号化**されているため、ネットワーク上でデータを傍受されても、内容を読み取られることを防ぎます。
*   **セッションハイジャック**: **セッション**IDが**Cookie**に含まれて通信される場合、HTTPSで通信路を**暗号化**することで、**セッション**IDの**盗聴**を防ぎ、第三者によるなりすまし（**セッションハイジャック**）のリスクを大幅に低減します。
    *   **用語の由来**:
        *   **セッション (Session)**: **クライアント**と**サーバ**間の一連の通信のこと。ログインからログアウトまでが一つの**セッション**となります。
        *   **Cookie**: **Webサーバ**が**クライアント**のブラウザに情報を保存させる仕組み。**セッション**IDなどを保持するために使われます。
        *   **セッションハイジャック (Session Hijacking)**: **セッション**IDを不正に取得し、正規のユーザーになりすましてサービスを不正利用する攻撃です。

#### 3.2. HTTPSだけでは防げない脅威と多層防御の重要性

以下の脅威は、**Webアプリケーションの脆弱性** を狙った攻撃であり、通信の**暗号化**では防ぐことができません。

*   **SQLインジェクション (SQL Injection)**: 不正なSQL文を注入（Inject）することで、データベースを不正に操作する攻撃。
*   **WEBサイトの改ざん**: **Webサーバ**やコンテンツ管理システムの脆弱性を突かれ、Webサイトの内容を不正に書き換えられること。
*   **クロスサイトスクリプティング (Cross-Site Scripting, XSS)**: 脆弱性のあるサイトに悪意のあるスクリプトを埋め込み、訪問者のブラウザ上で実行させる攻撃。**Cookie**に保存された**セッション**IDが盗まれるなどの被害が発生します。
*   **クロスサイトリクエストフォージェリ (Cross-Site Request Forgery, CSRF)**: ログイン中のユーザーを騙し、意図しないリクエスト（掲示板への書き込み、商品の購入など）を強制的に（Forgery）送信させる攻撃。

これらの脅威からシステム全体を守るためには、HTTPSによる通信路の保護に加え、ネットワーク機器による多層的な防御が必要です。

### 4. セキュアなWebシステムを実現するネットワーク構成

企業などのセキュアなWebシステムは、以下のようなコンポーネントを組み合わせて構築されるのが一般的です。

*   **FW (Firewall)**: ネットワークの境界に設置され、許可された通信（IPアドレスやポート番号に基づく）のみを通過させる「防火壁」の役割を果たします。
*   **DMZ (DeMilitarized Zone)**: 「非武装地帯」を意味し、外部ネットワーク（インターネット）と内部ネットワーク（社内LAN）の間に設けられる中間的なネットワーク領域です。 **Webサーバ**や**DNSサーバ**など、外部に公開する必要がある**サーバ**をここに配置することで、万が一これらの**サーバ**が攻撃を受けても、内部ネットワークへの侵入を防ぎます。
*   **ロードバランサ (Load Balancer)**: 複数の**Webサーバ**へのアクセス負荷（Load）を均等に分散（Balance）させる装置です。可用性や処理性能を向上させます。
*   **リバースプロキシサーバ (Reverse Proxy Server)**: **クライアント**からのリクエストを代理で受け取り、適切な**Webサーバ**に転送する**サーバ**です。 **ロードバランサ**と同様の負荷分散機能や、SSL/TLSの**暗号化**・**復号**処理を代行する「SSLオフロード（SSLターミネーション）※」機能などを提供します。
※暗号化・復号の処理は負荷がかかるため、Webサーバの代わりに、その手前で代行する仕組み（メリット：サーバ負荷の軽減、スケーラビリティ向上：高トラフィック時でも安定した応答が可能。）
*   **WAF (Web Application Firewall)**: **Webアプリケーション**に特化した**ファイアウォール**で、SQLインジェクションやクロスサイトスクリプティングといった、通常の**FW**では防げない攻撃を検知・防御します。
*   **DNSサーバ (Domain Name System Server)**: `www.example.com` のような**FQDN**とIPアドレスを対応付ける「名前解決」を行う**サーバ**です。

これらの機器は連携して動作し、外部からの脅威に対して多層的な防御壁を築き、**Webアプリケーション**の**セキュリティ**を確保しています。HTTPSは、この防御網を通過する通信そのものを保護する、根幹的な技術と言えます。