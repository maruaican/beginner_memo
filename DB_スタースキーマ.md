

# スタースキーマにおけるファクトテーブルとディメンションテーブルの解説

## 1. はじめに：問題の提示

データ分析のモデル設計で用いられる「スタースキーマ」について、以下の4つのテーブルを例に、どれが「ファクトテーブル」に該当するのかを解説します。このテーマは、ファクトテーブルとディメンションテーブルの違いが混同されやすく、情報処理技術者試験などでも頻出する重要なポイントです。

**【対象テーブル】**

*   **顧客**: (<u>顧客コード</u>，氏名，電話番号，住所)
*   **商品**: (<u>商品コード</u>，商品名称，単価)
*   **販売店**: (<u>販売店コード</u>，販売店名称，代表者氏名)
*   **注文**: (<u>販売店コード</u>，<u>顧客コード</u>，<u>商品コード</u>，注文年月日，数量)

**結論から言うと、この場合のファクトテーブルは「注文」テーブルです。** 以下でその理由と関連知識を体系的に整理します。

## 2. スタースキーマの基本構造と目的

### 2.1. モデルの構造

スタースキーマは、データウェアハウスなどで用いられるモデルの一つで、その名の通り「星（スター）」のような形をしています。

*   **中心**: 1つの**ファクトテーブル**
*   **周辺**: 複数の**ディメンションテーブル**

この構造をテキスト図で示すと以下のようになります。

```
          顧客テーブル (ディメンション) ─┐
                                      │
          商品テーブル (ディメンション) ─┼→ 注文テーブル (ファクト)
                                      │
        販売店テーブル (ディメンション) ─┘
```

### 2.2. モデル化の目的と利点

なぜ、わざわざファクトとディメンションに分離するのでしょうか。それは、単純なリレーショナルデータベースの設計では、データ集計や分析の処理が複雑になりがちだからです。

スタースキーマは、ファクト（事実）とディメンション（分析の切り口）を明確に分離することで、以下のような利点を生み出します。

*   **分析の高速化**: 「どの顧客が」「どの商品を」「どの販売店で」購入したか、といった多角的な集計・分析が高速かつ簡潔に実行できる。
*   **理解の容易さ**: 分析者にとって、データ構造が直感的で理解しやすくなる。

## 3. ファクトテーブルとディメンションテーブルの定義

### 3.1. ファクトテーブル (Fact Table)

*   **内容**: 「事実」を格納するテーブルです。ここでの事実とは、ビジネス上の**出来事、取引、測定値**などを指します。
*   **保持するデータ**: 主に以下の2種類で構成されます。
    1.  **数値データ（メジャー）**: 数量、売上金額、個数など、**集計の対象となる値**。
    2.  **外部キー**: 各ディメンションテーブルを参照するためのキー。
*   **由来**: `Fact` = 事実。つまり、「売上」という事実そのものを記録するテーブルです。

### 3.2. ディメンションテーブル (Dimension Table)

*   **内容**: ファクト（事実）を**説明するための属性**を持つテーブルです。
*   **保持するデータ**: ファクトを分析するための「切り口」や「観点」となる情報を保持します。例えば、「顧客」テーブルの氏名・住所や、「商品」テーブルの商品名・単価などがこれにあたります。
*   **由来**: `Dimension` = 次元・観点。「売上という事実を、顧客や商品などの**様々な次元（観点）から切り分けて分析する**」という意味合いを持ちます。

## 4. 両者を区別する明確な基準

多くの学習者が「複数のテーブルを参照しているものがファクトテーブルでは？」と考えますが、それだけでは不十分な場合があります。以下に、両者を明確に区別するための基準を比較表形式で示します。

| 観点 | ファクトテーブル | ディメンションテーブル |
| :--- | :--- | :--- |
| **内容の性質** | **「事実」**＝出来事・取引・測定値 | **「属性」**＝事実を説明する情報 |
| **保持するデータ** | **数値（集計対象）**<br>（例: 数量、金額、売上） | **文字情報や属性**<br>（例: 名前、住所、分類、単価） |
| **キーの役割** | 複数のディメンションの**外部キー**を持つ | 自分自身の**主キー**を持つ |
| **分析での役割** | **集計の対象**となる<br>（`SUM`, `AVG`, `COUNT`など） | **集計の切り口**となる<br>（`WHERE`句, `GROUP BY`句で使う） |
| **位置づけ** | スタースキーマの**「中心」** | スタースキーマの**「周辺」** |

**【判定の最重要ポイント】**
**「集計対象となる数値（数量や金額など）を持つかどうか」**で判断すると、最も間違いが少なくなります。

## 5. 今回の問題への適用

上記の基準を、提示された4つのテーブルに当てはめてみましょう。

*   **顧客、商品、販売店テーブル**
    *   **内容**: 氏名、住所、商品名など、**説明的な属性情報**を保持している。
    *   **役割**: 「どの顧客が」「どの商品を」といった分析の**切り口（ディメンション）**として機能する。
    *   **結論**: これらは**ディメンションテーブル**です。

*   **注文テーブル**
    *   **内容**: 「数量」という**集計対象の数値**と、「注文年月日」という**事実（イベント）**を記録している。
    *   **キー**: 顧客、商品、販売店という3つのディメンションを参照するための**外部キー**（顧客コード、商品コード、販売店コード）を保持している。
    *   **結論**: **ファクトテーブル**です。

## 6. よくある誤解と正しい知識

### 誤解①：「ファクトテーブルは、すべてのテーブルの主キーを集めたもの」
*   **正しい知識**: すべての主キーを集めるわけではありません。分析の軸（切り口）として必要な**ディメンションテーブルへの外部キー**と、**集計対象となる数値データ**で構成されます。

### 誤解②：「複数のテーブルを参照しているからファクトテーブルだ」
*   **正しい知識**: この考え方は正しい方向ですが、本質ではありません。なぜなら、業務データベースの設計によっては、ディメンションテーブルがさらに別のマスタテーブルを参照する（正規化されている）ケースもあるからです。
*   スタースキーマの基本は、**ディメンションを非正規化して1つのテーブルにまとめる**ことです。したがって、「複数のディメンションの外部キーを持つ」かつ「**集計対象の数値を持つ**」という2つの条件で判断することが、より明確な基準となります。

## 7. Q&Aによる理解度チェック

**Q1. スタースキーマで中心に置かれるのはどちらのテーブルですか？**
**A1.** **ファクトテーブル**です。星の中心に「事実」が置かれ、その周りに「ディメンション」が配置されます。

**Q2. ファクトテーブルに必ず含まれる要素は何ですか？**
**A2.** **集計対象の数値データ**（数量、金額など）と、分析の切り口となる**ディメンションテーブルへの外部キー**です。

**Q3. 顧客テーブルや商品テーブルは、なぜディメンションテーブルなのですか？**
**A3.** それらが「誰が」「何を」といった、分析の**切り口（観点）**となる説明的な属性情報を持っているためです。

**Q4. 「注文」テーブルがファクトテーブルである決定的な理由は何ですか？**
**A4.** 「数量」という**集計対象の数値**を持ち、かつ顧客・商品・販売店という他のディメンションへの**外部キー**を保持しているためです。

**Q5. データウェアハウスで `SUM(数量)` や `GROUP BY 顧客名` といった集計を行う際、ファクトテーブルはどの役割を持ちますか？**
**A5.** `SUM`や`COUNT`といった**集計の対象となる基礎データ**を提供する役割を持ちます。