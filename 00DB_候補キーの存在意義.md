***

# 関係データベースにおける候補キーの体系的解説

## 1. 候補キーの定義と役割

### 1.1. 候補キーとは
候補キー（Candidate Key）とは、関係データベースのテーブル（表）において、**行（レコード）を唯一に識別できる列（属性）または列の組**のことです。
その名の通り、「candidate = 候補」という語源から、**主キー（Primary Key）に選ばれる候補となるキー**を指します。

### 1.2. 主要な役割：行の唯一な識別
候補キーの最も本質的な役割は、**表の各行を一意に特定すること**です。関係データベースでは、行を識別するための基準が必須であり、候補キーを定義することで、データの重複を防ぎ、一意性（ユニークであること）を保証します。

## 2. 候補キーの重要な性質
### 2.1. 一意性 (Uniqueness)
候補キーとして指定された列（または列の組）の値は、テーブル内で重複してはなりません。これにより、すべての行がユニークであることが保証されます。

### 2.2. NULL値の許容
候補キーは、その値として**空値（NULL）を含むことが可能**です。
これは`主キーとの大きな違い`であり、候補キーが主キーとして選ばれた場合にのみ、NULLを許可しない「NOT NULL制約」が課せられます。言い換えると、**「候補キー」＋「NOT NULL制約」＝「主キー制約」**となります。

## 3. 候補キーと関連概念の比較
### 3.1. 候補キーと主キー (Primary Key)
*   **関係性**: 主キーは、複数存在しうる候補キーの中から1つだけ選ばれた、特別なキーです。つまり、「候補キーがあるから主キーが決められる」という順序関係にあります。
*   **個数**: 1つのテーブルに候補キーは複数存在できますが、**主キーは必ず1つ**しか設定できません。
*   **選定基準**: 複数の候補キーの中から、一般的に**項目の組み合わせが最小**で、値が変化しにくく（安定性）、業務内容をよく表す（理解しやすさ）ものが主キーとして選ばれます。
*   **NULL許容**: 候補キーはNULL値を許容しますが、**主キーはNULL値を許容しません**（NOT NULL制約）。

### 3.2. 候補キーと外部キー (Foreign Key)
*   **役割の違い**: 候補キーの役割は「自身のテーブル内での行の識別」です。一方、外部キーは**「異なるテーブルの列と関連付け」**を行い、テーブル間のリレーションシップを定義するために使用されます。

### 3.3. 候補キーとインデックス (Index)
*   **目的の違い**: 候補キーの目的はデータの一意性を保証することです。一方、インデックスは**「検索の高速化」**を目的として、属性と値と対応するデータの格納位置を記録する仕組みです。候補キーとインデックスは直接的な関係はありませんが、多くの場合、主キーや一意性を保証する必要のある候補キーにはパフォーマンス向上のためにインデックスが作成されます。

## 4. 候補キーの存在意義：なぜ主キーだけでは不十分なのか

### 4.1. 複数の「一意な識別子」の存在
実世界の`業務データでは、「行を一意に識別できる項目」が複数存在`することがよくあります。`主キーは1つしか選べないため、それ以外の「一意な識別子」を管理する概念`が必要となります。`それが候補キー`です。

### 4.2. 安定的な主キー選定の基準としての役割
主キーを決定するためには、まず「他にどのような識別方法があるか」をすべて洗い出す必要があります。この洗い出しの結果が候補キー群です。
`候補キーを整理・比較検討することで、どのキーが最も安定的で主キーとしてふさわしいかを判断`できます。このプロセスを省略すると、後から変更が発生しやすい不安定な識別子を主キーにしてしまうリスクがあります。

### 4.3. 具体例：社員表
ある「社員表」において、以下の2つの列がそれぞれ社員を一人に特定できるとします。
*   **社員番号**: 会社が付与する一意の番号。
*   **メールアドレス**: 社員ごとにユニークなメールアドレス。

この場合、「社員番号」と「メールアドレス」は**両方とも候補キー**です。この2つの候補キーの中から、より安定的で（メールアドレスは変更の可能性がある）、簡潔な「社員番号」を主キーとして選ぶのが一般的です。

## 5. 知識の整理：比較表とよくある誤解

### 5.1. 主要なキーとインデックスの比較表

| 項目 | 候補キー | 主キー | 外部キー | インデックス |
| :--- | :--- | :--- | :--- | :--- |
| **一意性** | **あり** | **あり** | なし（重複可） | なし（重複可） |
| **NULL許容** | **可能** | **不可** | 可能 | 可能 |
| **用途** | 主キーの候補 | 行の識別に確定利用 | 他テーブルとの関連付け | 検索の高速化 |
| **個数/表** | 複数ありうる | **1つのみ** | 複数設定可 | 複数設定可 |
| **選択基準** | 一意性を持つものすべて | 候補キーから1つ選択 | 他テーブルの主キー等を参照 | DBA等の判断 |

### 5.2. よくある誤解と正しい知識
*   **誤解1：候補キーはNULLを持てない。**
    *   **正しい理解**: 候補キーはNULLを持つことができます。主キーに選ばれた場合にのみ「NOT NULL制約」が課されます。

*   **誤解2：候補キーは主キーと同じものである。**
    *   **正しい理解**: 候補キーは複数存在しうる「主キーの候補群」です。主キーは、その候補キーの中から1つだけ選ばれたものです。

*   **誤解3：候補キーは検索を高速化するためのものである。**
    *   **正しい理解**: 検索の高速化はインデックスの役割です。候補キーの役割は、あくまでデータの一意性の保証です。

## 6. (参考) 資格試験での出題例

### 6.1. 問題 (平成22年秋期 問29)
関係データベースの候補キーとなる列又は列の組に関する記述として，適切なものはどれか。

*   ア. 値を空値(null)にすることはできない。
*   イ. 検索の高速化のために，属性と値と対応するデータの格納位置を記録する。
*   ウ. 異なる表の列と関連付けられている。
*   エ. 表の行を唯一に識別できる。

### 6.2. 各選択肢の解説

*   **ア. 値を空値(null)にすることはできない。**
    *   **不適切**。これは**主キー**の説明です。候補キーの段階ではNULL値が許容されます。

*   **イ. 検索の高速化のために，属性と値と対応するデータの格納位置を記録する。**
    *   **不適切**。これは**インデックス**の説明です。

*   **ウ. 異なる表の列と関連付けられている。**
    *   **不適切**。これは**外部キー**の説明です。

*   **エ. 表の行を唯一に識別できる。**
    *   **適切**。これが候補キーの最も本質的な定義であり、役割です。