`DISTINCT`の使用パターンは見た目のバリエーションが少なく、試験や実務でも以下の２つが典型的パターンです。
しかし、\*\*「使い方が単純に見えても、本質的に重要な概念」\*\*を含んでいます。以下に体系的に整理します。

※二つの項目を指定した場合、**両方の値が完全に一致**している場合のみ「重複」として除外される
---
## 【１】DISTINCT の基本的な定義（IPA準拠）
> **DISTINCT：重複する行を除いて、異なる値だけを抽出するためのキーワード**
* `SELECT DISTINCT 項目名 FROM 表名;`
  　→ 指定した項目において **重複行を除いた**結果を返す
* 複数項目を指定した場合、**項目の組み合わせが重複する行**が除かれる。
---

## 【２】主な使用パターン（分類）

### ２－１：特定項目の重複を除いて取得（単一項目）
```sql
SELECT DISTINCT 都道府県
FROM 顧客;
```
* 意味：顧客が属する**都道府県の一覧**を取得（重複除外）
* 想定される使用目的：一覧表示、選択肢作成など

---
### ２－２：複数項目の組合せでの重複排除
```sql
SELECT DISTINCT 都道府県, 市区町村
FROM 顧客;
```
* 意味：**都道府県＋市区町村の組合せ**で重複を除く
* **両方の値が完全に一致**している場合のみ「重複」として除外される
* 注意：片方だけ違っても「別の組合せ」として扱われる
---
### ２－３：集計関数と組み合わせ（COUNT）
```sql
SELECT COUNT(DISTINCT 顧客ID) AS 顧客数
FROM 注文;
```
* 意味：重複する顧客IDを１つとカウントし、**ユニークな顧客数**を算出
* 使用目的：延べ数（重複含む）ではなく、実人数などを集計
---

### ２－４：サブクエリと組み合わせ
```sql
SELECT *
FROM (
    SELECT DISTINCT 顧客ID
    FROM 注文
) AS 一意顧客
WHERE 顧客ID LIKE 'A%';
```
* 用途：DISTINCT結果に対してさらに絞り込みたい場合など
* サブクエリで **一意な顧客IDのリスト**を作成 → フィルタ処理

---
### ２－５：DISTINCT の代替案との比較（GROUP BY）
```sql
SELECT 都道府県
FROM 顧客
GROUP BY 都道府県;
```
* `SELECT DISTINCT 都道府県` と**同じ結果**
* 実行計画はDBMSによって異なるが、意味論的には等価
* **GROUP BY を使うときは通常、集計関数と一緒に使う**
---
## 【３】応用情報技術者試験で問われる観点

| 観点         | 内容                         |
| ---------- | -------------------------- |
| 意図         | 重複排除か、単純な一覧取得か             |
| 単一 or 複数項目 | 複数項目の組み合わせに注意              |
| 集計との組合せ    | COUNT(DISTINCT ～)の形式に注意    |
| 他の句との関係    | ORDER BY, GROUP BYとの違いを明確に |

---

## 【４】誤答・混乱しやすいポイント

| 誤解                                    | 正しい理解                     |
| ------------------------------------- | ------------------------- |
| `DISTINCT` は項目ごとに効く                   | **行単位での重複**を判定            |
| `COUNT(*)` と `COUNT(DISTINCT 項目)` は同じ | 前者は全件、後者は一意件数             |
| `DISTINCT` はすべての行に影響                  | `SELECT`句で指定された項目だけに適用される |
---
## 【まとめ】
`DISTINCT`はシンプルな構文ながら、**複数項目の扱いや集計との連携**などで誤用が多い構文です。

出題頻度は高くないものの、**SQLの理解度を測るポイント**として問われやすいため、以下の２点に注意して整理してください。

* **DISTINCTは行全体の重複を除く**（列ではない）
* **GROUP BYとの違い・類似性**を使い分ける
---


---

### 追加問題

以下に、架空のテーブルを想定した応用問題を7つ提示します。

#### 前提テーブル

**`注文` テーブル**

| 注文ID | 顧客ID | 商品ID | 注文日 |
| :--- | :--- | :--- | :--- |
| 101 | C001 | P01 | 2023-10-01 |
| 102 | C002 | P02 | 2023-10-01 |
| 103 | C001 | P03 | 2023-10-02 |
| 104 | C003 | P01 | 2023-10-03 |
| 105 | C002 | P01 | 2023-10-03 |
| 106 | C001 | P01 | 2023-10-04 |

**`顧客` テーブル**

| 顧客ID | 氏名 | 都道府県 |
| :--- | :--- | :--- |
| C001 | 田中 | 東京都 |
| C002 | 鈴木 | 大阪府 |
| C003 | 佐藤 | 東京都 |
| C004 | 高橋 | 神奈川県 |

---

**【問題1】複数項目の組み合わせ**
`注文`テーブルから、「どの顧客が、どの商品を注文したか」の組み合わせを、重複なく一覧表示してください。結果には顧客IDと商品IDの両方を含める必要があります。

---
**【問題1：解答と解説】**

**解答SQL:**
```sql
SELECT DISTINCT 顧客ID, 商品ID
FROM 注文;
```
**解説：**
`DISTINCT`は、指定された複数の項目（この場合は`顧客ID`と`商品ID`）の「組み合わせ」が重複する行を除外します。例えば、(C001, P01)という組み合わせは注文ID 101と106で2回登場しますが、結果としては1行にまとめられます。

---

**【問題2】集計関数との応用**
2023年10月3日に注文した顧客は、延べ人数ではなく実人数（ユニークな人数）で何人いるか算出してください。

---
**【問題2：解答と解説】**

**解答SQL:**
```sql
SELECT COUNT(DISTINCT 顧客ID) AS 実顧客数
FROM 注文
WHERE 注文日 = '2023-10-03';
```

**解説：**
まず`WHERE`句で対象日（2023-10-03）の注文に絞り込みます。該当するのは注文ID 104 (C003)と105 (C002)です。その後、`COUNT(DISTINCT 顧客ID)`で重複を除いた顧客IDの数を数えるため、結果は「2」人となります。

---

**【問題3】GROUP BYによる代替**
`顧客`テーブルに登録されている顧客の「都道府県」を一覧表示したいです。`DISTINCT`を使わずに、`GROUP BY`句だけを使用して同じ結果を得るSQL文を記述してください。

---
**【問題3：解答と解説】**

**解答SQL:**
```sql
SELECT 都道府県
FROM 顧客
GROUP BY 都道府県;
```

**解説：**
`GROUP BY`句は、指定した項目（都道府県）の値が同じ行をグループ化する機能です。集計関数と併用しない場合、各グループから代表する1行が返されるため、結果的に`SELECT DISTINCT 都道府県`と同じ「東京都、大阪府、神奈川県」という一覧が得られます。

---

**【問題4】DISTINCTの結果に対する絞り込み**
`注文`テーブルにおいて、これまでに商品を注文したことがある全顧客のIDを重複なくリストアップし、その中から顧客IDが 'C001' の顧客だけを抽出するSQL文を、サブクエリを用いて記述してください。

---
**【問題4：解答と解説】**

**解答SQL:**
```sql
SELECT 顧客ID
FROM (
    SELECT DISTINCT 顧客ID FROM 注文
) AS ユニーク顧客
WHERE 顧客ID = 'C001';
```

**解説：**
資料の「２－４：サブクエリと組み合わせ」で示されている典型的なパターンです。
まず、FROM句のサブクエリ `(SELECT DISTINCT 顧客ID FROM 注文)` で注文履歴のあるユニークな顧客リスト（C001, C002, C003）を作成します。
その結果に対して、`WHERE`句でさらに絞り込みを行っています。

---

**【問題5】JOINとDISTINCTの組み合わせ**
`注文`テーブルと`顧客`テーブルを結合し、「東京都の顧客」の中で、何らかの商品を注文したことのある人の氏名を重複なく表示してください。

---
**【問題5：解答と解説】**

**解答SQL:**
```sql
SELECT DISTINCT T2.氏名
FROM 注文 AS T1
JOIN 顧客 AS T2 ON T1.顧客ID = T2.顧客ID
WHERE T2.都道府県 = '東京都';
```

**解説：**
`JOIN`で2つのテーブルを結合し、`WHERE`句で東京都の顧客に絞り込みます。この時点で、顧客ID 'C001' の田中さんは複数回注文しているため、結合結果に複数行登場します。
そのため、最後に`SELECT DISTINCT T2.氏名`とすることで、氏名の重複を除き、意図した結果（田中さん、佐藤さん）を1行ずつ表示できます。

---

**【問題6】誤解しやすいポイントの確認**
`注文`テーブルについて、以下の2つのSQL文を実行した場合、それぞれの結果（行数）はどうなるか、理由とともに回答してください。
1. `SELECT COUNT(顧客ID) FROM 注文;`
2. `SELECT COUNT(DISTINCT 顧客ID) FROM 注文;`

---
**【問題6：解答と解説】**

1.  **結果：6**
    **理由：** `COUNT(顧客ID)`は、`顧客ID`列の**NULLでない行の総数**を数えます。このテーブルでは6行すべてに値があるため、延べ注文数である「6」が返されます。
2.  **結果：3**
    **理由：** `COUNT(DISTINCT 顧客ID)`は、`顧客ID`列に登場する値の種類（ユニークな値の数）を数えます。登場する顧客IDは 'C001', 'C002', 'C003' の3種類なので、「3」が返されます。

**解説：**
この問題は資料の「誤答・混乱しやすいポイント」で指摘されている`COUNT(*)`（または`COUNT(列名)`）と`COUNT(DISTINCT 列名)`の違いを明確に理解しているかを確認するものです。前者が延べ数、後者が実数（ユニーク数）を数える際の基本となります。

---

**【問題7】NULLの扱い**
ある`商品`テーブルに、任意項目として「推奨シーズン」列があるとします。この列には '春夏', '秋冬', または値が未設定（NULL）のデータが複数含まれています。「推奨シーズン」の全てのパターンを重複なく取得するSQLを記述した場合、結果にNULLは含まれるでしょうか。理由とともに回答してください。
（※この問題はSQLの一般的な挙動を問うもので、前提テーブルは使用しません）

---
**【問題7：解答と解説】**

**結果：** NULLは含まれる。

**理由：**
SQLの`DISTINCT`や`GROUP BY`は、`NULL`を他の値と同様に一つの「値」として扱います。
そのため、テーブル内に`NULL`が複数存在していても、それらを1つのグループとしてまとめ、結果セットには1つの`NULL`行として含めます。
（例：'春夏', '秋冬', NULL, NULL というデータがあれば、`SELECT DISTINCT`の結果は '春夏', '秋冬', NULL の3行になります。）
