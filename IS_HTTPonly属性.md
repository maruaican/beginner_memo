# Cookieへのアクセス方法とHTTPOnly属性

Cookieへのアクセスは、主に「ブラウザによる自動送受信（HTTP通信）」と「クライアントスクリプトによる参照・操作」の2つの経路で行われます。
`HttpOnly`属性は、後者のクライアントスクリプトからのアクセスを禁止し、CookieへのアクセスをHTTP/HTTPS通信に限定するセキュリティ機能です。

## 1. ブラウザによる自動送受信（HTTP通信レベル）

ブラウザは、Webサイトにアクセスする際に、設定されたCookieをHTTPリクエストヘッダーに自動的に含めてサーバに送信します。これは、ユーザーやJavaScriptなどのスクリプトが直接操作しなくても、ブラウザが通信のたびに行う基本的な動作です。

**✅ 特徴:**
*   **`HttpOnly`属性が付与されていても、この自動送信は行われます。**
*   主にサーバとのやり取り（セッション管理など）で使用されます。
*   HTTPS通信時には暗号化されて送信されます。

**例:**
サーバからのレスポンスヘッダー:
```http
Set-Cookie: SESSIONID=abcd1234; Secure; HttpOnly
```
※このクッキーを覚えろという指示

ブラウザからサーバへのリクエストヘッダー:
```http
Cookie: SESSIONID=abcd1234
```
※サーバーにrequestするときに、クッキーを添付する

## 2. クライアントスクリプトによる参照・操作（JavaScriptなど）

Webブラウザ内で実行されるJavaScript（クライアントスクリプト）は、`document.cookie` API を使用してCookieを読み取ったり、新しいCookieを作成したりできます。

**✅ 特徴:**
*   **`HttpOnly`属性が付与されているCookieは、この方法では参照・操作できません。**
*   ページの動的な挙動（UIの変更、状態保存など）に利用されますが、XSS（クロスサイトスクリプティング）攻撃によりセッションIDなどの機密情報が盗まれるリスクがあります。
*   `HttpOnly`属性は、このクライアントスクリプトからのCookieへのアクセスを禁止することで、XSS攻撃によるCookie窃取を防ぐための重要なセキュリティ対策です。

**例:**
```javascript
// HttpOnly属性が付与されたCookieは取得できない
console.log(document.cookie); 

// 新しいCookieを作成（HttpOnly属性がない場合）
document.cookie = "theme=dark"; 
```

## 図による整理

```
+-------------------------------------------------+
| ブラウザによる自動送受信 (HTTP/HTTPS通信)       |
|   サーバ <── Cookie ヘッダ ──> ブラウザ         |
|     ※ HttpOnly属性が付いていても送信される      |
+-------------------------------------------------+
          ▲
          |
+-------------------------------------------------+
| クライアントスクリプトによる参照・操作 (JavaScript) |
|   Webページ内JS ──> document.cookie             |
|     ※ HttpOnly属性が付いていると参照・操作不可   |
+-------------------------------------------------+
```

## 試験対策ポイント

*   **`HttpOnly`属性の主な目的は、「クライアントサイドスクリプトからのCookie参照・操作の禁止」です。**
*   これにより、XSS攻撃によるセッションIDなどのCookie情報の窃取を防ぎます。
*   `HttpOnly`属性は、ブラウザが自動的にCookieをサーバに送信することを妨げるものではありません。
*   `Secure`属性は、CookieをHTTPS通信時のみに限定するものであり、`HttpOnly`とは目的が異なります。両方を併用することも可能です。

---
*（補足）由来と意味:*
*HTTPOnly属性の名称は、「HTTP通信（およびHTTPS通信）に限定して利用可能」という意味合いから来ています。これは、CookieがHTTP/HTTPSプロトコルを介したサーバとの通信でのみ利用可能であり、それ以外の経路、特にJavaScriptなどのクライアントサイドスクリプトからのアクセスは禁止される、という制限を示しています。*