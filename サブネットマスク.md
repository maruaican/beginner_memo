# サブネットマスクとIPアドレスの基本概念：体系的解説

このドキュメントでは、IPアドレスの構成、サブネットマスクの役割、そしてネットワークアドレスとブロードキャストアドレスの算出方法について体系的に解説します。特に、ビットごとの論理演算（AND、OR、ビット反転）がこれらのIPアドレス算出にどのように利用されるかを明確にします。

## 1. オクテットの理解

コンピュータネットワークにおいて、**オクテット (octet)** は厳密に **8ビットのデータ単位** を指します。

*   **語源**: ラテン語の「octo」（8を意味する）に由来します。
*   **IPアドレスとの関係**:
    *   IPv4アドレス（例: `192.168.1.1`）は全部で32ビットで構成されており、これを8ビットずつに区切った4つの部分で表現します。この1つ1つの8ビットの塊がオクテットです。
    *   各オクテットは10進数で0から255までの値を表現できます。
*   **「バイト」との違い**:
    *   通常、「バイト」も8ビットを指すことが多いですが、コンピューティングの歴史において1バイトが8ビット以外を指すケースも存在しました。
    *   しかし、「オクテット」は常に8ビットを意味するため、ネットワーク分野ではデータのサイズやプロトコル定義において曖昧さを避けるためにこの用語が好んで使用されます。

## 2. IPアドレスの構成とサブネットマスクの役割

IPアドレスは論理的な住所であり、大きく「ネットワーク部」と「ホスト部」の二つの部分に分かれます。

*   **ネットワーク部**: ネットワークそのものを識別するための部分です。同じネットワークに属するすべてのデバイスは、共通のネットワーク部を持ちます。
*   **ホスト部**: 特定のネットワーク内で、個々のデバイス（ホスト）を識別するための部分です。

### サブネットマスクの役割

**サブネットマスク**は、IPアドレスのどのビット列がネットワーク部であり、どのビット列がホスト部であるかを定義するための32ビットの数値です。

*   **表記**: `255.255.255.0`のようなドット付き10進表記や、`/24`のようなCIDR (Classless Inter-Domain Routing) 表記で表されます。
*   **構造**: サブネットマスクは、ネットワーク部を示すビットがすべて`1`、ホスト部を示すビットがすべて`0`で構成されます。例えば、`255.255.255.0`は2進数で`11111111.11111111.11111111.00000000`となり、左から24ビットがネットワーク部、右から8ビットがホスト部を示します。
*   **利点**:
    *   **IPアドレスの効率的な利用**: 大規模なネットワークを中小規模のサブネットワーク（サブネット）に分割することで、無駄になるIPアドレスの数を減らします。
    *   **ネットワーク管理の容易化**: ブロードキャストドメイン（ブロードキャストパケットが届く範囲）を小さくすることで、ネットワークの負荷を軽減し、管理やトラブルシューティングを容易にします。
    *   **セキュリティの向上**: ネットワークの範囲を限定することで、セキュリティ上のリスクを低減できます。

## 3. ネットワークアドレスの算出: 論理積（AND）演算

特定のホストのIPアドレスがどのネットワークに属しているかを識別するために、**ネットワークアドレス**が使用されます。ネットワークアドレスは、そのネットワークを代表するアドレスであり、ホスト部がすべて`0`であるという特徴を持ちます。

ネットワークアドレスは、IPアドレスとサブネットマスクをビット単位で**論理積（AND）演算**することで求められます。

### 論理積（AND）演算の原理

論理積（AND）は、2つの入力ビットが両方とも`1`の場合にのみ出力が`1`となり、それ以外の場合は`0`となる演算です。

*   `1 AND 1` → `1`
*   `1 AND 0` → `0`
*   `0 AND 1` → `0`
*   `0 AND 0` → `0`

### 計算ロジック

1.  **IPアドレスのネットワーク部を保持**: サブネットマスクのネットワーク部（ビットが`1`）とIPアドレスの対応するビットをAND演算します。`X AND 1` は必ず `X` となるため、IPアドレスのネットワーク部のビットがそのまま残ります。
2.  **IPアドレスのホスト部を強制的に`0`にする**: サブネットマスクのホスト部（ビットが`0`）とIPアドレスの対応するビットをAND演算します。`X AND 0` は必ず `0` となるため、IPアドレスのホスト部のビットはすべて`0`になります。

この演算により、IPアドレスのネットワーク部はそのままで、ホスト部がすべて`0`になった新しいアドレスが生成され、これがネットワークアドレスとなります。

### 例

IPアドレス `172.16.255.164` とサブネットマスク `255.255.255.192` の場合を考えます。

*   **IPアドレスの最後のオクテット**: `164` -> `10100100` (2進数)
*   **サブネットマスクの最後のオクテット**: `192` -> `11000000` (2進数)

論理積（AND）演算:
```
  10100100 (164 - IPアドレス)
& 11000000 (192 - サブネットマスク)
----------
= 10000000 (128 - ネットワークアドレスの最後のオクテット)
```
したがって、ネットワークアドレスは `172.16.255.128` となります。

## 4. ブロードキャストアドレスの算出: ビット反転と論理和（OR）演算

**ブロードキャストアドレス**は、特定のネットワーク内のすべてのホストに対して、同時にデータを送信するための特別なアドレスです。このアドレスは、ホスト部がすべて`1`であるという特徴を持ちます。

ブロードキャストアドレスを算出するには、IPアドレスと、サブネットマスクをビット反転させた **ワイルドカードマスク** (`ワイルドカードマスク` はサブネットマスクのネットワーク部のビットが0、ホスト部のビットが1で構成される) をビット単位で**論理和（OR）演算**します。
※サブネットマスクをビット反転させたものは、一般的に**ワイルドカードマスク**と呼ばれます。

### 論理和（OR）演算の原理

論理和（OR）は、2つの入力ビットのどちらか一方または両方が`1`の場合に出力が`1`となり、両方とも`0`の場合にのみ`0`となる演算です。

*   `1 OR 0` → `1`
*   `0 OR 0` → `0`
*   `1 OR 1` → `1`
*   `0 OR 1` → `1`

### 計算ロジック

1.  **ワイルドカードマスクの作成**: サブネットマスクのすべてのビットを反転させます（`1`を`0`に、`0`を`1`に）。これにより、ワイルドカードマスクのネットワーク部は`0`、ホスト部は`1`となります。
2.  **IPアドレスのネットワーク部を保持**: ワイルドカードマスクのネットワーク部（ビットが`0`）とIPアドレスの対応するビットをOR演算します。`X OR 0` は必ず `X` となるため、IPアドレスのネットワーク部のビットがそのまま残ります。
3.  **IPアドレスのホスト部を強制的に`1`にする**: ワイルドカードマスクのホスト部（ビットが`1`）とIPアドレスの対応するビットをOR演算します。`X OR 1` は必ず `1` となるため、IPアドレスのホスト部のビットはすべて`1`になります。

この演算により、IPアドレスのネットワーク部はそのままで、ホスト部がすべて`1`になった新しいアドレスが生成され、これがブロードキャストアドレスとなります。

### 例

IPアドレス `172.16.255.164` とサブネットマスク `255.255.255.192` を使用します。

*   **サブネットマスクの最後のオクテット**: `192` -> `11000000` (2進数)
*   **ワイルドカードマスクの最後のオクテット**: サブネットマスクをビット反転すると、`00111111` (63) となります。

IPアドレスの最後のオクテット `164` (`10100100`) とワイルドカードマスクの最後のオクテット `63` (`00111111`) を論理和（OR）演算:
```
  10100100 (164 - IPアドレス)
| 00111111 (63 - ワイルドカードマスク)
----------
= 10111111 (191 - ブロードキャストアドレスの最後のオクテット)
```
したがって、ブロードキャストアドレスは `172.16.255.191` となります。

## 5. 利用可能なホストアドレスの範囲

ネットワークアドレスとブロードキャストアドレスは、特別な用途のために予約されており、個々のホストには割り当てられません。ホストに実際に割り当て可能なIPアドレスの範囲は、ネットワークアドレスの次のアドレスから、ブロードキャストアドレスの直前のアドレスまでとなります。

### 例

ネットワークアドレスが `172.16.255.128`、ブロードキャストアドレスが `172.16.255.191` の場合：

*   **利用可能なホストアドレス範囲**: `172.16.255.129` ～ `172.16.255.190`

この範囲内のIPアドレスを持つホストは、すべて同じサブネットワークに属していることになります。