# ARPプロトコル完全解説

## 1. 基本概念

### 1.1 ARPの役割と動作フロー

ARPの動作フロー:
1. [DHCPサーバ]
   │
   └─ IPv4アドレス配布 → [DHCPクライアント]
                           │
                           └─ ARPによる重複確認
                                   ├─ 応答なし → 利用開始
                                   └─ 応答あり → 別アドレス要求

### 1.2 プロトコル定義

**ARP** (Address Resolution Protocol)は、IPv4ネットワークにおいてIPアドレスからMACアドレスを解決するためのプロトコルである。

- 主な目的は、IPアドレスから対応するMACアドレスを解決することである
- 語源は以下の通りである:
  - Address: IPアドレスを指す
  - Resolution: 解決を意味する
  - Protocol: 通信規約を表す
- 特徴として、ローカルネットワーク(L2セグメント)内でのみ有効である

## 2. 技術詳細

### 2.1 ARPの必要性と実装理由

- **IP重複問題の解決**:
  - DHCP割当IPが既に使用中の場合の重複検出
  - 重複時の影響: 通信不安定・ネットワーク障害
  - クライアント側チェックでサーバ管理漏れを補完

- **試験/実務での重要ポイント**:
  - DHCPのIP重複確認にはARPを使用（ICMP/DNSは不適切）
  - ICMP(ping)は信頼性が低い（応答禁止設定の可能性）
  - ブロードキャストベースのため同一セグメント内限定
  - RARP(MAC→IP)はDHCPに置き換えられ廃止傾向

### 2.2 関連プロトコル比較

| プロトコル | 方向性       | 重複確認 | 現代の利用状況       | 主な用途例                  |
|------------|--------------|----------|---------------------|----------------------------|
| ARP        | IP → MAC     | ○        | 広く使用            | ローカルネットワークのアドレス解決 |
| DHCPキャッシュ | MAC ⇔ IP | ○        | 主流                | IPアドレスの自動割当と管理     |
| ICMP       | 疎通確認     | △        | 使用されるが信頼性低 | ping, traceroute           |
| RARP       | MAC → IP     | ×        | ほぼ廃止            | 旧式システムの自動設定        |
| DNS        | 名前 ⇔ IP    | ×        | 広く使用            | ドメイン名解決              |

## 3. 実践応用とトラブルシューティング

### 3.1 正常動作例

- DHCPクライアントがARPリクエストをブロードキャスト
- 応答がない場合のみ割当IPを使用開始

### 3.2 よくある問題と解決策

- **問題**: IP重複による通信障害
  - **原因**: ARPチェックをスキップした手動設定
  - **解決**: `arp -a`コマンドで重複確認

- **問題**: サブネットを跨いだ通信不能
  - **原因**: ARPはL2セグメント内限定
  - **解決**: ルータを適切に設定

### 3.3 ベストプラクティス

- IP重複チェックには常にARPを使用
- ネットワーク設計時はブロードキャストドメインを考慮
- トラブル時は最初にARPテーブルを確認 (`arp -a`コマンド)

## 4. 試験対策ポイント

### 4.1 頻出問題例

**問題**:
DHCPクライアントが割当IPv4アドレスの重複を確認するプロトコルは？
- A. ARP
- B. DNS
- C. ICMP
- D. RARP

**正解**: A. ARP

**解説**:
- ARPはIPアドレスからMACアドレスを解決するプロトコルである
- DHCPクライアントは割当IPに対してARPリクエストを送信
- 応答があればIPアドレスが使用中と判断
- 応答がなければ安全に使用可能と判断

## 5. まとめ

- ARPはIP→MAC解決のための重要なプロトコル
- DHCPのIP重複確認に必須
- 現代ではDHCPキャッシュがMAC→IP解決を代替している。
- RARPは歴史的プロトコルで現在はほぼしようされていない。

ーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
# ARP及びMAC・IPアドレス対応の仕組み

## １ プロトコルの役割整理

### １－１ ARPの動作範囲
ARPプロトコル自体は**IPアドレス → MACアドレス**の一方向解決のみを担当します。

```
ARP要求：「IPアドレス 192.168.0.10 のMACアドレスを教えてください」
ARP応答：「192.168.0.10 のMACアドレスは 00:11:22:33:44:55 です」
```

### １－２ MAC→IP解決の実現方法
MACアドレスからIPアドレスを特定する場合、以下の手段が用いられます：

（１）**ARPテーブルの参照**
- 過去の通信記録として保存されたMAC⇔IP対応情報を確認
- ARPプロトコルによる新たな問い合わせではなく、キャッシュデータの参照

（２）**DHCPサーバーのリース情報**
- DHCP割り当て時の記録から対応関係を確認
- IPアドレス配布履歴としてMAC→IP対応が記録される

（３）**RARP（Reverse ARP）**
- 現在は廃止されたプロトコル
- BOOTP及びDHCPに機能が統合されている

## ２ 動作の図式化

```
【ARP要求の流れ】
クライアント ─────ARP要求(IP→MAC)─────→ 対象ホスト
     ↑                                    │
     └────────ARP応答(MAC情報)────────────┘

【キャッシュ参照の流れ】
管理者/アプリケーション ──→ ARPテーブル/DHCPキャッシュ
                         （MAC→IP対応確認）
```

### ２－１ ARPテーブルの構造例

```
MACアドレス           IPアドレス      更新時刻
00:11:22:33:44:55    192.168.0.10    2025/08/15 10:30:25
AA:BB:CC:DD:EE:FF    192.168.0.20    2025/08/15 10:28:42
```

## ３ 重要な区別点

### ３－１ プロトコル機能とキャッシュ参照の違い
- **ARPプロトコル**：リアルタイムでIP→MAC解決を実行
- **ARPテーブル参照**：過去の通信結果として記録された情報を確認
- 「MACからIPが分かる」という表現は、通常はキャッシュ参照を指している

### ３－２ 応用情報技術者試験での注意点
試験では以下の理解が求められます：
- ARPの本来機能はIP→MAC解決のみ
- MAC→IP確認は別の仕組み（キャッシュ、DHCP等）による
- RARPは既に廃止されたプロトコルである
- 現在のMAC→IP解決は主にDHCPリース情報及びARPテーブル参照で実現
