了解です。では、OSI参照モデルの階層ごとに、通信単位とアドレス情報に加え、代表的なセキュリティ技術を整理して、テキスト図で体系的にまとめます。加えて補足として役割や処理の範囲も明示します。

---

## １　全体像（テキスト図）

```
アプリケーション層（データ単位：データ）  
  └─ プロトコル例：HTTP, HTTPS, SMTP, DNS  
  └─ セキュリティ技術：
       TLS/SSL（通信暗号化・認証）
       S/MIME, PGP（メール暗号化）
       アプリケーション層WAF（SQLインジェクション等対策）

トランスポート層（データ単位：セグメント）  
  └─ アドレス情報：ポート番号  
  └─ セキュリティ技術：
       TLS/SSL（HTTPSでTCP上暗号化）
       TCPセグメントフィルタリング（状態監視型ファイアウォール）

ネットワーク層（データ単位：パケット）  
  └─ アドレス情報：IPアドレス  
  └─ セキュリティ技術：
       IPsec（トンネリング・暗号化・認証）
       ファイアウォール（パケットフィルタリング）
       IDS/IPS（不正パケット検知・防御）

データリンク層（データ単位：フレーム）  
  └─ アドレス情報：MACアドレス  
  └─ セキュリティ技術：
       802.1X認証（ネットワークアクセス制御）
       VLAN（ネットワーク分離）
       スイッチACL（MACアドレス制御）
```

---

## １－１　定義と用語の由来

* **TLS/SSL**：Transport Layer Security / Secure Sockets Layer。アプリケーション層のデータを暗号化して、盗聴・改ざん防止。TLSはSSLの後継。
* **ファイアウォール**：ネットワーク境界で通信を制御。パケットフィルタリングやステートフル検査により不正通信防止。
* **WAF（Web Application Firewall）**：アプリケーション層の攻撃（SQLインジェクション、XSSなど）を防御。
* **IPsec**：IP Security。ネットワーク層で暗号化や認証を行い、VPNでよく使用される。
* **802.1X**：LAN接続端末認証規格。スイッチや無線APでアクセス制御。

---

## １－２　技術の必要性

* 通信は複数層で攻撃対象になる。
* **データの盗聴・改ざん防止**：TLS、IPsec、S/MIME。
* **不正アクセスの防止**：ファイアウォール、WAF、802.1X。
* **脅威の監視**：IDS/IPS。

---

## １－３　試験の着眼点

* OSI層と対応するセキュリティ技術の整理が頻出。
* TLSはアプリ層でもTCP層で動作している点に注意。
* ファイアウォールは単純なパケットフィルタリングだけでなく、ステートフル検査もある。

---

## １－４　体系マップ（分類・関係・比較表）

| OSI層      | 単位    | アドレス    | セキュリティ技術                  | 主な防御対象        |
| --------- | ----- | ------- | ------------------------- | ------------- |
| アプリケーション層 | データ   | プロトコル依存 | TLS/SSL, WAF, S/MIME, PGP | データ内容・アプリ攻撃   |
| トランスポート層  | セグメント | ポート番号   | TLS/SSL, TCPフィルタリング       | 通信路・サービス攻撃    |
| ネットワーク層   | パケット  | IPアドレス  | IPsec, ファイアウォール, IDS/IPS  | 経路・不正パケット     |
| データリンク層   | フレーム  | MACアドレス | 802.1X, VLAN, スイッチACL     | LANアクセス・MAC偽装 |

---

## １－５　代表例（正答例・誤答例）

* **正答例**：HTTPS通信はTCP層上でTLS暗号化され、WAFでSQLインジェクションを防御。
* **誤答例**：TLSはMACアドレス単位で暗号化される → 誤り。TLSはアプリ層データを暗号化する。
* **正答例**：ファイアウォールはパケット単位で通信制御。
* **誤答例**：WAFはIPアドレスでパケットをフィルタリングする → 誤り。WAFはHTTPデータ内容を検査する。

---

## １－６　よくある誤解と対処

* TLS = MACアドレス暗号化 → 誤り。アプリ層データを暗号化。
* ファイアウォール = WAF → 誤り。階層が異なる。
* SSLとTLSは同じ → 誤解。TLSはSSLの後継で安全性向上。

---

## １－７　一問一答

**問題1**：HTTPS通信で暗号化されるのはどの層のデータか。
**回答**：アプリケーション層のデータ。
**解説**：TLSはアプリ層データをTCP上で暗号化。TCPヘッダは暗号化されない。

**問題2**：IPsecはどのOSI層で動作するか。
**回答**：ネットワーク層。
**解説**：IPパケット全体を暗号化・認証し、VPNでよく使用される。

**問題3**：WAFで防御可能な攻撃はどれか。
**回答**：SQLインジェクション、XSSなどアプリケーション層攻撃。
**解説**：WAFはHTTP/HTTPSの内容を検査し、特定パターンを遮断。

**問題4**：802.1X認証の対象は何か。
**回答**：LANに接続する端末。
**解説**：スイッチや無線APが端末の認証を行い、未認証端末のアクセスを防止。

---

了解です。順番に整理します。まず、OSI層の通信単位と暗号化の影響、次に「ステートフル検査」の説明です。

---

## １　セグメント・パケット・データの違い

| 用語    | OSI層      | 内容・単位                           | 備考                             |
| ----- | --------- | ------------------------------- | ------------------------------ |
| データ   | アプリケーション層 | ユーザーが送受信する情報（例：HTTPメッセージ、メール本文） | プロトコル依存、暗号化可能（TLSなど）           |
| セグメント | トランスポート層  | TCP/UDPヘッダ＋データ                  | ポート番号情報を持つ。通信の信頼性（TCP）や順序制御を管理 |
| パケット  | ネットワーク層   | IPヘッダ＋セグメント                     | IPアドレス情報を持つ。ルータを経由して送信される      |
| フレーム  | データリンク層   | MACアドレス＋パケット                    | LAN内の物理転送単位                    |

**ポイント**：

* データ → セグメント → パケット → フレームの順でカプセル化される。
* 暗号化は「データ部分のみ」や「パケット全体」を対象にできるが、行き先情報は通常暗号化されない（IPヘッダは暗号化対象外）。IPsecにはトンネルモードとトランスポートモードがあり、トンネルモードではペイロードを暗号化しても外側ヘッダは残るため、ルーティング可能。

---

## ２　IPsec暗号化時の経路

* **トランスポートモード**：ペイロード（セグメント＋データ）を暗号化、IPヘッダはそのまま → ルータで経路判定可能
* **トンネルモード**：元のIPパケット全体を暗号化し、新しいIPヘッダで包む → 外側ヘッダで行き先を判定可能

→ つまり「行き先が分からなくなる心配」はない。

---

## ３　ステートフル検査（Stateful Inspection）

* ファイアウォールの動作方式の1つ。

* 特徴：

  1. **接続状態を保持**：TCPの3ウェイハンドシェイクやUDPの通信状態を記録
  2. **ルール適用**：許可された接続の応答パケットのみ通過
  3. **メリット**：単純なパケットフィルタリングより安全、セッション単位で通信制御

* 例：

  ```
  送信側: TCP SYN → ファイアウォール通過
  受信側: TCP SYN-ACK → 記録済み接続として通過
  ```

* 単純なパケットフィルタリングは「SYNだけ」や「ACKだけ」を個別に判断するため、ステート情報を考慮できない。

---

💡 **まとめ**

* データ → セグメント → パケット → フレームの順で階層化される
* IPsec暗号化でもルーティングに必要なヘッダは暗号化されない
* ステートフル検査は通信状態を記憶してセッション単位でパケットを通過させる


ステートフル検査で「セッション状態」を保持しているのは **ファイアウォール（中間機器）だけ** です。

---

## 詳細

* **ファイアウォール側での記録**

  * TCPなら3ウェイハンドシェイク（SYN, SYN-ACK, ACK）の状態
  * UDPなら「発信元IP/ポート・宛先IP/ポート」の通信を一時的にテーブルに記録
  * 記録期間はセッションが維持されている間のみ（タイムアウト設定あり）

* **サーバーやエンドポイント**

  * 通常は自分の通信処理のためのソケット状態を持つが、ファイアウォール用にセッション状態を保持することはない
  * ファイアウォールが通過を許可するかの判断は、あくまで中間の記録に基づく

---

💡 **ポイント**

* ステートフル検査 = 「中間のネットワーク機器が通信状態を記録してパケットを通す／ブロックする」仕組み
* サーバーやクライアントは「自分の処理のためのセッション情報」は持つが、ネットワーク検査用のセッション情報は持たない

了解です。それぞれ順番に整理して、階層や役割、違いも含めて解説します。

---

## １　VLAN（Virtual LAN）

* **OSI層**：データリンク層
* **役割**：1つの物理ネットワークを論理的に分割して、ネットワークをグループ化
* **効果**：

  * 異なるVLAN間はデフォルトでは通信できない → セキュリティ向上
  * LAN内のブロードキャストを隔離 → ネットワーク負荷軽減
* **補足**：VLAN間通信はルータやL3スイッチを経由する必要がある

---

## ２　スイッチACL（Access Control List）

* **OSI層**：データリンク層～ネットワーク層（スイッチの種類による）
* **役割**：特定MACアドレスやIPアドレス単位で通信を許可／拒否
* **例**：

  * 「MACアドレスAの端末だけVLANに接続可能」
  * 「IPアドレスBからのパケットは遮断」
* **効果**：未認証端末や不正端末からのアクセス制御

---

## ３　IDS/IPS（Intrusion Detection/Prevention System）

| 用語  | 役割   | 特徴                        |
| --- | ---- | ------------------------- |
| IDS | 侵入検知 | ネットワーク上の不正通信を検知しログ出力や通知のみ |
| IPS | 侵入防御 | IDSに加え、不正通信を自動で遮断         |

* **OSI層**：ネットワーク層～アプリケーション層
* **効果**：マルウェア通信、不正アクセス、DoS攻撃などを検知・遮断
* **補足**：ステートフル検査と組み合わせることも多い

---

## ４　TCPフィルタリング

* **OSI層**：トランスポート層
* **役割**：TCPのポート番号やフラグ（SYN, ACK, FINなど）を元に通信を許可／拒否
* **例**：

  * 「ポート80のTCP通信は許可」
  * 「SYNフラグのみの不正接続は遮断」
* **効果**：サービス単位でアクセス制御、DoS攻撃の軽減
* **補足**：単純なTCPポートフィルタリングはステートレス。ステートフル検査と組み合わせると安全性が上がる

---

## ５　まとめ（階層・用途）

| 技術         | OSI層            | 用途           | 防御対象                    |
| ---------- | --------------- | ------------ | ----------------------- |
| VLAN       | データリンク層         | ネットワーク分離     | LAN内部の不正アクセス、ブロードキャスト抑制 |
| スイッチACL    | データリンク層～ネットワーク層 | 接続端末・IP制御    | 未認証端末、不正端末              |
| IDS/IPS    | ネットワーク層～アプリ層    | 不正通信検知・遮断    | マルウェア通信、DoS、侵入          |
| TCPフィルタリング | トランスポート層        | TCPポート・フラグ制御 | サービス単位の不正通信             |

---

💡 **ポイント**

* VLANとスイッチACLは「LAN内部のアクセス制御」に特化
* TCPフィルタリングは「サービス単位の通信制御」に特化
* IDS/IPSは「異常通信の検知・遮断」に特化

---





