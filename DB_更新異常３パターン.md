**

### データベースの更新異常

---

### 1. 更新異常とは何か

#### 1.1. 更新異常の全体像

更新異常とは、正規化されていないテーブル（リレーション）において、データの挿入、更新、削除を行った際に生じる不都合な事象の総称です。この「異常（Anomaly）」という言葉は、エラーで操作が失敗するという意味ではなく、「データの矛盾や意図しない情報喪失が発生する」という不健全な状態を指します。

更新異常は、大きく分けて以下の3種類に分類されます。

*   **挿入異常 (Insertion Anomaly)**
*   **更新異常 (Update Anomaly, 狭義)**
*   **削除異常 (Deletion Anomaly)**

#### 1.2. 発生の根本原因：データの冗長性

これらの異常が発生する根本的な原因は、テーブル内に**データの冗長性**が存在することにあります。具体的には、以下のような状態のテーブルで発生します。

*   **データが重複して登録されている**
*   **一つのテーブルに、概念的に独立した複数の情報が混在している**

例えば、以下のような`社員表`を考えてみましょう。この表は、社員の情報と部署の情報を一つのテーブルで管理しようとしています。

**【問題のあるテーブル例：非正規形】**
```
社員表
| 社員ID | 社員名 | 部署ID | 部署名 |
|:---|:---|:---|:---|
| 1 | 佐藤 | 10 | 営業部 |
| 2 | 鈴木 | 10 | 営業部 |
| 3 | 田中 | 20 | 総務部 |
| 4 | 高橋 | 10 | 営業部 |
```
このテーブルでは、「営業部」という部署名が3回も繰り返し登場しています。このようなデータの重複が、さまざまな不整合を引き起こす元凶となります。

#### 1.3. 補足：「表を表に含める」という表現について

「部署表を社員表に含めている」といった表現は、物理的にテーブルがネストされているわけではありません。これは、**概念的に「部署」という独立したエンティティ（実体）として別表にすべき情報を、社員表の列として混ぜ込んでしまっている状態**を指します。

本来、「部署」と「社員」は1対多の関係（一つの部署に多くの社員が所属）にあります。これを一つのテーブルで表現しようとすることで、前述のデータの冗長性が生まれ、更新異常が発生しやすくなります。

---

### 2. 更新異常の3つの種類と具体例

ここでは、先ほどの`社員表`を例に、3種類の異常がどのように発生するのかを具体的に見ていきましょう。

#### 2.1. 挿入異常 (Insertion Anomaly)

**定義**
: あるデータを登録したいにもかかわらず、それとは関係のない別のデータが未定であるために、登録を実行できない現象。

**具体例**
: 新しく「企画部（部署ID: 30）」を設立したため、部署の情報をシステムに登録したいとします。しかし、この`社員表`では、社員が存在しないと部署の情報を登録することができません。`社員ID`や`社員名`が決まらない限り、「企画部」の行を追加できないのです。

*   **発生する問題**: 本来、独立して登録できるはずの部署情報が、社員情報に依存してしまっている。

#### 2.2. 更新異常 (Update Anomaly, 狭義)

**定義**
: 重複しているデータの一部だけを更新してしまい、データ間に不整合が生じてしまう現象。

**具体例**
: 「営業部」の名称を「営業本部」に変更することになりました。このテーブルでは、部署ID `10` の部署名をすべて変更する必要があります。

```
社員表
| 社員ID | 社員名 | 部署ID | 部署名 |
|:---|:---|:---|:---|
| 1 | 佐藤 | 10 | 営業本部 | ← 修正
| 2 | 鈴木 | 10 | 営業部   | ← ★修正漏れ発生！
| 3 | 田中 | 20 | 総務部 |
| 4 | 高橋 | 10 | 営業本部 | ← 修正
```

*   **発生する問題**: もし社員`2`の鈴木さんの行を修正し忘れると、同じ部署ID`10`であるにもかかわらず、「営業本部」と「営業部」という2つの部署名が混在してしまい、データの信頼性が失われます。

#### 2.3. 削除異常 (Deletion Anomaly)

**定義**
: あるデータを削除した際に、意図していなかった別の情報まで一緒に失われてしまう現象。

**具体例**
: 総務部に所属している社員は田中さん一人だけです。もし田中さんが退職し、`社員ID` `3` の行をテーブルから削除したとします。

```
削除対象 → | 3 | 田中 | 20 | 総務部 |
```

*   **発生する問題**: この行を削除すると、データベース上から「総務部（部署ID: 20）」という部署の情報そのものが完全に消えてしまいます。社員を削除したかっただけで、部署情報まで消したかったわけではないのに、情報喪失が発生します。

---

### 3. 更新異常の解決策：正規化

これら3種類の更新異常は、**正規化（Normalization）** と呼ばれる設計手法によって解決できます。正規化とは、データの冗長性を排除し、一貫性を保つためにテーブルを適切に分割していくプロセスです。

先ほどの`社員表`を正規化すると、以下の2つのテーブルに分割されます。これは**第3正規形**までの正規化を適用した結果です。

**【解決策：正規化されたテーブル】**

**社員表**
| 社員ID | 社員名 | 部署ID (外部キー) |
|:---|:---|:---|
| 1 | 佐藤 | 10 |
| 2 | 鈴木 | 10 |
| 3 | 田中 | 20 |
| 4 | 高橋 | 10 |

**部署表**
| 部署ID (主キー) | 部署名 |
|:---|:---|
| 10 | 営業部 |
| 20 | 総務部 |

このように分割することで、部署名は`部署表`に一度しか現れなくなり、データの冗長性が解消されます。これにより、前述の更新異常はすべて解決します。

*   **挿入異常の解決**: 新しい「企画部」は、`部署表`に1行追加するだけで登録できます。
*   **更新異常の解決**: 「営業部」を「営業本部」に変更するには、`部署表`の1行を修正するだけで済みます。
*   **削除異常の解決**: 総務部の田中さんを`社員表`から削除しても、`部署表`には「総務部」の情報が残り続けます。

---

### 4. 試験対策のポイント

#### 4.1. よくある誤解と正しい知識

| 誤解 | 正しい知識 |
|:---|:---|
| ① **異常 ＝ エラーが発生して操作できない** | 正しくは「**操作はできても、データの不整合や意図しない情報喪失が発生する**」という状態を指します。 |
| ② **削除異常 ＝ データを削除できないこと** | 正しくは「**あるデータを削除した結果、消したくなかった別の情報まで一緒に消えてしまう**」ことです。 |
| ③ **正規化は必ず第3正規形まですべき** | 試験対策では「第3正規形まで行うことで更新異常が解消される」と覚えるのが基本です。しかし、実務ではパフォーマンスを優先して、あえて正規化のレベルを崩す（非正規化する）場合もあります。 |

#### 4.2. 一問一答で理解度チェック

**Q1. あるテーブルに新しい部署の情報を追加したいが、その部署に所属する社員がまだいないため登録できない。この不都合を何と呼びますか？**
> **A1. 挿入異常**
> *解説: 部署という本来独立した情報を登録するために、社員という無関係な情報が必要になってしまっているためです。*

**Q2. ある部署の名称が変更されたため、該当する全社員の行の部署名列を更新したが、数件更新を漏らしてしまい、新旧の部署名がデータ内に混在してしまった。この不都合を何と呼びますか？**
> **A2. 更新異常（狭義）**
> *解説: 同じデータ（部署名）を冗長に保持していたため、更新時に一貫性が失われたことが原因です。*

**Q3. ある部署に所属する最後の社員が退職したため、その社員の行をテーブルから削除したところ、その部署自体の情報もデータベースから消えてしまった。この不都合を何と呼びますか？**
> **A3. 削除異常**
> *解説: 削除する意図のなかった部署の情報が、社員情報の削除に巻き込まれて失われたためです。*

**Q4. これら3種類の更新異常を解消するために行う、データベースの設計手法を何と呼びますか？**
> **A4. 正規化**
> *解説: テーブルを適切に分割し、データの冗長性を排除することで更新異常は解決できます。*

**Q5. 応用情報技術者試験において「更新異常が発生する根本的な原因」として最も適切なものは何ですか？**
> **A5. 一つのテーブル内に冗長なデータを持っていること（正規化が不十分であること）。**
> *解説: すべての更新異常は、データの重複、すなわち正規化不足が引き金となっています。*