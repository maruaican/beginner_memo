
---

# モジュール結合度（Coupling）の体系的解説

## 1. モジュール結合度とは

### 1.1. 定義と重要性

*   **モジュール (Module)**
    ソフトウェアを機能ごとに分割した部品のことです。
*   **結合度 (Coupling)**
    モジュール同士がどのくらい密接に関係しているか（依存しているか）を表す尺度です。用語は英語の *couple*（結びつける）に由来します。
*   **結合度の強弱**
    *   **弱い結合**: モジュール間の依存が少なく、独立性が高い状態です。あるモジュールを修正しても、他のモジュールへの影響が少なく、保守性に優れています（◎）。
    *   **強い結合**: モジュール間の依存が強く、独立性が低い状態です。あるモジュールを修正すると、他の関連モジュールにも修正が必要になる可能性が高く、保守性が低下します（×）。
*   **技術の必要性**
    大規模なソフトウェア開発において、仕様変更や保守は必ず発生します。結合度が強いと、一箇所の修正が他の箇所へ次々と影響を及ぼす「波及効果」が大きくなり、修正コストが増大します。結合度を意図的に弱く設計することで、変更の影響範囲を局所化し、保守を容易にすることが、この技術の目的です。

### 1.2. 結合度のレベル一覧

モジュール結合度は、依存の度合いによって以下の6つのレベルに分類されます。弱いものから順に並べると、保守性の高い（望ましい）順になります。

| 結合度レベル | 結合度の種類 | 強弱    | 特徴                                           |
| :----------- | :------------- | :------ | :--------------------------------------------- |
| **最も弱い**   | **データ結合**   | ◎ 望ましい | 単一のデータ項目を引数として渡す。             |
| **↓**         | **スタンプ結合** | ○ 弱め    | レコードや構造体など、データの塊を丸ごと渡す。 |
| **↓**         | **制御結合**   | △ 中程度   | フラグなどを渡し、相手モジュールの処理を制御する。 |
| **↓**         | **外部結合**   | × 強め    | 外部宣言された単一のグローバル変数を共有する。 |
| **↓**         | **共通結合**   | ×× 強い    | 共通データ領域（グローバルな構造体など）を共有する。 |
| **最も強い**   | **内容結合**   | ××× 最悪   | 他モジュールの内部コードやデータを直接参照・変更する。 |

## 2. モジュール結合度の6つのレベル（弱い順）

各結合度の名称は、その語源を理解することで、なぜその順位になるのかをイメージしやすくなります。

### 2.1. データ結合 (Data Coupling)
*   **強弱**: 最も弱い (◎)
*   **語源**: *data* (データ) + *coupling* (結合)
*   **意味**: モジュール間のやり取りで、処理に必要な**単一データ項目**だけを引数として渡します。最小単位のデータのみをやり取りするため、依存関係が最小限に抑えられます。
*   **図解**:
    ```
    [Module A] → (必要なデータx) → [Module B]
    ```
*   **イメージ**: **必要なものだけ**を「手渡し」する、最もクリーンな関係です。

### 2.2. スタンプ結合 (Stamp Coupling)
*   **強弱**: 弱い (○)
*   **語源**: *stamp* (切手、スタンプ = ひとまとめの印)
*   **意味**: レコードや構造体など、関連するデータを**ひとまとめにしたデータ構造**を丸ごと引数として渡します。呼び出された側が**実際には使用しないデータ項目も含まれる**ため、データ結合よりは依存度が高くなります。
*   **由来**: 「一枚のスタンプで複数の情報が押される」ように、余計な情報もまとめて渡してしまうイメージです。
*   **図解**:
    ```
    [Module A] → (Record / Struct) → [Module B]
    ```
*   **イメージ**: 複数の情報がまとまった書類を「ハンコ押し」で渡すようなものです。**余計な情報も含まれます**。

### 2.3. 制御結合 (Control Coupling)
*   **強弱**: 中程度 (△)
*   **語源**: *control* (制御する) + *coupling* (結合)
*   **意味**: 呼び出し側のモジュールが、呼び出される側のモジュールの動作を制御するための情報（**フラグ**や処理種別コードなど）を引数で渡します。これにより、呼び出し側は相手の処理内容を知っている必要があり、依存関係が生まれます。
*   **由来**: データそのものではなく、相手の「振る舞い (control)」に影響を与えることから名付けられました。
*   **図解**:
    ```
    [Module A] → (Flag: ON/OFF) → [Module B]
    ```
*   **イメージ**: 処理の流れを「指示書」で渡すような関係です。

### 2.4. 外部結合 (External Coupling)
*   **強弱**: 強め (×)
*   **語源**: *external* (外部の) + *coupling* (結合)
*   **意味**: モジュールの外部で宣言された**単一のグローバル変数**を、複数のモジュールが参照または更新することで結合します。
*   **由来**: モジュール外部の要素に依存して結びつくことから名付けられました。
*   **図解**:
    ```
          [Global Var: x]
         ↙                 ↘
    [Module A]              [Module B]
    ```
*   **イメージ**: 単一の情報を書いた「掲示板（グローバル変数）」を複数の人が共有する状態です。

### 2.5. 共通結合 (Common Coupling)
*   **強弱**: 強い (××)
*   **語源**: *common* (共通の) + *coupling* (結合)
*   **意味**: グローバルに宣言された**共通のデータ領域（構造体、共有メモリなど）**を、複数のモジュールが共有することで結合します。多くのデータ項目を内包するため、一つの項目変更が予期せぬ広範囲に影響を及ぼすリスクがあります。
*   **由来**: 共通領域を使うことで、すべてのモジュールが強く結びつくことから名付けられました。
*   **図解**:
    ```
           [Common Area: Struct {...}]
           ↙           ↓            ↘
    [Module A]      [Module B]     [Module C]
    ```
*   **イメージ**: 巨大な「ホワイトボード（共通領域）」をみんなで書き換えるようなもので、誰が何を変更したか追跡が困難になります。

### 2.6. 内容結合 (Content Coupling)
*   **強弱**: 最も強い・最悪 (×××)
*   **語源**: *content* (内容、中身) + *coupling* (結合)
*   **意味**: あるモジュールが、他のモジュールの**内部データやコードを直接参照・変更**します。これはモジュールの独立性を完全に破壊する行為であり、原則として許されません。
*   **由来**: 相手の内部に入り込む、最も侵襲的な結合であることから名付けられました。
*   **図解**:
    ```
    [Module A] → (内部の変数や処理を直接参照) → [Module B]
    ```
*   **イメージ**: 他人の家の鍵も持たずに入り込み、勝手に「机の引き出し」を漁るような行為です。

## 3. 詳細な比較：外部結合 vs. 共通結合

この2つはどちらもグローバルなデータを共有する点で似ていますが、共有の**単位**と**影響範囲**が異なり、共通結合の方がより危険とされます。

| 観点         | 外部結合 (External Coupling)                   | 共通結合 (Common Coupling)                     |
| :----------- | :--------------------------------------------- | :----------------------------------------------- |
| **共有の単位**   | **単一の変数**（点での共有）                     | **データ領域・構造体**（面での共有）               |
| **可視性**     | 個々の変数が可視                               | 領域内の多数の項目が一括で可視                   |
| **影響範囲**   | 中（その変数を使用する箇所に限定）               | **広**（領域に依存するすべての箇所）             |
| **保守性**     | 悪い                                           | **より悪い**                                     |
| **典型キーワード** | `extern` / 外部宣言された変数 / 単一のデータ項目 | 共通データ領域 / 共有メモリ / レコード全体 / 構造体 |
| **望ましさ**   | × 避けるべき                                    | **××** より避けるべき                          |

*   **まとめ**: **外部結合は「点」の共有**であり、**共通結合は「面」の共有**です。面を共有する共通結合は、データ構造の変更（項目追加や型変更）が、その領域を参照するすべてのモジュールに影響を及ぼすため、より保守性を低下させます。

## 4. 試験対策のポイント

### 4.1. 試験の着眼点と頻出領域
*   **暗記必須**: モジュール結合度の6段階（データ結合 → スタンプ結合 → 制御結合 → 外部結合 → 共通結合 → 内容結合）を**弱い順（望ましい順）**で覚えているかが問われます。
*   **最良の選択肢**: 正しい選択肢として「引数として必要なデータ項目だけを渡す」すなわち**データ結合**が頻繁に登場します。
*   **危険な選択肢**: 「共通データ領域（グローバル変数）は危険」という観点が重要です。これを理解しているかどうかが試されます。

### 4.2. 代表的な正答例・誤答例

*   **正答例**:
    *   「呼び出す側と呼び出される側のモジュール間のデータの受け渡しは、引数で必要なデータ項目だけを渡すのが望ましい。」
        *   **解説**: これは**データ結合**を指しており、最も結合度が弱く理想的な設計です。

*   **誤答例**:
    *   「共通データ領域は全てのモジュールからアクセスできるのが望ましい。」
        *   **解説**: これは**共通結合**を推奨する記述であり、結合度が非常に強くなり保守性が悪化するため誤りです。

### 4.3. よくある誤解と正しい知識

*   **誤解1**: 「共通データ領域（グローバル変数）は便利だから良い設計だ。」
    *   **正しい知識**: 一見便利に見えますが、モジュール間の依存関係を隠蔽し、強く結びつけてしまうため、変更に弱い構造を生み出します。原則として避けるべきです。

*   **誤解2**: 「結合度が強い方が、モジュール間の連携が密で高性能だ。」
    *   **正しい知識**: 結合度は性能の指標ではなく、**保守性**の指標です。強い結合はモジュールの独立性を損ない、保守性や再利用性を著しく低下させるため、危険とされています。

*   **誤解3**: 「外部結合と共通結合は、どちらもグローバル参照なので同じくらい悪い。」
    *   **正しい知識**: どちらも悪いですが、共有範囲が広い**共通結合の方が、変更の波及範囲が大きく、より危険**です。

## 5. 理解度チェックQ&A

| No.  | 問題                                                                             | 答え | 解説                                                                                                                             |
| :--- | :------------------------------------------------------------------------------- | :--- | :------------------------------------------------------------------------------------------------------------------------------- |
| 1    | モジュール結合度とは何を表す指標か？                                               | ○    | モジュール間の依存関係の強さを表す指標です。依存が強いほど保守性は低下します。                                                       |
| 2    | 最も結合度が弱く、望ましいとされる結合はどれか？                                     | ○    | **データ結合**です。処理に必要な最小限のデータ項目だけを引数で渡すため、独立性が最も高くなります。                                       |
| 3    | 構造体やレコードを丸ごと引数として渡す結合は「スタンプ結合」である。                       | ○    | その通りです。不要なデータも渡してしまう可能性があるため、データ結合よりは結合度が強くなります。                                         |
| 4    | 「フラグを渡して相手の処理を分岐させる」のは何結合か？                                 | ○    | **制御結合**です。呼び出し側が相手のロジックを制御するため、依存関係が生まれます。                                                   |
| 5    | 外部結合と共通結合の最大の違いは何か？                                             | ○    | 共有する単位です。外部結合は**単一の変数（点）**、共通結合は**データ領域や構造体（面）**を共有します。                                    |
| 6    | 「共通データ領域」というキーワードが出てきた場合、どの結合を指すか？                     | ○    | **共通結合**です。「共有メモリ」や「グローバルな構造体」も同様です。                                                                 |
| 7    | 他のモジュールの内部にある変数を直接書き換えるのは「内容結合」である。                     | ○    | その通りです。モジュールの独立性を完全に破壊する、最も避けるべき最悪の結合です。                                                   |
| 8    | 結合度が低いほど、モジュールの独立性が高く、保守性や再利用性が向上する。                   | ○    | その通りです。これがモジュール設計における重要な原則です。                                                                       |
| 9    | 共通結合は多くのモジュールからデータにアクセスできて便利なので、保守性が高い。             | ×    | 誤りです。一見便利ですが、変更の影響範囲が広くなり、バグの温床になりやすいため、保守性は著しく**低く**なります。                       |
| 10   | モジュール間のデータ連携で最も望ましい方法は、共通データ領域を設けることである。         | ×    | 誤りです。最も望ましい方法は、**必要最小限のデータを引数として渡すこと（データ結合）**です。                                           |

## 6. 要約

*   モジュール設計では、保守性を高めるために**結合度を弱くする**ことが極めて重要です。
*   最も望ましいのは、必要なデータだけを引数で渡す**データ結合**であり、逆に最も避けるべきは、他モジュールの内部を直接参照する**内容結合**です。
*   グローバル変数を共有する**外部結合**や、共通データ領域を共有する**共通結合**は、依存関係を強め保守性を低下させるため、原則として避けるべき設計です。