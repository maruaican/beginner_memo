
***

# 仮想サーバの冗長化設計と可用性評価

## 1. はじめに：情報処理技術者試験問題の分析

本ドキュメントは、仮想サーバの冗長化設計における可用性評価、特に「クラスタリング」を中心とした各種冗長化方式について、情報処理技術者試験の問題（平成28年秋期 問13）を基に詳細に解説します。

### 1.1. 出題問題（平成28年秋期 問13）

**問題：**
仮想サーバの冗長化設計における可用性評価に関する記述のうち，クラスタソフトウェアを用いた評価として，適切なものはどれか。

**選択肢：**
*   **ア**：OS，アプリケーション及びハードウェアの障害に対応し，障害時に障害が発生していないサーバに自動的に処理を引き継ぐので，切替え時間の短い安定した運用が求められる場合に有効である。
*   **イ**：仮想サーバを停止させずに物理サーバ間で仮想サーバを移動することが可能となるので，メンテナンスなど業務移行の際も含めて業務の停止が全く許容できない場合に有効である。
*   **ウ**：物理サーバに備わっている機能を利用するので，ハードウェアの障害にだけ対応し，障害時に業務停止が許容される場合に有効である。
*   **エ**：物理サーバのリソース(CPU，メモリなど)をブロック単位に物理的に分割し，あるブロックの障害が他のブロックに影響しないようにするので，障害時に業務の停止が許容できない場合に有効である。

### 1.2. 正解と解説

*   **正解：ア**

各選択肢は、それぞれ異なる冗長化方式を説明しています。
*   **ア：クラスタリング方式** (正解)
    *   OS、アプリケーション、ハードウェアの広範な障害に対応し、障害発生時に待機系のサーバへ自動的に処理を引き継ぎます（フェイルオーバー）。これにより、切り替え時間が短く、安定した運用が可能になります。
*   **イ：ライブマイグレーション方式**
    *   稼働中の仮想サーバを停止させることなく、別の物理サーバへ移動させる技術です。計画的なメンテナンス時など、業務の完全無停止が求められる場合に有効です。
*   **ウ：仮想マシン方式**
    *   物理サーバが持つ基本的な機能を利用して冗長化を図る方式です。主にハードウェア障害にのみ対応可能で、障害発生時には業務停止が許容される場合に用いられます。
*   **エ：パーティショニング方式**
    *   1台の物理サーバのリソース（CPUやメモリ）をブロック単位で物理的に分割し、それぞれを独立した区画として利用する方式です。ある区画の障害が他の区画に影響を及ぼすのを防ぎ、障害の影響を局所化します。

## 2. 仮想サーバの主要な冗長化方式

### 2.1. クラスタリング方式

*   **概要**
    複数の物理サーバ（ノード）を連携させて、全体として一つの論理的なサーバシステムとして構成する冗長化方式です。OS、アプリケーション、ハードウェアのいずれかに障害が発生した場合でも、クラスタ内の他の正常なサーバに自動的に処理を引き継ぎます。
*   **解決する課題と利用シーン**
    障害発生時の切り替え時間が短いため、サービス停止を最小限に抑える必要があり、安定した運用が求められるシステムに適しています。
*   **用語の由来**
    複数のサーバが「**群れ（cluster）**」のようにまとまって協調動作することに由来します。単にサーバを並べるのではなく、連携して処理を分担・冗長化する仕組みを指します。

### 2.2. ライブマイグレーション方式

*   **概要**
    稼働中の仮想サーバを業務アプリケーションごと、サービスを停止することなく別の物理サーバへ移動させる技術です。
*   **解決する課題と利用シーン**
    物理サーバのメンテナンスやリソースの最適化を行う際に、業務を完全に停止させることが許容できない場合に非常に有効です。
*   **用語の由来**
    仮想マシンを「**live（稼働中）**」のまま「**migration（移行）**」することから名付けられました。

### 2.3. パーティショニング方式

*   **概要**
    1台の物理サーバのCPUやメモリといったリソースを、複数の独立した区画（パーティション）に物理的に分割する方式です。
*   **解決する課題と利用シーン**
    あるパーティションで発生した障害が、他のパーティションに影響を及ぼすことを防ぎ、障害範囲を局所化します。業務停止が許容される場合に適しています。
*   **用語の由来**
    リソースを「**partition（区分、仕切り）**」することから来ています。

### 2.4. 仮想マシン方式

*   **概要**
    1台の物理サーバ上に、ハイパーバイザーなどの仮想化ソフトウェアを用いて複数の独立した仮想マシン（VM）を構築する方式です。
*   **解決する課題と利用シーン**
    主に物理サーバのハードウェア障害に対応します。OSやアプリケーションレベルの障害はカバーできず、障害発生時には業務停止が許容されるような、軽度の冗長化が目的の場合に用いられます。

## 3. 各冗長化方式の比較

### 3.1. 比較一覧表

| 冗長化方式 | 対応障害 | 停止有無 | 利用シーン | 特徴 |
| :--- | :--- | :--- | :--- | :--- |
| **クラスタリング** | OS/アプリ/HW | 自動フェイルオーバー | 障害時のサービス停止を極力避けたい場合 | 障害時に自動で処理を引き継ぎ、切替時間が短い |
| **ライブマイグレーション** | 仮想HW | 停止なし | メンテナンスを含め、業務の完全停止が不可な場合 | 稼働中の仮想サーバを停止せずに移行可能 |
| **仮想マシン** | HWのみ | 停止可 | 障害時の業務停止が許容される場合 | 基本的なハードウェア機能を利用した冗長化 |
| **パーティショニング** | HWリソース局所化 | 停止可 | 障害時の業務停止が許容される場合 | CPU/メモリを分割し、障害の影響範囲を限定 |

### 3.2. 試験における着眼点

各方式を正しく識別するためのキーワードは以下の通りです。
*   **クラスタリング方式**: 「OS，アプリケーション及びハードウェアの障害に対応」、「自動的に処理を引き継ぐ」
*   **ライブマイグレーション方式**: 「停止せずに移動」
*   **パーティショニング方式**: 「ブロック単位で分割」、「影響を局所化」
*   **仮想マシン方式**: 「物理サーバの機能を利用」、「ハードウェアの障害にだけ対応」

## 4. よくある誤解と正しい知識

*   **誤解1：クラスタリングは、単に物理サーバの機能を使うだけである。**
    *   **正しい知識**: クラスタリングは、物理的なハードウェアだけでなく、OSやアプリケーション層まで含めた高可用性を実現する仕組みです。単なる物理リソースの冗長化ではありません。

*   **誤解2：仮想サーバの移行（ライブマイグレーション）とクラスタリングは同じものである。**
    *   **正しい知識**: ライブマイグレーションは、計画的なメンテナンス等のために「稼働中のサーバを無停止で移動させる」技術です。一方、クラスタリングは、予期せぬ「障害発生時に自動で処理を引き継ぐ（フェイルオーバー）」技術であり、目的が異なります。

*   **誤解3：パーティショニングとクラスタリングは同じものである。**
    *   **正しい知識**: パーティショニングは、障害の影響範囲を「局所化」する技術であり、処理の自動引き継ぎ機能はありません。クラスタリングは障害時に処理そのものを引き継ぎ、サービスの継続性を確保します。

## 5. クラスタリング方式に関する深掘り

### 5.1. サーバ間の同期イメージ

クラスタリングは「**同期して協調するサーバの群れ**」と表現できますが、すべての情報がリアルタイムで完全に同期されているわけではありません。負荷や性能を考慮し、サービスの可用性確保に必要な情報が選択的に同期されます。

**[クラスタノードA]───┐**
**[クラスタノードB]───┤ 同期対象：サービス稼働に必要な情報**
**[クラスタノードC]───┘**

*   **同期される情報（自動引き継ぎに必須）**
    *   **セッション状態**: ユーザーのログイン情報など。
    *   **トランザクションやジョブの進行状況**: 処理の途中経過。
    *   **サービス稼働状態**: アプリケーションやプロセスの死活情報（ハートビート）。

*   **非同期または部分的に同期される情報**
    *   ログファイル
    *   バックアップデータ
    *   大量の静的ファイルやレポート

**ポイント**: 同期の最大の目的は、データの一貫性や高速処理よりも、**障害発生時に業務を止めない「可用性の確保」** にあります。障害時に自動で処理を引き継ぐサーバは、これらの情報を同期済みのノードです。

## 6. 理解度チェック（一問一答）

**問1：** OS・アプリ・HW障害に対応し、自動フェイルオーバーが可能な方式は？
**答1：** **クラスタリング方式**
*   解説：障害時、処理を自動的に別のサーバに引き継ぐ機能を持ちます。

**問2：** 仮想サーバを停止せずに別の物理サーバに移動できる方式は？
**答2：** **ライブマイグレーション方式**
*   解説：業務停止ゼロでのサーバ移行を可能にします。

**問3：** 物理サーバの機能を利用し、ハードウェア障害のみに対応できる方式は？
**答3：** **仮想マシン方式**
*   解説：OSやアプリケーションの障害はカバーできません。

**問4：** CPUやメモリを分割し、障害の影響範囲を限定する方式は？
**答4：** **パーティショニング方式**
*   解説：障害の影響を局所化しますが、業務停止が許容される環境で用いられます。

**問5：** クラスタリング方式の主なメリットは？
**答5：** **切替え時間が短く、安定した運用が可能になること。**
*   解説：障害発生時の業務停止時間を最小化できます。

## 7. 要約

*   **クラスタリング**はOS・アプリ・HWの障害に自動対応し、短時間で処理を引き継ぐことで高い可用性を実現します。
*   **ライブマイグレーション**は計画メンテナンス等で利用され、仮想サーバを停止させることなく移行できます。
*   **パーティショニング**と**仮想マシン方式**は、より限定的な障害対応やリソース分割を目的とした冗長化手法です。