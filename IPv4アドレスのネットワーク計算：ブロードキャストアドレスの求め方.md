

***

## IPv4アドレスのネットワーク計算：ブロードキャストアドレスの求め方

このドキュメントでは、情報処理技術者試験（平成26年春期 問33）で出題された問題を題材に、IPv4アドレス、サブネットマスク、ネットワークアドレス、ブロードキャストアドレスの計算方法を体系的に解説します。

## 1. 問題の概要と結論

### 1.1. 出題情報
*   **試験名**: 平成26年春期 情報処理技術者試験
*   **問題番号**: 問33
*   **分野**: テクノロジ系 / ネットワーク / 通信プロトコル

### 1.2. 問題と正解
**問題:**
IPv4アドレス `172.22.29.44/20` のホストが存在するネットワークのブロードキャストアドレスはどれか。

**選択肢:**
*   ア. 172.22.29.255
*   イ. 172.22.30.255
*   ウ. 172.22.31.255
*   エ. 172.22.32.255

**正解:** ウ. `172.22.31.255`

### 1.3. 計算結果の要約
`172.22.29.44/20` のネットワークに関する主要なアドレスは以下の通りです。

| 種類 | 計算方法 | 例 (`172.22.29.44/20`) |
| :--- | :--- | :--- |
| **ネットワークアドレス** | ホスト部のビットを全て**0**にする | `172.22.16.0` |
| **ブロードキャストアドレス** | ホスト部のビットを全て**1**にする | `172.22.31.255` |
| **利用可能なホスト範囲** | ネットワークアドレス+1 ～ ブロードキャストアドレス-1 | `172.22.16.1` ～ `172.22.31.254` |

---

## 2. 基本概念の解説

計算を理解するために、まず基本的な用語を定義します。

### 2.1. アドレスプレフィックス（CIDR表記）
`172.22.29.44/20` のように、IPアドレスの後方に付加されている `/` と数字の組み合わせを**アドレスプレフィックス**または**CIDR表記**と呼びます。この数字は、IPアドレスの先頭から何ビットまでが**ネットワーク部**であるかを示します。

*   **`/20` の意味**: 32ビットのIPv4アドレスのうち、上位20ビットがネットワーク部であり、残りの下位12ビット（32 - 20 = 12ビット）が**ホスト部**であることを示します。

### 2.2. ブロードキャストアドレス
特定のネットワークに属する**全てのホスト**に対して、データを一斉に送信（ブロードキャスト）するために使用される特殊なアドレスです。ホスト部のビットを全て`1`にすることで算出されます。

### 2.3. サブネットマスクとワイルドカードマスク

*   **サブネットマスク**:
    *   ネットワーク部を`1`、ホスト部を`0`で表現した32ビットの数値です。IPアドレスとAND演算をすることで、ネットワークアドレスを抽出できます。
    *   `/20` の場合: `11111111.11111111.11110000.00000000` → `255.255.240.0`
*   **ワイルドカードマスク**:
    *   サブネットマスクのビットを反転させたものです（`0`と`1`を入れ替える）。ネットワーク部が`0`、ホスト部が`1`になります。
    *   `/20` の場合: `00000000.00000000.00001111.11111111` → `0.0.15.255`

---

## 3. ブロードキャストアドレスの計算手順

ブロードキャストアドレスを求めるには、主に2つの方法があります。

### 3.1. 方法①：ネットワーク部とホスト部を直接扱う方法

#### ステップ1: IPアドレスを2進数に変換する
まず、IPアドレス `172.22.29.44` を2進数に変換します。
`172.22.29.44` = `10101100.00010110.00011101.00101100`

#### ステップ2: ネットワーク部とホスト部を分割する
`/20` なので、先頭から20ビットがネットワーク部、残りの12ビットがホスト部です。

*   **ネットワーク部 (20ビット)**: `10101100.00010110.0001`
*   **ホスト部 (12ビット)**: `1101.00101100`

#### ステップ3: ネットワークアドレスを算出する
ネットワークアドレスは、ホスト部のビットを全て`0`にしたものです。
`10101100.00010110.0001`**`0000.00000000`**
→ `172.22.16.0`

#### ステップ4: ブロードキャストアドレスを算出する
ブロードキャストアドレスは、ホスト部のビットを全て`1`にしたものです。
`10101100.00010110.0001`**`1111.11111111`**
→ `172.22.31.255`

### 3.2. 方法②：論理演算（AND/OR）を用いる方法

実務や試験では、サブネットマスクを用いた論理演算が基本となります。

#### ステップ1: IPアドレスとサブネットマスクを2進数で用意する
*   **IPアドレス (`172.22.29.44`)**:
    `10101100.00010110.00011101.00101100`
*   **サブネットマスク (`/20` = `255.255.240.0`)**:
    `11111111.11111111.11110000.00000000`

#### ステップ2: ネットワークアドレスを算出する (IPアドレス AND サブネットマスク)
IPアドレスとサブネットマスクの**AND演算**を行います。これにより、ホスト部が強制的に`0`になります。
```
  10101100.00010110.00011101.00101100  (IPアドレス)
& 11111111.11111111.11110000.00000000  (サブネットマスク)
------------------------------------------
= 10101100.00010110.00010000.00000000  (ネットワークアドレス)
```
→ 10進数に変換すると `172.22.16.0` となります。

#### ステップ3: ブロードキャストアドレスを算出する (ネットワークアドレス OR ワイルドカードマスク)
次に、算出したネットワークアドレスとワイルドカードマスク（サブネットマスクの反転）で**OR演算**を行います。これにより、ホスト部が強制的に`1`になります。

*   **ネットワークアドレス (`172.22.16.0`)**:
    `10101100.00010110.00010000.00000000`
*   **ワイルドカードマスク (`0.0.15.255`)**:
    `00000000.00000000.00001111.11111111`

```
  10101100.00010110.00010000.00000000  (ネットワークアドレス)
| 00000000.00000000.00001111.11111111  (ワイルドカードマスク)
------------------------------------------
= 10101100.00010110.00011111.11111111  (ブロードキャストアドレス)
```
→ 10進数に変換すると `172.22.31.255` となります。

---

## 4. 関連情報の計算

### 4.1. 利用可能なホストアドレス範囲の算出
ネットワーク内でPCなどの機器に割り当てられるIPアドレスの範囲です。ネットワークアドレスとブロードキャストアドレスは予約されているため使用できません。

*   **利用可能な最小ホストアドレス**: ネットワークアドレス + 1
    *   `172.22.16.0` + 1 → `172.22.16.1`
*   **利用可能な最大ホストアドレス**: ブロードキャストアドレス - 1
    *   `172.22.31.255` - 1 → `172.22.31.254`

### 4.2. ホスト番号（ネットワーク内での位置）の算出
IPアドレスからホスト部だけを抜き出すことで、そのホストがネットワーク内で何番目に位置するか（オフセット値）を計算できます。これはIPアドレスとワイルドカードマスクの**AND演算**で求められます。

*   **IPアドレス (`172.22.29.44`)**:
    `10101100.00010110.00011101.00101100`
*   **ワイルドカードマスク (`0.0.15.255`)**:
    `00000000.00000000.00001111.11111111`

```
  10101100.00010110.00011101.00101100  (IPアドレス)
& 00000000.00000000.00001111.11111111  (ワイルドカードマスク)
------------------------------------------
= 00000000.00000000.00001101.00101100  (ホスト番号)
```
→ 10進数に変換すると `0.0.13.44` となり、これがホスト部の値に相当します。

**（参考）その他のAND演算**
*   **ネットワークアドレス AND ワイルドカードマスク**: 結果は常に `0.0.0.0`
*   **サブネットマスク AND ワイルドカードマスク**: 結果は常に `0.0.0.0`

---

## 5. 学習のポイントとよくある誤解

### 5.1. 試験での着眼点
*   CIDR表記（`/`表記）から2進数への変換、およびネットワークの範囲計算は頻出します。特に `/20`, `/24`, `/26` などの計算に慣れておくと良いでしょう。
*   ネットワークアドレスとブロードキャストアドレスの定義を混同しないように注意が必要です。

### 5.2. よくある誤解
*   **誤解①**: CIDRの`/20`を、第3オクテット（24ビット目）の区切りと勘違いしてしまう。
    *   **正しい知識**: `/20`は第2オクテット（16ビット）を4ビット超えた位置が境界です。つまり、第3オクテットの**途中**がネットワーク部とホスト部の境界になります。
*   **誤解②**: `172.22.29.44` のブロードキャストアドレスを、単純に最後のオクテットを255にした `172.22.29.255` と考えてしまう。
    *   **正しい知識**: ホスト部がオクテットの境界をまたいでいるため、第3オクテットも計算に含める必要があります。

---

## 補足資料：2進数と10進数の相互変換

IPアドレスの計算には、2進数と10進数の変換が不可欠です。ここでは、各オクテット（8ビット）における変換方法を解説します。

### 補足1. 2進数から10進数への変換（重みによる加算）
2進数の各桁には、右から順に「重み」（2の累乗）が割り当てられています。`1`が立っている桁の重みをすべて足し合わせることで、10進数に変換できます。

**重み**:
| 128 | 64 | 32 | 16 | 8 | 4 | 2 | 1 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 2⁷ | 2⁶ | 2⁵ | 2⁴ | 2³ | 2² | 2¹ | 2⁰ |

**例1: `00011101` を10進数に変換 (問題の第3オクテット `29`)**
*   `1`が立っている桁: 16, 8, 4, 1
*   計算: 16 + 8 + 4 + 1 = **29**

**例2: `00101100` を10進数に変換 (問題の第4オクテット `44`)**
*   `1`が立っている桁: 32, 8, 4
*   計算: 32 + 8 + 4 = **44**

### 補足2. 10進数から2進数への変換（重みによる減算）
変換したい10進数から、超えない範囲で最も大きい重みを引き、その桁を`1`にします。残りの数値で同じ処理を繰り返します。

**例1: `31` を2進数に変換 (ブロードキャストアドレスの第3オクテット)**
1.  `31` は `128`, `64`, `32` より小さい → `000`
2.  `31` ≥ `16` → `1`を立てる。残り: `31 - 16 = 15`
3.  `15` ≥ `8` → `1`を立てる。残り: `15 - 8 = 7`
4.  `7` ≥ `4` → `1`を立てる。残り: `7 - 4 = 3`
5.  `3` ≥ `2` → `1`を立てる。残り: `3 - 2 = 1`
6.  `1` ≥ `1` → `1`を立てる。残り: `1 - 1 = 0`
*   結果: `00011111`

**例2: `44` を2進数に変換**
1.  `44` は `128`, `64` より小さい → `00`
2.  `44` ≥ `32` → `1`を立てる。残り: `44 - 32 = 12`
3.  `12` は `16` より小さい → `0`
4.  `12` ≥ `8` → `1`を立てる。残り: `12 - 8 = 4`
5.  `4` ≥ `4` → `1`を立てる。残り: `4 - 4 = 0`
6.  `0` は `2` より小さい → `0`
7.  `0` は `1` より小さい → `0`
*   結果: `00101100`