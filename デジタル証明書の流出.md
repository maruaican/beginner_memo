## 問題
認証局が侵入され，攻撃者によって不正なWebサイト用のデジタル証明書が複数発行されたおそれがある。どのデジタル証明書が不正に発行されたものか分からない場合，誤って不正に発行されたデジタル証明書を用いたWebサイトにアクセスしないために利用者側で実施すべき対策は？

---

## デジタル証明書の信頼性とブラウザの対応に関する整理

---

### １　背景

* Webサイトの通信の安全性を保証するために、HTTPSでは**デジタル証明書**が用いられる。
* デジタル証明書は、**公開鍵と所有者情報を認証局（CA）が保証する電子文書**。
* \*\*認証局(CA)\*\*は信頼された機関で、証明書を発行する権限を持つ。
* 証明書ポリシー(CP)はCAが証明書を発行する際の手順や運用ルールを文書化したもの。

---

### ２　問題の発生

* 認証局が侵害されると、攻撃者が**不正な証明書を発行可能**になる。
* この場合、利用者側では正当な証明書か不正な証明書か**判別できない**状態になる。
* 誤って不正証明書を用いたWebサイトにアクセスすると、通信内容の盗聴や改ざん、中間者攻撃に巻き込まれるリスクがある。

---

### ３　利用者側の対応方針

#### 3-1　誤った対応例

1. **有効期限の確認のみ**

   * 不正証明書の有効期限が切れているわけではない
   * よって、有効期限だけでは不正証明書を排除できない

2. **Whois情報確認**

   * ドメイン登録情報と証明書の正当性は関係がない
   * 登録済みのドメインでも不正証明書が発行される可能性がある

3. **CPの内容確認**

   * 証明書ポリシーは発行手順や運用ルールを示すだけで、発行された証明書が正しいかどうかは保証しない

#### 3-2　正しい対応

* **ブラウザで当該CA（認証局）を非信頼に設定する**

  * 攻撃されたCAの証明書は正当か不正か判別できないため、安全のため「非信頼」として扱う
  * ブラウザは非信頼CAの証明書を持つWebサイトにアクセスすると、**証明書エラーを表示**する
  * 利用者はエラー表示を見てアクセスを中止する → 不正サイトへのアクセスを回避可能

---

### ４　副作用と運用上の注意

* **副作用**

  * 非信頼に設定したCAの証明書を使った正当なWebサイトも警告表示される
  * HTTPS接続が一時的にできなくなることがある

* **運用上の工夫**

  * 攻撃されたCAのみ非信頼に設定
  * 他のCAは信頼状態を維持 → 大多数のHTTPSサイトは通常通りアクセス可能
  * サービス提供側が、必要に応じて他の信頼済みCAに証明書を更新することも検討

---

### ５　ブラウザの動作と誤解の整理

* 誤解：「どの証明書が信用できないか分からないから、全部信用できない」

* 正しい理解：

  1. 攻撃されたCA（認証局）だけ非信頼にする
  2. そのCA（認証局）発行の証明書だけエラー表示
  3. 他のCA（認証局）発行の証明書は通常通りHTTPS接続可能

* つまり、**「全部のHTTPSが信用できない」わけではない**

* ブラウザは「CA（認証局）ごとの信頼状態」を元にアクセス可否を判断する

---

### ６　図式化イメージ（テキスト図）

```
           ┌──────────────┐
           │ ルートCAリスト │ ← 多数の信頼されたCA
           └──────────────┘
                   │
    ┌───────────────┼───────────────┐
    │                               │
正当CA（認証局）発行サイト   攻撃CA（認証局）発行サイト
    │                               │
    ▼                               ▼
HTTPS接続可能                     証明書エラー表示
    │                               │
利用者は通常アクセス              利用者はアクセス中止 → 不正サイト回避
```

---

### ７　試験的観点

* 誤答の狙い：

  * 「有効期限だけ見る」→不正証明書でも有効
  * 「Whois確認」→正当性と無関係
  * 「CP確認」→発行ポリシーは証明書正当性と無関係
* 正答：

  * ブラウザでCA（認証局）を非信頼に設定 → 証明書エラーで不正サイト回避

---

### ８　一問一答（総まとめ）

1. **攻撃されたCA（認証局）の証明書がある場合の安全策は？**
   → ブラウザでCA（認証局）を非信頼に設定し、証明書エラー時はアクセス中止

2. **有効期限チェックだけで安全か？**
   → ✕：不正証明書は有効期限内でも存在可能

3. **Whois情報確認で正当性が分かるか？**
   → ✕：ドメイン登録情報と証明書正当性は無関係

4. **CP内容確認で証明書の正当性は分かるか？**
   → ✕：ポリシー内容は正当性に関係しない

5. **ブラウザでCA（認証局）非信頼にすると他のHTTPSサイトも使えなくなる？**
   → ✕：非信頼にしたCA（認証局）発行サイトのみ警告。他のCA（認証局）発行サイトは通常通り

---


